<!DOCTYPE html><html lang="zh-CN" data-default-color-scheme="auto"><head><meta charset="UTF-8"><link rel="apple-touch-icon" sizes="76x76" href="https://images.kisechan.space/icon.jpg"><link rel="icon" href="https://images.kisechan.space/icon.jpg"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=5,shrink-to-fit=no"><meta http-equiv="x-ua-compatible" content="ie=edge"><meta name="theme-color" content="#004e66"><meta name="author" content="Kisechan"><meta name="keywords" content=""><meta name="description" content="关于 数据库管理系统（ DBMS ）是：  一组相关数据的集合 一组用于访问这些数据的程序的集合  数据库则是相关数据的集合，是存放数据的地方。 数据库的发明是为了填补原有文件系统的缺陷。 文件系统的缺陷   数据的冗余和冲突  多个人创建不同的文件包含相同的文件。 一个数据的不同副本不一致。    数据访问困难  不同的人建立的文件格式五花八门 缺乏标准化    数据孤岛  数据分散在不同格式的"><meta property="og:type" content="article"><meta property="og:title" content="数据库原理 课程笔记 (1)"><meta property="og:url" content="https://blog.kisechan.space/2025/notes-database-1/index.html"><meta property="og:site_name" content="Kisechan&#39;s Blog"><meta property="og:description" content="关于 数据库管理系统（ DBMS ）是：  一组相关数据的集合 一组用于访问这些数据的程序的集合  数据库则是相关数据的集合，是存放数据的地方。 数据库的发明是为了填补原有文件系统的缺陷。 文件系统的缺陷   数据的冗余和冲突  多个人创建不同的文件包含相同的文件。 一个数据的不同副本不一致。    数据访问困难  不同的人建立的文件格式五花八门 缺乏标准化    数据孤岛  数据分散在不同格式的"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="https://images.kisechan.space/notes-database-index.jpg"><meta property="article:published_time" content="2025-03-19T01:11:47.000Z"><meta property="article:modified_time" content="2025-05-07T06:37:48.470Z"><meta property="article:author" content="Kisechan"><meta property="article:tag" content="数据库"><meta name="twitter:card" content="summary_large_image"><meta name="twitter:image" content="https://images.kisechan.space/notes-database-index.jpg"><meta name="referrer" content="no-referrer-when-downgrade"><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet"><title>数据库原理 课程笔记 (1) - Kisechan&#39;s Blog</title><link rel="stylesheet" type="text/css" href="/css/loading.css"><link rel="stylesheet" href="https://lib.baomitu.com/twitter-bootstrap/4.6.1/css/bootstrap.min.css"><link rel="stylesheet" href="https://lib.baomitu.com/github-markdown-css/4.0.0/github-markdown.min.css"><link rel="stylesheet" href="https://lib.baomitu.com/hint.css/2.7.0/hint.min.css"><link rel="stylesheet" href="https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css"><link rel="stylesheet" href="https://lib.baomitu.com/KaTeX/0.16.2/katex.min.css"><link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_hj8rtnfg7um.css"><link rel="stylesheet" href="//at.alicdn.com/t/c/font_4890189_5ms3yf4n747.css"><link rel="stylesheet" href="/css/main.css"><link id="highlight-css" rel="stylesheet" href="/css/highlight.css"><link id="highlight-css-dark" rel="stylesheet" href="/css/highlight-dark.css"><link rel="stylesheet" href="/css/cursor.css"><link rel="stylesheet" href="//cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.css"><script id="fluid-configs">var Fluid=window.Fluid||{};Fluid.ctx=Object.assign({},Fluid.ctx);var dntVal,CONFIG={hostname:"blog.kisechan.space",root:"/",version:"1.9.7",typing:{enable:!0,typeSpeed:70,cursorChar:"_",loop:!1,scope:["home"]},anchorjs:{enable:!0,element:"h1,h2,h3,h4,h5,h6",placement:"left",visible:"hover",icon:"#"},progressbar:{enable:!0,height_px:3,color:"#29d",options:{showSpinner:!0,trickleSpeed:100}},code_language:{enable:!0,default:"TEXT"},copy_btn:!0,image_caption:{enable:!0},image_zoom:{enable:!0,img_url_replace:["",""]},toc:{enable:!0,placement:"right",headingSelector:"h1,h2,h3,h4",collapseDepth:4},lazyload:{enable:!0,loading_img:"/img/loading.gif",onlypost:!1,offset_factor:2},web_analytics:{enable:!1,follow_dnt:!0,baidu:null,google:{measurement_id:null},tencent:{sid:null,cid:null},woyaola:null,cnzz:null,leancloud:{app_id:null,app_key:null,server_url:null,path:"window.location.pathname",ignore_local:!1}},search_path:"/local-search.xml",include_content_in_search:!0};CONFIG.web_analytics.follow_dnt&&(dntVal=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,Fluid.ctx.dnt=dntVal&&(dntVal.startsWith("1")||dntVal.startsWith("yes")||dntVal.startsWith("on")))</script><script src="/js/utils.js"></script><script src="/js/color-schema.js"></script><script>document.addEventListener("DOMContentLoaded",function(){const e=document.getElementById("busuanzi_value_site_uv"),t=document.getElementById("busuanzi_value_site_pv"),n=new MutationObserver(e=>{for(let t of e)if("childList"===t.type){n.disconnect(),t.target.innerHTML=parseInt(t.target.innerHTML)+3837;break}}),i=new MutationObserver(e=>{for(let t of e)if("childList"===t.type){i.disconnect(),t.target.innerHTML=parseInt(t.target.innerHTML)+6136;break}}),r={childList:!0};n.observe(e,r),i.observe(t,r)});</script><meta name="generator" content="Hexo 7.2.0"><style>.github-emoji{position:relative;display:inline-block;width:1.2em;min-height:1.2em;overflow:hidden;vertical-align:top;color:transparent}.github-emoji>span{position:relative;z-index:10}.github-emoji .fancybox,.github-emoji img{margin:0!important;padding:0!important;border:none!important;outline:0!important;text-decoration:none!important;user-select:none!important;cursor:auto!important}.github-emoji img{height:1.2em!important;width:1.2em!important;position:absolute!important;left:50%!important;top:50%!important;transform:translate(-50%,-50%)!important;user-select:none!important;cursor:auto!important}.github-emoji-fallback{color:inherit}.github-emoji-fallback img{opacity:0!important}</style><link rel="alternate" href="/atom.xml" title="Kisechan's Blog" type="application/atom+xml"></head><body><div><div class="real_mask" style="background-color:rgba(0,0,0,.3);width:100%;height:100%;position:fixed;z-index:-777"></div><div id="banner_video_insert"></div><div id="vvd_banner_img"></div></div><div id="banner"></div><div id="loader-box"><div class="loader-wrapper"><div class="loader"></div><div class="loader-text"><div>L</div><div>O</div><div>A</div><div>D</div><div>I</div><div>N</div><div>G</div><div></div><div></div><div></div></div></div><script>var endLoading=function(){document.body.style.overflow="auto",document.getElementById("loader-box").remove()};window.addEventListener("load",endLoading)</script></div><header><div class="header-inner" style="height:80vh"><nav id="navbar" class="navbar fixed-top navbar-expand-lg navbar-dark scrolling-navbar"><div class="container"><a class="navbar-brand" href="/"><strong>KISECHAN</strong> </a><button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation"><div class="animated-icon"><span></span><span></span><span></span></div></button><div class="collapse navbar-collapse" id="navbarSupportedContent"><ul class="navbar-nav ml-auto text-center"><li class="nav-item"><a class="nav-link" href="https://www.kisechan.space/" target="_self"><i class="iconfont icon-Homehomepagemenu"></i> <span>主站</span></a></li><li class="nav-item dropdown"><a class="nav-link dropdown-toggle" target="_self" href="javascript:;" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><i class="iconfont icon-newstextarticle"></i> <span>文章</span></a><div class="dropdown-menu" aria-labelledby="navbarDropdown"><a class="dropdown-item" href="/archives/" target="_self"><i class="iconfont icon-archive"></i> <span>归档</span> </a><a class="dropdown-item" href="/categories/" target="_self"><i class="iconfont icon-categories"></i> <span>分类</span> </a><a class="dropdown-item" href="/tags/" target="_self"><i class="iconfont icon-tags-fill"></i> <span>标签</span></a></div></li><li class="nav-item dropdown"><a class="nav-link dropdown-toggle" target="_self" href="javascript:;" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><i class="iconfont icon-user"></i> <span>个人</span></a><div class="dropdown-menu" aria-labelledby="navbarDropdown"><a class="dropdown-item" href="https://www.kisechan.space/" target="_self"><i class="iconfont icon-info-fill"></i> <span>关于</span> </a><a class="dropdown-item" href="/playlist/" target="_self"><i class="iconfont icon-music"></i> <span>歌单</span> </a><a class="dropdown-item" href="https://github.com/Kisechan/Kisechan.github.io" target="_self"><i class="iconfont icon-git"></i> <span>仓库</span> </a><a class="dropdown-item" href="/atom.xml" target="_self"><i class="iconfont icon-rss"></i> <span>RSS订阅</span></a></div></li><li class="nav-item"><a class="nav-link" href="https://www.kisechan.space/tools/" target="_self"><i class="iconfont icon-tool-fill"></i> <span>工具</span></a></li><li class="nav-item"><a class="nav-link" href="https://www.kisechan.space/links" target="_self"><i class="iconfont icon-link"></i> <span>友链</span></a></li><li class="nav-item" id="search-btn"><a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search"><i class="iconfont icon-search"></i></a></li><li class="nav-item" id="color-toggle-btn"><a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle"><i class="iconfont icon-dark" id="color-toggle-icon"></i></a></li></ul></div></div></nav><div id="banner" class="banner" parallax="true" style="background:url(https://images.kisechan.space/202502042159748.png) no-repeat center center;background-size:cover"><div class="full-bg-img"><div class="mask flex-center" style="background-color:rgba(0,0,0,.3)"><div class="banner-text text-center fade-in-up"><div class="h2"><span id="subtitle">数据库原理 课程笔记 (1)</span></div><div class="mt-3"><span class="post-meta mr-2"><i class="iconfont icon-author" aria-hidden="true"></i> Kisechan </span><span class="post-meta"><i class="iconfont icon-date-fill" aria-hidden="true"></i> <time datetime="2025-03-19 09:11" pubdate>2025年3月19日 上午</time></span></div><div class="mt-1"><span class="post-meta mr-2"><i class="iconfont icon-chart"></i> 15k 字 </span><span id="busuanzi_container_page_pv" style="display:none"><i class="iconfont icon-eye" aria-hidden="true"></i> <span id="busuanzi_value_page_pv"></span> 次</span></div></div><div class="scroll-down-bar"><i class="iconfont icon-arrowdown"></i></div></div></div></div></div><script type="text/javascript" src="/vvd_js/jquery.js"></script><div class="banner" id="banner"><div class="full-bg-img"></div></div></header><main><div class="container-fluid nopadding-x"><div class="row nomargin-x"><div class="side-col d-none d-lg-block col-lg-2"><aside class="sidebar category-bar" style="margin-right:-1rem"><div class="category-list"><div class="category row nomargin-x"><a class="category-item list-group-item category-item-action col-10 col-md-11 col-xm-11" title="课程笔记" id="heading-311a46cfdaa3afda544e9285644f70d7" role="tab" data-toggle="collapse" href="#collapse-311a46cfdaa3afda544e9285644f70d7" aria-expanded="true">课程笔记 <span class="list-group-count">(8)</span> <i class="iconfont icon-arrowright"></i></a><div class="category-collapse collapse show" id="collapse-311a46cfdaa3afda544e9285644f70d7" role="tabpanel" aria-labelledby="heading-311a46cfdaa3afda544e9285644f70d7"><div class="category-post-list"><a href="/2024/oop/" title="面向对象程序设计课程笔记" class="list-group-item list-group-item-action"><span class="category-post">面向对象程序设计课程笔记</span> </a><a href="/2024/linux-note/" title="Linux课程笔记" class="list-group-item list-group-item-action"><span class="category-post">Linux课程笔记</span> </a><a href="/2024/ds/" title="数据结构课程板子合集&amp;笔记" class="list-group-item list-group-item-action"><span class="category-post">数据结构课程板子合集&amp;笔记</span> </a><a href="/2025/notes-algorithm-analysis/" title="算法设计与分析 课程笔记" class="list-group-item list-group-item-action"><span class="category-post">算法设计与分析 课程笔记</span> </a><a href="/2025/notes-database-1/" title="数据库原理 课程笔记 (1)" class="list-group-item list-group-item-action active"><span class="category-post">数据库原理 课程笔记 (1)</span> </a><a href="/2025/notes-database-2/" title="数据库原理 课程笔记 (2)" class="list-group-item list-group-item-action"><span class="category-post">数据库原理 课程笔记 (2)</span> </a><a href="/2025/notes-database-3/" title="数据库原理 课程笔记 (3)" class="list-group-item list-group-item-action"><span class="category-post">数据库原理 课程笔记 (3)</span> </a><a href="/2025/notes-operating-system/" title="操作系统复习" class="list-group-item list-group-item-action"><span class="category-post">操作系统复习</span></a></div></div></div></div></aside></div><div class="col-lg-8 nopadding-x-md"><div class="container nopadding-x-md" id="board-ctn"><div id="board"><article class="post-content mx-auto"><h1 id="seo-header">数据库原理 课程笔记 (1)</h1><p id="updated-time" class="note note-info" style="display:none">本文最后更新于 2025-05-07T14:37:48+08:00</p><div class="markdown-body"><h2 id="关于">关于</h2><p><strong>数据库管理系统</strong>（ DBMS ）是：</p><ul><li>一组相关数据的集合</li><li>一组用于访问这些数据的<strong>程序的集合</strong></li></ul><p><strong>数据库</strong>则是相关<strong>数据的集合</strong>，是存放数据的地方。</p><p>数据库的发明是为了填补原有文件系统的缺陷。</p><h3 id="文件系统的缺陷">文件系统的缺陷</h3><ol><li><p><strong>数据的冗余和冲突</strong></p><ul><li>多个人创建不同的文件包含相同的文件。</li><li>一个数据的不同副本不一致。</li></ul></li><li><p><strong>数据访问困难</strong></p><ul><li>不同的人建立的文件格式五花八门</li><li>缺乏标准化</li></ul></li><li><p><strong>数据孤岛</strong></p><ul><li>数据分散在不同格式的文件中</li><li>难以编写检索程序，因为数据是割裂的</li></ul></li><li><p><strong>完整性问题</strong></p><ul><li>不能维护一致性约束——不能存在统一的机制让数据合法</li></ul></li><li><p><strong>原子性问题</strong></p><ul><li>传统文件系统不能保证事务的完整性，容易造成半成品数据</li></ul></li><li><p><strong>并发访问</strong></p><ul><li>传统文件系统不能协调并发访问，只能让程序员自己加锁</li></ul></li><li><p><strong>安全性问题</strong></p><ul><li>不能精细管理谁能看哪些数据，修改哪些数据</li></ul></li></ol><h3 id="数据视角">数据视角</h3><p>数据视角就是<strong>从不同的角度去看待和管理数据</strong>。数据本身是一样的，但不同的人 / 层次看它的重点不同。</p><table><thead><tr><th style="text-align:center">视角</th><th style="text-align:center">关注点</th><th style="text-align:center">例如</th></tr></thead><tbody><tr><td style="text-align:center">物理视角</td><td style="text-align:center">数据<strong>怎么存在磁盘上</strong>，存储细节</td><td style="text-align:center">文件组织、索引结构、磁盘块管理</td></tr><tr><td style="text-align:center">逻辑视角</td><td style="text-align:center">数据<strong>怎么组织、联系</strong>，结构化表示</td><td style="text-align:center">表、列、外键</td></tr><tr><td style="text-align:center">用户视角</td><td style="text-align:center"><strong>用户需要看到什么数据</strong>，怎样屏蔽不相关的信息</td><td style="text-align:center">只显示学生姓名和成绩，不显示学号</td></tr></tbody></table><h4 id="数据抽象">数据抽象</h4><p>数据抽象就是<strong>数据视角的不同表达方式</strong>，也是指通过不同层次的抽象来隐藏数据的存储和实现细节，<strong>仅向用户展示必要的信息</strong>，从而简化数据库的设计、使用和维护。</p><p>数据抽象使得用户可以在不同层次上操作数据，<strong>而不必关心底层的物理存储结构或复杂的逻辑关系</strong>。</p><p>数据抽象有三层（ ANSI/SPARC 架构）：</p><ul><li><strong>物理层</strong><ul><li>数据在物理存储介质上的组织架构，涉及文件组织、索引、存储结构（ B+ 树等），优化存储效率和访问速度。</li></ul></li><li><strong>逻辑层</strong><ul><li>描述数据的完整组织逻辑，如表、关系、约束等。</li></ul></li><li><strong>视图层</strong><ul><li>针对用户，屏蔽掉一部分数据细节的层，例如规定哪些人可以看什么，哪些人不能看什么。</li></ul></li></ul><h4 id="数据模型">数据模型</h4><p>数据模型是描述数据、数据联系、数据意义、一致性约束的工具。</p><p>数据模型有<strong>数据结构</strong>（数据实体和它们的关系）、<strong>数据操作</strong>（ CURD ）、<strong>数据约束</strong>三部分。</p><p>数据模型主要有：</p><table><thead><tr><th style="text-align:center">数据模型</th><th style="text-align:center">解释</th></tr></thead><tbody><tr><td style="text-align:center">关系模型</td><td style="text-align:center">数据存在表格里（行和列），比如 MySQL、PostgreSQL</td></tr><tr><td style="text-align:center">实体-联系模型</td><td style="text-align:center">画图表示实体和它们之间的关系，常用于数据库设计阶段</td></tr><tr><td style="text-align:center">基于对象的数据模型</td><td style="text-align:center">数据看成对象（有属性、有方法），比如面向对象数据库</td></tr><tr><td style="text-align:center">半结构化数据模型</td><td style="text-align:center">数据不是固定表格的，比如JSON、XML这种</td></tr><tr><td style="text-align:center">网状数据模型</td><td style="text-align:center">数据通过复杂指针联系在一起，很像网络图</td></tr><tr><td style="text-align:center">层次数据模型</td><td style="text-align:center">数据是树状层级，比如父-子结构（早期的IBM IMS数据库用的）</td></tr></tbody></table><h4 id="实例和模式">实例和模式</h4><ul><li><p><strong>实例</strong>指的是<strong>存储的数据的集合</strong>，也叫快照。</p></li><li><p><strong>模式</strong>指的是数据库中<strong>存储和描述数据的格式</strong>，分为物理模式和逻辑模式两类，对应物理层和逻辑层。</p><ul><li>物理数据具有<strong>独立性</strong>，修改物理模式不会影响逻辑模式。例如把原本顺序存储的表，改成了用 B+ 树索引存储，但是上层应用（比如写 SQL 查学生表）完全不用改。</li></ul></li></ul><table><thead><tr><th style="text-align:center">概念</th><th style="text-align:center">解释</th></tr></thead><tbody><tr><td style="text-align:center">模式</td><td style="text-align:center"><strong>数据库的结构设计图</strong>。比如有哪些表、字段是什么类型、外键怎么关联（是“固定的结构”）。</td></tr><tr><td style="text-align:center">实例</td><td style="text-align:center"><strong>某一时刻数据库里实际存放的数据内容</strong>（是“活的数据”）。</td></tr></tbody></table><h3 id="数据库语言">数据库语言</h3><p>数据库语言是用来<strong>与数据库系统进行交流的语言</strong>，主要作用有两个：</p><ol><li>定义数据结构（表、字段、约束等）</li><li>操作数据内容（CURD）</li></ol><p>数据库语言由 DDL 和 DML 组成。</p><p>SQL 是使用最广泛的数据库语言，既包括 DDL，也包括 DML。</p><h4 id="DDL">DDL</h4><p>DDL 指的是 Data Definition Language ，<strong>数据定义语言</strong>。用于定义数据模式，规定一致性约束，授权用户。</p><h4 id="DML">DML</h4><p>DML 指的是 Data Manipulation Language ， <strong>数据操纵语言</strong>，用于数据的 CURD 。</p><h3 id="用户和管理员">用户和管理员</h3><p><img src="https://images.kisechan.space/image-20250329152731147.png" srcset="/img/loading.gif" lazyload alt="用户和管理员"></p><p>数据库用户不负责建结构、配置系统，他们主要分为：</p><table><thead><tr><th style="text-align:center">类型</th><th style="text-align:center">说明</th><th style="text-align:center">举例</th></tr></thead><tbody><tr><td style="text-align:center">无经验用户</td><td style="text-align:center">不懂数据库，靠界面操作</td><td style="text-align:center">电商APP用户、取款机客户</td></tr><tr><td style="text-align:center">应用程序员</td><td style="text-align:center">编写应用程序与数据库交互</td><td style="text-align:center">开发银行软件、ERP系统的工程师</td></tr><tr><td style="text-align:center">富有经验用户</td><td style="text-align:center">会写 SQL，直接用 DML 做复杂查询</td><td style="text-align:center">数据分析师、科研人员</td></tr><tr><td style="text-align:center">专业用户</td><td style="text-align:center">设计特殊用途的数据库系统</td><td style="text-align:center">机器学习、图数据库、CAD 系统开发者</td></tr></tbody></table><p>数据库管理员（ DBA, Database Administrator）是数据库的“管家”，负责整体管理、优化、维护、安全性等<strong>系统性任务</strong>：</p><table><thead><tr><th style="text-align:center">DBA 职责</th><th style="text-align:center">说明</th></tr></thead><tbody><tr><td style="text-align:center">定义模式</td><td style="text-align:center">创建数据库结构（表、字段、关系）</td></tr><tr><td style="text-align:center">定义存储结构</td><td style="text-align:center">决定用什么索引、分区、压缩策略等</td></tr><tr><td style="text-align:center">修改模式和物理组织</td><td style="text-align:center">随业务变化调整数据库结构</td></tr><tr><td style="text-align:center">设置访问权限</td><td style="text-align:center">决定谁能访问什么数据，保证数据安全</td></tr><tr><td style="text-align:center">监控性能和空间</td><td style="text-align:center">优化查询速度，防止磁盘爆满</td></tr><tr><td style="text-align:center">数据备份与恢复</td><td style="text-align:center">防止意外丢失数据，支持灾难恢复</td></tr></tbody></table><p>区分用户系统是为了防止危险操作、权责分明。</p><h2 id="关系模型">关系模型</h2><p><strong>数据</strong>是对客观事物的归纳，是记录或鉴别事物的符号，为事实或观测结果：</p><ul><li>归纳出<strong>共性</strong></li><li>抽象出<strong>个性</strong></li></ul><p>数据的基本结构有：</p><ul><li><strong>属性</strong>（ Attribute ）<ul><li>名字</li><li>取值域（ Domain ）</li><li>空值（ Null ）</li><li>原子性（ Atomic ）</li></ul></li><li><strong>关系</strong> （ Relation ）<ul><li>一个关系是若干<strong>属性域</strong>的<strong>笛卡尔积的子集</strong>。</li></ul></li></ul><h3 id="关系数据库的结构">关系数据库的结构</h3><h4 id="表">表</h4><p>关系数据库用“表”的形式来存储数据，每一个“表”就是一个“<strong>关系（Relation）</strong>”。</p><p>表是存储数据的二维结构，由<strong>表头（Schema）</strong>，列名和数据类型和<strong>表体（Instance）</strong>，具体的数据行组成。</p><h4 id="关系模式">关系模式</h4><p>关系模式是表的结构定义，包括：</p><ul><li>表名</li><li>属性名和数据结构</li><li>完整性约束</li></ul><h4 id="关系实例">关系实例</h4><p>是某一时刻表中的具体数据，是表的快照。</p><hr><table><thead><tr><th style="text-align:center">概念</th><th style="text-align:center">含义</th><th style="text-align:center">举例</th></tr></thead><tbody><tr><td style="text-align:center">关系</td><td style="text-align:center">一个<strong>二维表</strong></td><td style="text-align:center">学生表、员工表</td></tr><tr><td style="text-align:center">关系模式</td><td style="text-align:center">表的<strong>结构定义</strong>（字段名、数据类型、约束）</td><td style="text-align:center">学生(学号, 姓名, 年龄)</td></tr><tr><td style="text-align:center">关系实例</td><td style="text-align:center">表中某个时间点的<strong>数据内容</strong>（若干行）</td><td style="text-align:center">某一时刻，学生表中有 5 条记录</td></tr><tr><td style="text-align:center">表</td><td style="text-align:center"><strong>实际存储数据的结构</strong>；就是“关系”的表现形式</td><td style="text-align:center"><code>Student</code> 表</td></tr><tr><td style="text-align:center">关系数据库</td><td style="text-align:center"><strong>一组相关的表组成的</strong>数据库系统</td><td style="text-align:center">有学生表、课程表、选课表等</td></tr></tbody></table><h4 id="码">码</h4><p>码是用于<strong>唯一标识或建立关系的属性</strong>（列），主要有：</p><ul><li><strong>超码</strong><ul><li>一个或多个属性的集合，其中可能包含冗余属性</li><li>可在一个关系中唯一标识一个元组</li></ul></li><li><strong>候选码</strong><ul><li>标识一个元组的最小属性集合</li><li>一个表可以有多个候选码</li></ul></li><li><strong>主码</strong><ul><li>候选码中选出的唯一标识符</li><li>不能为 <code>NULL</code> ，且值唯一</li></ul></li><li><strong>外码</strong><ul><li>本关系/表中的某个属性恰好是另外一个关系里的主码</li><li>建立表间关系</li></ul></li></ul><hr><table><thead><tr><th style="text-align:center">名称</th><th style="text-align:center">定义</th><th style="text-align:center">说明</th></tr></thead><tbody><tr><td style="text-align:center">超码</td><td style="text-align:center">能唯一标识元组的属性<strong>集合</strong></td><td style="text-align:center">可以是多个字段组成</td></tr><tr><td style="text-align:center">候选码</td><td style="text-align:center"><strong>最小的超码</strong>，不能去掉字段</td><td style="text-align:center">可能有多个</td></tr><tr><td style="text-align:center">主码</td><td style="text-align:center">从候选码中选出的“主键”</td><td style="text-align:center">唯一、非空、不变</td></tr><tr><td style="text-align:center">外码</td><td style="text-align:center">指向另一个关系主码的属性</td><td style="text-align:center">用于建立表与表之间的联系</td></tr></tbody></table><pre><code class="mermaid">graph TD
    A[超码] --&gt; B[候选码]
    B --&gt; C[主码]
    D[外码] -. 是另一个表的主码 .-&gt; C

    B --&gt; F[其他候选码]

</code></pre><h4 id="模式图">模式图</h4><p>模式图是一个 <strong>图形化工具</strong>，表示一个关系数据库中各个关系（表）之间的结构与联系。</p><p>要素包括：</p><ul><li>每个矩形代表一个关系（表）；</li><li>每个矩形中列出该表的<strong>属性</strong>（字段）；<ul><li>主码一般加下划线；</li><li>外码一般用箭头指向它所引用的主码；</li></ul></li><li>箭头用于表示外码 → 主码的<strong>引用关系</strong>。</li></ul><p><img src="https://images.kisechan.space/schema-diagram.png" srcset="/img/loading.gif" lazyload alt="模式图（Schema Diagram）"></p><h3 id="关系代数">关系代数</h3><p>数据库查询语言是<strong>描述和访问数据库的功能</strong>。分为：</p><ul><li><strong>非过程化语言/描述式语言</strong><ul><li>只需要声明想要的结果，不需要过程。</li><li>用户只需要描述所需要的数据，查询系统会根据系统的优化器自动选择执行策略。</li><li><strong>SQL</strong> 是最典型的<strong>非过程化语言</strong>，你只需要描述你想要查询的数据，数据库系统会负责如何执行这个查询。</li></ul></li><li><strong>过程化语言</strong><ul><li>需要精确控制操作。</li><li><strong>关系代数</strong> 就是<strong>过程化语言</strong>的一种。你需要通过一系列操作来获取数据，比如选择、投影、联接等。</li></ul></li></ul><p>关系代数有六种基本运算和一些附加运算：</p><table><thead><tr><th style="text-align:center">运算</th><th style="text-align:center">符号</th><th style="text-align:center">描述</th><th style="text-align:center">示例</th><th style="text-align:center">功能说明</th></tr></thead><tbody><tr><td style="text-align:center">选择</td><td style="text-align:center"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>σ</mi></mrow><annotation encoding="application/x-tex">\sigma</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.4306em"></span><span class="mord mathnormal" style="margin-right:.03588em">σ</span></span></span></span></td><td style="text-align:center">从关系中选出满足条件的元组（行）</td><td style="text-align:center"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>σ</mi><mrow><mtext>age</mtext><mo>&gt;</mo><mn>30</mn></mrow></msub><mo stretchy="false">(</mo><mtext>Employee</mtext><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">\sigma_{\text{age} &gt; 30}(\text{Employee})</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.0361em;vertical-align:-.2861em"></span><span class="mord"><span class="mord mathnormal" style="margin-right:.03588em">σ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.3011em"><span style="top:-2.55em;margin-left:-.0359em;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord text mtight"><span class="mord mtight">age</span></span><span class="mrel mtight">&gt;</span><span class="mord mtight">30</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.2861em"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord text"><span class="mord">Employee</span></span><span class="mclose">)</span></span></span></span></td><td style="text-align:center">选出年龄大于30的员工</td></tr><tr><td style="text-align:center">投影</td><td style="text-align:center"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="normal">Π</mi></mrow><annotation encoding="application/x-tex">\Pi</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.6833em"></span><span class="mord">Π</span></span></span></span></td><td style="text-align:center">从关系中选出特定的属性（列）（去重）</td><td style="text-align:center"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi mathvariant="normal">Π</mi><mtext>name,&nbsp;salary</mtext></msub><mo stretchy="false">(</mo><mtext>Employee</mtext><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">\Pi_{\text{name, salary}}(\text{Employee})</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.0361em;vertical-align:-.2861em"></span><span class="mord"><span class="mord">Π</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.3361em"><span style="top:-2.55em;margin-left:0;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord text mtight"><span class="mord mtight">name,&nbsp;salary</span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.2861em"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord text"><span class="mord">Employee</span></span><span class="mclose">)</span></span></span></span></td><td style="text-align:center">只显示姓名和薪水字段</td></tr><tr><td style="text-align:center">并集</td><td style="text-align:center"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>∪</mo></mrow><annotation encoding="application/x-tex">\cup</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.5556em"></span><span class="mord">∪</span></span></span></span></td><td style="text-align:center">取两个关系中所有的元组（去重合并）</td><td style="text-align:center"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>R</mtext><mo>∪</mo><mtext>S</mtext></mrow><annotation encoding="application/x-tex">\text{R} \cup \text{S}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.6833em"></span><span class="mord text"><span class="mord">R</span></span><span class="mspace" style="margin-right:.2222em"></span><span class="mbin">∪</span><span class="mspace" style="margin-right:.2222em"></span></span><span class="base"><span class="strut" style="height:.6833em"></span><span class="mord text"><span class="mord">S</span></span></span></span></span></td><td style="text-align:center">合并两个结构相同的关系</td></tr><tr><td style="text-align:center">差集</td><td style="text-align:center"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>−</mo></mrow><annotation encoding="application/x-tex">-</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.6667em;vertical-align:-.0833em"></span><span class="mord">−</span></span></span></span></td><td style="text-align:center">得到只属于第一个关系的元组</td><td style="text-align:center"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>R</mtext><mo>−</mo><mtext>S</mtext></mrow><annotation encoding="application/x-tex">\text{R} - \text{S}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.7667em;vertical-align:-.0833em"></span><span class="mord text"><span class="mord">R</span></span><span class="mspace" style="margin-right:.2222em"></span><span class="mbin">−</span><span class="mspace" style="margin-right:.2222em"></span></span><span class="base"><span class="strut" style="height:.6833em"></span><span class="mord text"><span class="mord">S</span></span></span></span></span></td><td style="text-align:center">从<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>R</mi></mrow><annotation encoding="application/x-tex">R</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.6833em"></span><span class="mord mathnormal" style="margin-right:.00773em">R</span></span></span></span>中去除所有也属于<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>S</mi></mrow><annotation encoding="application/x-tex">S</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.6833em"></span><span class="mord mathnormal" style="margin-right:.05764em">S</span></span></span></span>的元组</td></tr><tr><td style="text-align:center">乘积</td><td style="text-align:center"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>×</mo></mrow><annotation encoding="application/x-tex">\times</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.6667em;vertical-align:-.0833em"></span><span class="mord">×</span></span></span></span></td><td style="text-align:center">将两个关系的元组两两组合</td><td style="text-align:center"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>R</mtext><mo>×</mo><mtext>S</mtext></mrow><annotation encoding="application/x-tex">\text{R} \times \text{S}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.7667em;vertical-align:-.0833em"></span><span class="mord text"><span class="mord">R</span></span><span class="mspace" style="margin-right:.2222em"></span><span class="mbin">×</span><span class="mspace" style="margin-right:.2222em"></span></span><span class="base"><span class="strut" style="height:.6833em"></span><span class="mord text"><span class="mord">S</span></span></span></span></span></td><td style="text-align:center">用于构造连接</td></tr><tr><td style="text-align:center">换名</td><td style="text-align:center"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>ρ</mi></mrow><annotation encoding="application/x-tex">\rho</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.625em;vertical-align:-.1944em"></span><span class="mord mathnormal">ρ</span></span></span></span></td><td style="text-align:center">给关系或属性重新命名</td><td style="text-align:center"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>ρ</mi><mrow><mi>S</mi><mo stretchy="false">(</mo><mi>a</mi><mo separator="true">,</mo><mi>b</mi><mo stretchy="false">)</mo></mrow></msub><mo stretchy="false">(</mo><mi>R</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">\rho_{S(a, b)}(R)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.1052em;vertical-align:-.3552em"></span><span class="mord"><span class="mord mathnormal">ρ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.3448em"><span style="top:-2.5198em;margin-left:0;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:.05764em">S</span><span class="mopen mtight">(</span><span class="mord mathnormal mtight">a</span><span class="mpunct mtight">,</span><span class="mord mathnormal mtight">b</span><span class="mclose mtight">)</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.3552em"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:.00773em">R</span><span class="mclose">)</span></span></span></span></td><td style="text-align:center">将关系<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>R</mi></mrow><annotation encoding="application/x-tex">R</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.6833em"></span><span class="mord mathnormal" style="margin-right:.00773em">R</span></span></span></span>重命名为<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>S</mi></mrow><annotation encoding="application/x-tex">S</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.6833em"></span><span class="mord mathnormal" style="margin-right:.05764em">S</span></span></span></span>，属性改为<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>a</mi></mrow><annotation encoding="application/x-tex">a</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.4306em"></span><span class="mord mathnormal">a</span></span></span></span>和<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>b</mi></mrow><annotation encoding="application/x-tex">b</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.6944em"></span><span class="mord mathnormal">b</span></span></span></span></td></tr></tbody></table><h4 id="选择">选择</h4><p class="katex-block"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><msub><mi>σ</mi><mi>p</mi></msub><mo stretchy="false">(</mo><mi>r</mi><mo stretchy="false">)</mo><mo>=</mo><mo stretchy="false">{</mo><mi>t</mi><mi mathvariant="normal">∣</mi><mi>t</mi><mo>∈</mo><mi>r</mi><mtext>且</mtext><mi>p</mi><mo stretchy="false">(</mo><mi>t</mi><mo stretchy="false">)</mo><mtext>成立</mtext><mo stretchy="false">}</mo></mrow><annotation encoding="application/x-tex">\sigma_p(r)=\{t|t\in r且p(t)成立\}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.0361em;vertical-align:-.2861em"></span><span class="mord"><span class="mord mathnormal" style="margin-right:.03588em">σ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.1514em"><span style="top:-2.55em;margin-left:-.0359em;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">p</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.2861em"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:.02778em">r</span><span class="mclose">)</span><span class="mspace" style="margin-right:.2778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right:.2778em"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-.25em"></span><span class="mopen">{</span><span class="mord mathnormal">t</span><span class="mord">∣</span><span class="mord mathnormal">t</span><span class="mspace" style="margin-right:.2778em"></span><span class="mrel">∈</span><span class="mspace" style="margin-right:.2778em"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-.25em"></span><span class="mord mathnormal" style="margin-right:.02778em">r</span><span class="mord cjk_fallback">且</span><span class="mord mathnormal">p</span><span class="mopen">(</span><span class="mord mathnormal">t</span><span class="mclose">)</span><span class="mord cjk_fallback">成立</span><span class="mclose">}</span></span></span></span></span></p><p>其中 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>p</mi></mrow><annotation encoding="application/x-tex">p</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.625em;vertical-align:-.1944em"></span><span class="mord mathnormal">p</span></span></span></span> 为查询条件，由<strong>项目</strong>及项目之间的逻辑运算组成。其中，项目指的是：属性大于、小于（等）属性或常数。</p><h4 id="投影">投影</h4><p class="katex-block"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><msub><mi mathvariant="normal">Π</mi><mrow><msub><mi>A</mi><mn>1</mn></msub><mo separator="true">,</mo><msub><mi>A</mi><mn>2</mn></msub><mo separator="true">,</mo><mi mathvariant="normal">.</mi><mi mathvariant="normal">.</mi><mi mathvariant="normal">.</mi><mo separator="true">,</mo><msub><mi>A</mi><mi>k</mi></msub></mrow></msub><mo stretchy="false">(</mo><mi>r</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">\Pi_{A_1,A_2,...,A_k}(r)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.0361em;vertical-align:-.2861em"></span><span class="mord"><span class="mord">Π</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.3283em"><span style="top:-2.55em;margin-left:0;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight">A</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.3173em"><span style="top:-2.357em;margin-left:0;margin-right:.0714em"><span class="pstrut" style="height:2.5em"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.143em"><span></span></span></span></span></span></span><span class="mpunct mtight">,</span><span class="mord mtight"><span class="mord mathnormal mtight">A</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.3173em"><span style="top:-2.357em;margin-left:0;margin-right:.0714em"><span class="pstrut" style="height:2.5em"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.143em"><span></span></span></span></span></span></span><span class="mpunct mtight">,</span><span class="mord mtight">...</span><span class="mpunct mtight">,</span><span class="mord mtight"><span class="mord mathnormal mtight">A</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.3448em"><span style="top:-2.3488em;margin-left:0;margin-right:.0714em"><span class="pstrut" style="height:2.5em"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathnormal mtight" style="margin-right:.03148em">k</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.1512em"><span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.2861em"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:.02778em">r</span><span class="mclose">)</span></span></span></span></span></p><p>其中， <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>A</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">A_i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.8333em;vertical-align:-.15em"></span><span class="mord"><span class="mord mathnormal">A</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.3117em"><span style="top:-2.55em;margin-left:0;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.15em"><span></span></span></span></span></span></span></span></span></span> 为属性名。它的结果是：</p><ul><li>只包含给出的属性的一张 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>k</mi></mrow><annotation encoding="application/x-tex">k</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.6944em"></span><span class="mord mathnormal" style="margin-right:.03148em">k</span></span></span></span> 列的表</li><li>去掉了重复行</li></ul><h4 id="并集">并集</h4><p class="katex-block"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>r</mi><mo>∪</mo><mi>s</mi><mo>=</mo><mo stretchy="false">{</mo><mi>t</mi><mi mathvariant="normal">∣</mi><mi>t</mi><mo>∈</mo><mi>r</mi><mtext>或</mtext><mi>t</mi><mo>∈</mo><mi>s</mi><mo stretchy="false">}</mo></mrow><annotation encoding="application/x-tex">r\cup s=\{t|t \in r或t\in s\}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.5556em"></span><span class="mord mathnormal" style="margin-right:.02778em">r</span><span class="mspace" style="margin-right:.2222em"></span><span class="mbin">∪</span><span class="mspace" style="margin-right:.2222em"></span></span><span class="base"><span class="strut" style="height:.4306em"></span><span class="mord mathnormal">s</span><span class="mspace" style="margin-right:.2778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right:.2778em"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-.25em"></span><span class="mopen">{</span><span class="mord mathnormal">t</span><span class="mord">∣</span><span class="mord mathnormal">t</span><span class="mspace" style="margin-right:.2778em"></span><span class="mrel">∈</span><span class="mspace" style="margin-right:.2778em"></span></span><span class="base"><span class="strut" style="height:.7224em;vertical-align:-.0391em"></span><span class="mord mathnormal" style="margin-right:.02778em">r</span><span class="mord cjk_fallback">或</span><span class="mord mathnormal">t</span><span class="mspace" style="margin-right:.2778em"></span><span class="mrel">∈</span><span class="mspace" style="margin-right:.2778em"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-.25em"></span><span class="mord mathnormal">s</span><span class="mclose">}</span></span></span></span></span></p><p>要求：</p><ul><li>属性个数相同</li><li>属性域兼容（也就是得对应，数据对数据字符串对字符串）</li></ul><p><img src="https://images.kisechan.space/image-20250329161423557.png" srcset="/img/loading.gif" lazyload alt="并集"></p><h4 id="差集">差集</h4><p class="katex-block"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>r</mi><mo>−</mo><mi>s</mi><mo>=</mo><mo stretchy="false">{</mo><mi>t</mi><mi mathvariant="normal">∣</mi><mi>t</mi><mo>∈</mo><mi>r</mi><mtext>且</mtext><mi>t</mi><mo mathvariant="normal">∉</mo><mi>s</mi><mo stretchy="false">}</mo></mrow><annotation encoding="application/x-tex">r-s=\{t|t \in r且t\notin s\}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.6667em;vertical-align:-.0833em"></span><span class="mord mathnormal" style="margin-right:.02778em">r</span><span class="mspace" style="margin-right:.2222em"></span><span class="mbin">−</span><span class="mspace" style="margin-right:.2222em"></span></span><span class="base"><span class="strut" style="height:.4306em"></span><span class="mord mathnormal">s</span><span class="mspace" style="margin-right:.2778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right:.2778em"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-.25em"></span><span class="mopen">{</span><span class="mord mathnormal">t</span><span class="mord">∣</span><span class="mord mathnormal">t</span><span class="mspace" style="margin-right:.2778em"></span><span class="mrel">∈</span><span class="mspace" style="margin-right:.2778em"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-.25em"></span><span class="mord mathnormal" style="margin-right:.02778em">r</span><span class="mord cjk_fallback">且</span><span class="mord mathnormal">t</span><span class="mspace" style="margin-right:.2778em"></span><span class="mrel"><span class="mord"><span class="mrel">∈</span></span><span class="mord vbox"><span class="thinbox"><span class="llap"><span class="strut" style="height:1em;vertical-align:-.25em"></span><span class="inner"><span class="mord"><span class="mord">/</span><span class="mspace" style="margin-right:.0556em"></span></span></span><span class="fix"></span></span></span></span></span><span class="mspace" style="margin-right:.2778em"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-.25em"></span><span class="mord mathnormal">s</span><span class="mclose">}</span></span></span></span></span></p><p>要求同并集。</p><h4 id="笛卡尔积">笛卡尔积</h4><p class="katex-block"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>r</mi><mo>×</mo><mi>s</mi><mo>=</mo><mo stretchy="false">{</mo><mi>t</mi><mi>q</mi><mi mathvariant="normal">∣</mi><mi>t</mi><mo>∈</mo><mi>r</mi><mtext>且</mtext><mi>q</mi><mo>∈</mo><mi>s</mi><mo stretchy="false">}</mo></mrow><annotation encoding="application/x-tex">r\times s=\{tq|t\in r且q\in s\}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.6667em;vertical-align:-.0833em"></span><span class="mord mathnormal" style="margin-right:.02778em">r</span><span class="mspace" style="margin-right:.2222em"></span><span class="mbin">×</span><span class="mspace" style="margin-right:.2222em"></span></span><span class="base"><span class="strut" style="height:.4306em"></span><span class="mord mathnormal">s</span><span class="mspace" style="margin-right:.2778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right:.2778em"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-.25em"></span><span class="mopen">{</span><span class="mord mathnormal" style="margin-right:.03588em">tq</span><span class="mord">∣</span><span class="mord mathnormal">t</span><span class="mspace" style="margin-right:.2778em"></span><span class="mrel">∈</span><span class="mspace" style="margin-right:.2778em"></span></span><span class="base"><span class="strut" style="height:.8778em;vertical-align:-.1944em"></span><span class="mord mathnormal" style="margin-right:.02778em">r</span><span class="mord cjk_fallback">且</span><span class="mord mathnormal" style="margin-right:.03588em">q</span><span class="mspace" style="margin-right:.2778em"></span><span class="mrel">∈</span><span class="mspace" style="margin-right:.2778em"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-.25em"></span><span class="mord mathnormal">s</span><span class="mclose">}</span></span></span></span></span></p><p>要求：</p><ul><li><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>r</mi><mo>∩</mo><mi>s</mi><mo>=</mo><mi mathvariant="normal">∅</mi></mrow><annotation encoding="application/x-tex">r\cap s=\emptyset</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.5556em"></span><span class="mord mathnormal" style="margin-right:.02778em">r</span><span class="mspace" style="margin-right:.2222em"></span><span class="mbin">∩</span><span class="mspace" style="margin-right:.2222em"></span></span><span class="base"><span class="strut" style="height:.4306em"></span><span class="mord mathnormal">s</span><span class="mspace" style="margin-right:.2778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right:.2778em"></span></span><span class="base"><span class="strut" style="height:.8056em;vertical-align:-.0556em"></span><span class="mord">∅</span></span></span></span></li><li>否则就要把交叉共有的那个属性换名</li></ul><p><img src="https://images.kisechan.space/image-20250329161858069.png" srcset="/img/loading.gif" lazyload alt="笛卡尔积"></p><h4 id="换名">换名</h4><p class="katex-block"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><msub><mi>ρ</mi><mrow><mi>x</mi><mo stretchy="false">(</mo><msub><mi>A</mi><mn>1</mn></msub><mo separator="true">,</mo><msub><mi>A</mi><mn>2</mn></msub><mo separator="true">,</mo><mi mathvariant="normal">.</mi><mi mathvariant="normal">.</mi><mi mathvariant="normal">.</mi><mo separator="true">,</mo><msub><mi>A</mi><mi>n</mi></msub><mo stretchy="false">)</mo></mrow></msub><mo stretchy="false">(</mo><mi>E</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">\rho_{x(A_1,A_2,...,A_n)}(E)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.1052em;vertical-align:-.3552em"></span><span class="mord"><span class="mord mathnormal">ρ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.3448em"><span style="top:-2.5198em;margin-left:0;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">x</span><span class="mopen mtight">(</span><span class="mord mtight"><span class="mord mathnormal mtight">A</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.3173em"><span style="top:-2.357em;margin-left:0;margin-right:.0714em"><span class="pstrut" style="height:2.5em"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.143em"><span></span></span></span></span></span></span><span class="mpunct mtight">,</span><span class="mord mtight"><span class="mord mathnormal mtight">A</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.3173em"><span style="top:-2.357em;margin-left:0;margin-right:.0714em"><span class="pstrut" style="height:2.5em"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.143em"><span></span></span></span></span></span></span><span class="mpunct mtight">,</span><span class="mord mtight">...</span><span class="mpunct mtight">,</span><span class="mord mtight"><span class="mord mathnormal mtight">A</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.1645em"><span style="top:-2.357em;margin-left:0;margin-right:.0714em"><span class="pstrut" style="height:2.5em"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathnormal mtight">n</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.143em"><span></span></span></span></span></span></span><span class="mclose mtight">)</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.3552em"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:.05764em">E</span><span class="mclose">)</span></span></span></span></span></p><p>将结果的名字换为 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>x</mi></mrow><annotation encoding="application/x-tex">x</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.4306em"></span><span class="mord mathnormal">x</span></span></span></span> ，且各个属性换名为 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>A</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">A_i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.8333em;vertical-align:-.15em"></span><span class="mord"><span class="mord mathnormal">A</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.3117em"><span style="top:-2.55em;margin-left:0;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.15em"><span></span></span></span></span></span></span></span></span></span> 。</p><hr><div class="note note-primary"><p>以下是<strong>扩展的关系运算</strong>。</p><p>增加了算术运算和空值处理的能力。</p></div><hr><h4 id="交集">交集</h4><p class="katex-block"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>r</mi><mo>∩</mo><mi>s</mi><mo>=</mo><mo stretchy="false">{</mo><mi>t</mi><mi mathvariant="normal">∣</mi><mi>t</mi><mo>∈</mo><mi>r</mi><mtext>且</mtext><mi>t</mi><mo>∈</mo><mi>s</mi><mo stretchy="false">}</mo></mrow><annotation encoding="application/x-tex">r\cap s=\{t|t \in r且t\in s\}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.5556em"></span><span class="mord mathnormal" style="margin-right:.02778em">r</span><span class="mspace" style="margin-right:.2222em"></span><span class="mbin">∩</span><span class="mspace" style="margin-right:.2222em"></span></span><span class="base"><span class="strut" style="height:.4306em"></span><span class="mord mathnormal">s</span><span class="mspace" style="margin-right:.2778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right:.2778em"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-.25em"></span><span class="mopen">{</span><span class="mord mathnormal">t</span><span class="mord">∣</span><span class="mord mathnormal">t</span><span class="mspace" style="margin-right:.2778em"></span><span class="mrel">∈</span><span class="mspace" style="margin-right:.2778em"></span></span><span class="base"><span class="strut" style="height:.7224em;vertical-align:-.0391em"></span><span class="mord mathnormal" style="margin-right:.02778em">r</span><span class="mord cjk_fallback">且</span><span class="mord mathnormal">t</span><span class="mspace" style="margin-right:.2778em"></span><span class="mrel">∈</span><span class="mspace" style="margin-right:.2778em"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-.25em"></span><span class="mord mathnormal">s</span><span class="mclose">}</span></span></span></span></span></p><p>要求同并集。</p><h4 id="自然连接">自然连接</h4><p class="katex-block katex-error" title="ParseError: KaTeX parse error: No such environment: eqnarray at position 7: \begin{̲e̲q̲n̲a̲r̲r̲a̲y̲}̲
r\Join s&amp;=&amp;\{t…">\begin{eqnarray} r\Join s&amp;=&amp;\{tq|t\in r且q\in s且t[R\cap S]=s[R\cap S] \}\nonumber \\ ~&amp;=&amp; \Pi_{R\cup S}(\sigma_{\sum r.A_i=s.A_i}(r\times s)) \end{eqnarray}</p><p>其中， <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>R</mi></mrow><annotation encoding="application/x-tex">R</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.6833em"></span><span class="mord mathnormal" style="margin-right:.00773em">R</span></span></span></span> 、 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>S</mi></mrow><annotation encoding="application/x-tex">S</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.6833em"></span><span class="mord mathnormal" style="margin-right:.05764em">S</span></span></span></span> 为关系模式。</p><p>就是自动合并两张列属性<strong>完全相同</strong>的表。</p><blockquote><p>对于两张表：</p><ul><li>Employee（员工）</li></ul><table><thead><tr><th style="text-align:center">emp_id</th><th style="text-align:center">name</th><th style="text-align:center">dept_id</th></tr></thead><tbody><tr><td style="text-align:center">1</td><td style="text-align:center">Alice</td><td style="text-align:center">10</td></tr><tr><td style="text-align:center">2</td><td style="text-align:center">Bob</td><td style="text-align:center">20</td></tr><tr><td style="text-align:center">3</td><td style="text-align:center">Carol</td><td style="text-align:center">10</td></tr></tbody></table><ul><li>Department（部门）</li></ul><table><thead><tr><th style="text-align:center">dept_id</th><th style="text-align:center">dept_name</th></tr></thead><tbody><tr><td style="text-align:center">10</td><td style="text-align:center">Sales</td></tr><tr><td style="text-align:center">20</td><td style="text-align:center">HR</td></tr><tr><td style="text-align:center">30</td><td style="text-align:center">IT</td></tr></tbody></table><p>使用自然连接操作：</p><p class="katex-block"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mtext>Employee⨝Department</mtext></mrow><annotation encoding="application/x-tex">\text{Employee} ⨝ \text{Department}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.8889em;vertical-align:-.1944em"></span><span class="mord text"><span class="mord">Employee</span></span><span class="mord">⨝</span><span class="mord text"><span class="mord">Department</span></span></span></span></span></span></p><p>合并的结果是：</p><table><thead><tr><th style="text-align:center">emp_id</th><th style="text-align:center">name</th><th style="text-align:center">dept_id</th><th style="text-align:center">dept_name</th></tr></thead><tbody><tr><td style="text-align:center">1</td><td style="text-align:center">Alice</td><td style="text-align:center">10</td><td style="text-align:center">Sales</td></tr><tr><td style="text-align:center">2</td><td style="text-align:center">Bob</td><td style="text-align:center">20</td><td style="text-align:center">HR</td></tr><tr><td style="text-align:center">3</td><td style="text-align:center">Carol</td><td style="text-align:center">10</td><td style="text-align:center">Sales</td></tr></tbody></table></blockquote><h4 id="theta-连接"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>θ</mi></mrow><annotation encoding="application/x-tex">\theta</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.6944em"></span><span class="mord mathnormal" style="margin-right:.02778em">θ</span></span></span></span> 连接</h4><p class="katex-block"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>r</mi><msub><mo>⋈</mo><mi>θ</mi></msub><mi>s</mi><mo>=</mo><msub><mi>σ</mi><mi>θ</mi></msub><mo stretchy="false">(</mo><mi>r</mi><mo>×</mo><mi>s</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">r\Join_\theta s=\sigma_\theta (r\times s)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.655em;vertical-align:-.15em"></span><span class="mord mathnormal" style="margin-right:.02778em">r</span><span class="mspace" style="margin-right:.2778em"></span><span class="mrel"><span class="mrel">⋈</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.3361em"><span style="top:-2.55em;margin-left:0;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:.02778em">θ</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.15em"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:.2778em"></span></span><span class="base"><span class="strut" style="height:.4306em"></span><span class="mord mathnormal">s</span><span class="mspace" style="margin-right:.2778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right:.2778em"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-.25em"></span><span class="mord"><span class="mord mathnormal" style="margin-right:.03588em">σ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.3361em"><span style="top:-2.55em;margin-left:-.0359em;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:.02778em">θ</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.15em"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:.02778em">r</span><span class="mspace" style="margin-right:.2222em"></span><span class="mbin">×</span><span class="mspace" style="margin-right:.2222em"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-.25em"></span><span class="mord mathnormal">s</span><span class="mclose">)</span></span></span></span></span></p><p>按照给出的 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>θ</mi></mrow><annotation encoding="application/x-tex">\theta</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.6944em"></span><span class="mord mathnormal" style="margin-right:.02778em">θ</span></span></span></span> 条件将两张表合并。</p><blockquote><p>延续上面的例子，如果对两张表采用操作：</p><p class="katex-block"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mtext>Employee</mtext><msub><mtext>⨝</mtext><mrow><mtext>Employee</mtext><mi mathvariant="normal">.</mi><msub><mtext>dept</mtext><mtext>id</mtext></msub><mo mathvariant="normal">≠</mo><mtext>Department</mtext><mi mathvariant="normal">.</mi><msub><mtext>dept</mtext><mtext>id</mtext></msub></mrow></msub><mtext>Department</mtext></mrow><annotation encoding="application/x-tex">\text{Employee} ⨝_{\text{Employee}.\text{dept}_\text{id} \ne \text{Department}.\text{dept}_\text{id}} \text{Department}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.0305em;vertical-align:-.3361em"></span><span class="mord text"><span class="mord">Employee</span></span><span class="mord"><span class="mord">⨝</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.3361em"><span style="top:-2.55em;margin-left:0;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord text mtight"><span class="mord mtight">Employee</span></span><span class="mord mtight">.</span><span class="mord mtight"><span class="mord text mtight"><span class="mord mtight">dept</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.2302em"><span style="top:-2.2341em;margin-right:.0714em"><span class="pstrut" style="height:2.5em"></span><span class="sizing reset-size3 size1 mtight"><span class="mord text mtight"><span class="mord mtight">id</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.2659em"><span></span></span></span></span></span></span><span class="mrel mtight"><span class="mrel mtight"><span class="mord vbox mtight"><span class="thinbox mtight"><span class="rlap mtight"><span class="strut" style="height:.8889em;vertical-align:-.1944em"></span><span class="inner"><span class="mord mtight"><span class="mrel mtight"></span></span></span><span class="fix"></span></span></span></span></span><span class="mrel mtight">=</span></span><span class="mord text mtight"><span class="mord mtight">Department</span></span><span class="mord mtight">.</span><span class="mord mtight"><span class="mord text mtight"><span class="mord mtight">dept</span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.2302em"><span style="top:-2.2341em;margin-right:.0714em"><span class="pstrut" style="height:2.5em"></span><span class="sizing reset-size3 size1 mtight"><span class="mord text mtight"><span class="mord mtight">id</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.2659em"><span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.3361em"><span></span></span></span></span></span></span><span class="mord text"><span class="mord">Department</span></span></span></span></span></span></p><p>这个操作即<strong>找出所有员工和部门编号不一样的组合</strong>（而不是一样），并将它们合并。</p><p>结果是：</p><table><thead><tr><th style="text-align:center">emp_id</th><th style="text-align:center">name</th><th style="text-align:center">dept_id (Employee)</th><th style="text-align:center">dept_id (Department)</th><th style="text-align:center">dept_name</th></tr></thead><tbody><tr><td style="text-align:center">1</td><td style="text-align:center">Alice</td><td style="text-align:center">10</td><td style="text-align:center">20</td><td style="text-align:center">HR</td></tr><tr><td style="text-align:center">1</td><td style="text-align:center">Alice</td><td style="text-align:center">10</td><td style="text-align:center">30</td><td style="text-align:center">IT</td></tr><tr><td style="text-align:center">2</td><td style="text-align:center">Bob</td><td style="text-align:center">20</td><td style="text-align:center">10</td><td style="text-align:center">Sales</td></tr><tr><td style="text-align:center">2</td><td style="text-align:center">Bob</td><td style="text-align:center">20</td><td style="text-align:center">30</td><td style="text-align:center">IT</td></tr><tr><td style="text-align:center">3</td><td style="text-align:center">Carol</td><td style="text-align:center">10</td><td style="text-align:center">20</td><td style="text-align:center">HR</td></tr><tr><td style="text-align:center">3</td><td style="text-align:center">Carol</td><td style="text-align:center">10</td><td style="text-align:center">30</td><td style="text-align:center">IT</td></tr></tbody></table><p>可以注意到它并没有将相同的列名合并。</p></blockquote><hr><table><thead><tr><th style="text-align:center"></th><th style="text-align:center">自然连接</th><th style="text-align:center"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>θ</mi></mrow><annotation encoding="application/x-tex">\theta</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.6944em"></span><span class="mord mathnormal" style="margin-right:.02778em">θ</span></span></span></span> 连接</th></tr></thead><tbody><tr><td style="text-align:center">连接条件</td><td style="text-align:center"><strong>自动</strong>基于<strong>相同名字的属性</strong>进行匹配</td><td style="text-align:center">人工<strong>指定任意条件</strong></td></tr><tr><td style="text-align:center">结果</td><td style="text-align:center">合并两表相同列，避免重复显示</td><td style="text-align:center">直接按指定条件连接，两表列通常全保留</td></tr><tr><td style="text-align:center">典型符号</td><td style="text-align:center"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>⋈</mo></mrow><annotation encoding="application/x-tex">\bowtie</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.51em;vertical-align:-.005em"></span><span class="mrel">⋈</span></span></span></span></td><td style="text-align:center"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mo>⋈</mo><mi>θ</mi></msub></mrow><annotation encoding="application/x-tex">\bowtie_{\theta}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.655em;vertical-align:-.15em"></span><span class="mrel"><span class="mrel">⋈</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.3361em"><span style="top:-2.55em;margin-left:0;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:.02778em">θ</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.15em"><span></span></span></span></span></span></span></span></span></span></td></tr><tr><td style="text-align:center">简单理解</td><td style="text-align:center">自动对相同字段合并</td><td style="text-align:center">手动指定如何连接</td></tr></tbody></table><h4 id="赋值">赋值</h4><p class="katex-block"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mo>←</mo></mrow><annotation encoding="application/x-tex">\gets</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.3669em"></span><span class="mrel">←</span></span></span></span></span></p><p>字面意思。</p><h4 id="除">除</h4><p class="katex-block"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>r</mi><mo>÷</mo><mi>s</mi><mo>=</mo><mo stretchy="false">{</mo><mi>t</mi><mi mathvariant="normal">∣</mi><mi>t</mi><mo>∈</mo><msub><mi mathvariant="normal">Π</mi><mrow><mi>R</mi><mo>−</mo><mi>S</mi></mrow></msub><mo stretchy="false">(</mo><mi>r</mi><mo stretchy="false">)</mo><mtext>且</mtext><mi mathvariant="normal">∀</mi><mi>u</mi><mo>∈</mo><mi>s</mi><mo separator="true">,</mo><mi>t</mi><mi>u</mi><mo>∈</mo><mi>r</mi><mo stretchy="false">}</mo></mrow><annotation encoding="application/x-tex">r\div s=\{t|t\in \Pi_{R-S} (r)且\forall u\in s,tu\in r \}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.6667em;vertical-align:-.0833em"></span><span class="mord mathnormal" style="margin-right:.02778em">r</span><span class="mspace" style="margin-right:.2222em"></span><span class="mbin">÷</span><span class="mspace" style="margin-right:.2222em"></span></span><span class="base"><span class="strut" style="height:.4306em"></span><span class="mord mathnormal">s</span><span class="mspace" style="margin-right:.2778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right:.2778em"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-.25em"></span><span class="mopen">{</span><span class="mord mathnormal">t</span><span class="mord">∣</span><span class="mord mathnormal">t</span><span class="mspace" style="margin-right:.2778em"></span><span class="mrel">∈</span><span class="mspace" style="margin-right:.2778em"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-.25em"></span><span class="mord"><span class="mord">Π</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.3283em"><span style="top:-2.55em;margin-left:0;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:.00773em">R</span><span class="mbin mtight">−</span><span class="mord mathnormal mtight" style="margin-right:.05764em">S</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.2083em"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:.02778em">r</span><span class="mclose">)</span><span class="mord cjk_fallback">且</span><span class="mord">∀</span><span class="mord mathnormal">u</span><span class="mspace" style="margin-right:.2778em"></span><span class="mrel">∈</span><span class="mspace" style="margin-right:.2778em"></span></span><span class="base"><span class="strut" style="height:.8095em;vertical-align:-.1944em"></span><span class="mord mathnormal">s</span><span class="mpunct">,</span><span class="mspace" style="margin-right:.1667em"></span><span class="mord mathnormal">t</span><span class="mord mathnormal">u</span><span class="mspace" style="margin-right:.2778em"></span><span class="mrel">∈</span><span class="mspace" style="margin-right:.2778em"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-.25em"></span><span class="mord mathnormal" style="margin-right:.02778em">r</span><span class="mclose">}</span></span></span></span></span></p><p>就是找出所有 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>r</mi></mrow><annotation encoding="application/x-tex">r</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.4306em"></span><span class="mord mathnormal" style="margin-right:.02778em">r</span></span></span></span> 中满足 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>s</mi></mrow><annotation encoding="application/x-tex">s</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.4306em"></span><span class="mord mathnormal">s</span></span></span></span> 的部分。</p><p><img src="https://images.kisechan.space/image-20250329163725274.png" srcset="/img/loading.gif" lazyload alt="除"></p><h4 id="广义投影">广义投影</h4><p class="katex-block"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><msub><mi mathvariant="normal">Π</mi><mrow><msub><mi>F</mi><mn>1</mn></msub><mo separator="true">,</mo><msub><mi>F</mi><mn>2</mn></msub><mo separator="true">,</mo><mo>⋯</mo><mtext> </mtext><mo separator="true">,</mo><msub><mi>F</mi><mi>n</mi></msub></mrow></msub><mo stretchy="false">(</mo><mi>E</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">\Pi_{F_1,F_2,\cdots,F_n}(E)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.0361em;vertical-align:-.2861em"></span><span class="mord"><span class="mord">Π</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.3283em"><span style="top:-2.55em;margin-left:0;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:.13889em">F</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.3173em"><span style="top:-2.357em;margin-left:-.1389em;margin-right:.0714em"><span class="pstrut" style="height:2.5em"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.143em"><span></span></span></span></span></span></span><span class="mpunct mtight">,</span><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:.13889em">F</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.3173em"><span style="top:-2.357em;margin-left:-.1389em;margin-right:.0714em"><span class="pstrut" style="height:2.5em"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.143em"><span></span></span></span></span></span></span><span class="mpunct mtight">,</span><span class="minner mtight">⋯</span><span class="mspace mtight" style="margin-right:.1952em"></span><span class="mpunct mtight">,</span><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:.13889em">F</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.1645em"><span style="top:-2.357em;margin-left:-.1389em;margin-right:.0714em"><span class="pstrut" style="height:2.5em"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathnormal mtight">n</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.143em"><span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.2861em"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:.05764em">E</span><span class="mclose">)</span></span></span></span></span></p><p>其中， <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>F</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">F_i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.8333em;vertical-align:-.15em"></span><span class="mord"><span class="mord mathnormal" style="margin-right:.13889em">F</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.3117em"><span style="top:-2.55em;margin-left:-.1389em;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.15em"><span></span></span></span></span></span></span></span></span></span> 指的是符合这个条件的算术表达式。</p><blockquote><p>[例] 信用卡能透支多少钱：</p><p><img src="https://images.kisechan.space/image-20250429143756037.png" srcset="/img/loading.gif" lazyload alt="credit_info 表"></p><p class="katex-block"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><msub><mi mathvariant="normal">Π</mi><mrow><mtext>customer_name</mtext><mo separator="true">,</mo><mtext>limit</mtext><mo>−</mo><mtext>credit_balance</mtext></mrow></msub><mo stretchy="false">(</mo><mtext>credit_info</mtext><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">\Pi_{\text{customer\_name}, \text{limit} - \text{credit\_balance}}(\text{credit\_info})</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.117em;vertical-align:-.367em"></span><span class="mord"><span class="mord">Π</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.3361em"><span style="top:-2.55em;margin-left:0;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord text mtight"><span class="mord mtight">customer_name</span></span><span class="mpunct mtight">,</span><span class="mord text mtight"><span class="mord mtight">limit</span></span><span class="mbin mtight">−</span><span class="mord text mtight"><span class="mord mtight">credit_balance</span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.367em"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord text"><span class="mord">credit_info</span></span><span class="mclose">)</span></span></span></span></span></p><p><img src="https://images.kisechan.space/image-20250429144117501.png" srcset="/img/loading.gif" lazyload alt="运算结果"></p></blockquote><h4 id="聚集运算">聚集运算</h4><p>关系运算中的聚集运算是指在关系数据库中对一组元组（行）进行统计或计算，用以<strong>提取整体性质的运算</strong>，例如：计数、求和、最大值、最小值、平均值等：</p><p class="katex-block"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><msub><mrow></mrow><mrow><msub><mi>G</mi><mn>1</mn></msub><mo separator="true">,</mo><msub><mi>G</mi><mn>2</mn></msub><mo separator="true">,</mo><mi mathvariant="normal">.</mi><mi mathvariant="normal">.</mi><mi mathvariant="normal">.</mi><mo separator="true">,</mo><msub><mi>G</mi><mi>n</mi></msub></mrow></msub><msub><mi mathvariant="script">G</mi><mrow><msub><mi>F</mi><mn>1</mn></msub><mo stretchy="false">(</mo><msub><mi>A</mi><mn>1</mn></msub><mo stretchy="false">)</mo><mo separator="true">,</mo><msub><mi>F</mi><mn>2</mn></msub><mo stretchy="false">(</mo><msub><mi>A</mi><mn>2</mn></msub><mo stretchy="false">)</mo><mo separator="true">,</mo><mi mathvariant="normal">.</mi><mi mathvariant="normal">.</mi><mi mathvariant="normal">.</mi><mo separator="true">,</mo><msub><mi>F</mi><mi>n</mi></msub><mo stretchy="false">(</mo><msub><mi>A</mi><mi>n</mi></msub><mo stretchy="false">)</mo></mrow></msub><mo stretchy="false">(</mo><mi>E</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">_{G_1, G_2, ..., G_n} \mathcal{G}_{F_1(A_1), F_2(A_2), ..., F_n(A_n)}(E)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.1052em;vertical-align:-.3552em"></span><span class="mord"><span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.3283em"><span style="top:-2.55em;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight">G</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.3173em"><span style="top:-2.357em;margin-left:0;margin-right:.0714em"><span class="pstrut" style="height:2.5em"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.143em"><span></span></span></span></span></span></span><span class="mpunct mtight">,</span><span class="mord mtight"><span class="mord mathnormal mtight">G</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.3173em"><span style="top:-2.357em;margin-left:0;margin-right:.0714em"><span class="pstrut" style="height:2.5em"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.143em"><span></span></span></span></span></span></span><span class="mpunct mtight">,</span><span class="mord mtight">...</span><span class="mpunct mtight">,</span><span class="mord mtight"><span class="mord mathnormal mtight">G</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.1645em"><span style="top:-2.357em;margin-left:0;margin-right:.0714em"><span class="pstrut" style="height:2.5em"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathnormal mtight">n</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.143em"><span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.2861em"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathcal" style="margin-right:.0593em">G</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.3448em"><span style="top:-2.5198em;margin-left:-.0593em;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:.13889em">F</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.3173em"><span style="top:-2.357em;margin-left:-.1389em;margin-right:.0714em"><span class="pstrut" style="height:2.5em"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.143em"><span></span></span></span></span></span></span><span class="mopen mtight">(</span><span class="mord mtight"><span class="mord mathnormal mtight">A</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.3173em"><span style="top:-2.357em;margin-left:0;margin-right:.0714em"><span class="pstrut" style="height:2.5em"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.143em"><span></span></span></span></span></span></span><span class="mclose mtight">)</span><span class="mpunct mtight">,</span><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:.13889em">F</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.3173em"><span style="top:-2.357em;margin-left:-.1389em;margin-right:.0714em"><span class="pstrut" style="height:2.5em"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.143em"><span></span></span></span></span></span></span><span class="mopen mtight">(</span><span class="mord mtight"><span class="mord mathnormal mtight">A</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.3173em"><span style="top:-2.357em;margin-left:0;margin-right:.0714em"><span class="pstrut" style="height:2.5em"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.143em"><span></span></span></span></span></span></span><span class="mclose mtight">)</span><span class="mpunct mtight">,</span><span class="mord mtight">...</span><span class="mpunct mtight">,</span><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:.13889em">F</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.1645em"><span style="top:-2.357em;margin-left:-.1389em;margin-right:.0714em"><span class="pstrut" style="height:2.5em"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathnormal mtight">n</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.143em"><span></span></span></span></span></span></span><span class="mopen mtight">(</span><span class="mord mtight"><span class="mord mathnormal mtight">A</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.1645em"><span style="top:-2.357em;margin-left:0;margin-right:.0714em"><span class="pstrut" style="height:2.5em"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathnormal mtight">n</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.143em"><span></span></span></span></span></span></span><span class="mclose mtight">)</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.3552em"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:.05764em">E</span><span class="mclose">)</span></span></span></span></span></p><ul><li><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>E</mi></mrow><annotation encoding="application/x-tex">E</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.6833em"></span><span class="mord mathnormal" style="margin-right:.05764em">E</span></span></span></span> 是关系代数表达式</li><li><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>G</mi><mi>n</mi></msub></mrow><annotation encoding="application/x-tex">G_n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.8333em;vertical-align:-.15em"></span><span class="mord"><span class="mord mathnormal">G</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.1514em"><span style="top:-2.55em;margin-left:0;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.15em"><span></span></span></span></span></span></span></span></span></span> 是用于分组的属性<sup id="fnref:1" class="footnote-ref"><a href="#fn:1" rel="footnote"><span class="hint--top hint--rounded" aria-label="分组就是“**按字段值划分子集**”。不过它既可以按照单字段分组，也可以按多字段（例如对于一个存在“地区”、“产品”和“价格”的表，如果按照“地区”和“产品”分组统计“价格”的平均值，那么就会分别按照【东部、铅笔】，【东部、钢笔】，【西部、铅笔】这样分别进行统计）。也可以通过表达式（例如提取日期字段中的年份）和区间进行分组。 `NULL` 会被单独分成一组。分好组了以后，聚集函数就会在组内进行运算。">[1]</span></a></sup></li><li><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>A</mi><mi>n</mi></msub></mrow><annotation encoding="application/x-tex">A_n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.8333em;vertical-align:-.15em"></span><span class="mord"><span class="mord mathnormal">A</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.1514em"><span style="top:-2.55em;margin-left:0;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.15em"><span></span></span></span></span></span></span></span></span></span> 是属性</li><li><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>F</mi><mi>n</mi></msub></mrow><annotation encoding="application/x-tex">F_n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.8333em;vertical-align:-.15em"></span><span class="mord"><span class="mord mathnormal" style="margin-right:.13889em">F</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.1514em"><span style="top:-2.55em;margin-left:-.1389em;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">n</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.15em"><span></span></span></span></span></span></span></span></span></span> 是聚集函数，如 <code>COUNT</code>, <code>SUM</code>, <code>MAX</code>, <code>MIN</code>, <code>AVG</code> 等</li><li><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="script">G</mi></mrow><annotation encoding="application/x-tex">\mathcal{G}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.7805em;vertical-align:-.0972em"></span><span class="mord mathcal" style="margin-right:.0593em">G</span></span></span></span> 是聚集操作<sup id="fnref:2" class="footnote-ref"><a href="#fn:2" rel="footnote"><span class="hint--top hint--rounded" aria-label="$\mathcal{G}$ 符号就是花体的 $\text G$ ，$\LaTeX$ 代码 `\mathcal{G}` 。">[2]</span></a></sup></li></ul><blockquote><p>[例] 分别统计各个银行的员工收入：</p><p class="katex-block"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><msub><mrow></mrow><mtext>branch_name</mtext></msub><msub><mi mathvariant="script">G</mi><mrow><mtext mathvariant="bold">sum</mtext><mo stretchy="false">(</mo><mtext>salary</mtext><mo stretchy="false">)</mo></mrow></msub><mo stretchy="false">(</mo><mtext>pt_works</mtext><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">_\text{branch\_name}\mathcal{G}_{\textbf{sum}(\text{salary})}(\text{pt\_works})</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.117em;vertical-align:-.367em"></span><span class="mord"><span></span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.3361em"><span style="top:-2.55em;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord text mtight"><span class="mord mtight">branch_name</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.367em"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathcal" style="margin-right:.0593em">G</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.3448em"><span style="top:-2.5198em;margin-left:-.0593em;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord text mtight"><span class="mord textbf mtight">sum</span></span><span class="mopen mtight">(</span><span class="mord text mtight"><span class="mord mtight">salary</span></span><span class="mclose mtight">)</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.3552em"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord text"><span class="mord">pt_works</span></span><span class="mclose">)</span></span></span></span></span></p><p><img src="https://images.kisechan.space/image-20250429150743019.png" srcset="/img/loading.gif" lazyload alt=""></p></blockquote><h4 id="外连接">外连接</h4><p>外连接用于在<strong>连接操作</strong>中<strong>保留未匹配的元组</strong>。这对于避免在查询时遗漏重要信息（比如主表中有但从表中没有的记录）非常有用。</p><p>有三种外连接：</p><table><thead><tr><th style="text-align:center">类型</th><th style="text-align:center">符号</th><th style="text-align:center">保留元组</th><th style="text-align:center">不匹配部分处理方式</th></tr></thead><tbody><tr><td style="text-align:center">左外连接</td><td style="text-align:center">⟕<sup id="fnref:3" class="footnote-ref"><a href="#fn:3" rel="footnote"><span class="hint--top hint--rounded" aria-label="$\LaTeX$ 不支持这三个符号，解决方案可以参考：https://tex.stackexchange.com/questions/20740/symbols-for-outer-joins 或 https://lancelotshire.me/notebook/latex.html 。">[3]</span></a></sup></td><td style="text-align:center">左表全部保留（即使没匹配）</td><td style="text-align:center">右表对应列填补空值（<code>NULL</code>）</td></tr><tr><td style="text-align:center">右外连接</td><td style="text-align:center">⟖<sup id="fnref:3" class="footnote-ref"><a href="#fn:3" rel="footnote"><span class="hint--top hint--rounded" aria-label="$\LaTeX$ 不支持这三个符号，解决方案可以参考：https://tex.stackexchange.com/questions/20740/symbols-for-outer-joins 或 https://lancelotshire.me/notebook/latex.html 。">[3]</span></a></sup></td><td style="text-align:center">右表全部保留（即使没匹配）</td><td style="text-align:center">左表对应列填补空值（<code>NULL</code>）</td></tr><tr><td style="text-align:center">全外连接</td><td style="text-align:center">⟗<sup id="fnref:3" class="footnote-ref"><a href="#fn:3" rel="footnote"><span class="hint--top hint--rounded" aria-label="$\LaTeX$ 不支持这三个符号，解决方案可以参考：https://tex.stackexchange.com/questions/20740/symbols-for-outer-joins 或 https://lancelotshire.me/notebook/latex.html 。">[3]</span></a></sup></td><td style="text-align:center">左右表都保留（即使没匹配）</td><td style="text-align:center">缺失一侧的用空值（<code>NULL</code>）填补</td></tr></tbody></table><blockquote><p><strong>Employees 表</strong>：</p><table><thead><tr><th style="text-align:center">emp_id</th><th style="text-align:center">name</th><th style="text-align:center">dept_id</th></tr></thead><tbody><tr><td style="text-align:center">1</td><td style="text-align:center">Alice</td><td style="text-align:center">10</td></tr><tr><td style="text-align:center">2</td><td style="text-align:center">Bob</td><td style="text-align:center">20</td></tr><tr><td style="text-align:center">3</td><td style="text-align:center">Charlie</td><td style="text-align:center">30</td></tr></tbody></table><p><strong>Departments 表</strong>：</p><table><thead><tr><th style="text-align:center">dept_id</th><th style="text-align:center">dept_name</th></tr></thead><tbody><tr><td style="text-align:center">10</td><td style="text-align:center">HR</td></tr><tr><td style="text-align:center">20</td><td style="text-align:center">IT</td></tr><tr><td style="text-align:center">40</td><td style="text-align:center">Finance</td></tr></tbody></table><hr><ol><li><code>Employees ⟕ Departments</code> 的结果是：</li></ol><table><thead><tr><th style="text-align:center">emp_id</th><th style="text-align:center">name</th><th style="text-align:center">dept_id</th><th style="text-align:center">dept_name</th></tr></thead><tbody><tr><td style="text-align:center">1</td><td style="text-align:center">Alice</td><td style="text-align:center">10</td><td style="text-align:center">HR</td></tr><tr><td style="text-align:center">2</td><td style="text-align:center">Bob</td><td style="text-align:center">20</td><td style="text-align:center">IT</td></tr><tr><td style="text-align:center">3</td><td style="text-align:center">Charlie</td><td style="text-align:center">30</td><td style="text-align:center"><code>NULL</code></td></tr></tbody></table><p>Charlie <strong>没有匹配的</strong>部门信息，所以 <code>dept_name</code> 用 <code>NULL</code> 填充。</p><hr><ol start="2"><li><code>Employees ⟖ Departments</code> 的结果是：</li></ol><table><thead><tr><th style="text-align:center">emp_id</th><th style="text-align:center">name</th><th style="text-align:center">dept_id</th><th style="text-align:center">dept_name</th></tr></thead><tbody><tr><td style="text-align:center">1</td><td style="text-align:center">Alice</td><td style="text-align:center">10</td><td style="text-align:center">HR</td></tr><tr><td style="text-align:center">2</td><td style="text-align:center">Bob</td><td style="text-align:center">20</td><td style="text-align:center">IT</td></tr><tr><td style="text-align:center"><code>NULL</code></td><td style="text-align:center"><code>NULL</code></td><td style="text-align:center">40</td><td style="text-align:center">Finance</td></tr></tbody></table><p><strong>Finance 部门</strong> 没有员工，所以 <code>emp_id</code> 和 <code>name</code> 用 <code>NULL</code> 填充。</p><hr><ol start="3"><li><code>Employees ⟗ Departments</code> 的结果是：</li></ol><table><thead><tr><th style="text-align:center">emp_id</th><th style="text-align:center">name</th><th style="text-align:center">dept_id</th><th style="text-align:center">dept_name</th></tr></thead><tbody><tr><td style="text-align:center">1</td><td style="text-align:center">Alice</td><td style="text-align:center">10</td><td style="text-align:center">HR</td></tr><tr><td style="text-align:center">2</td><td style="text-align:center">Bob</td><td style="text-align:center">20</td><td style="text-align:center">IT</td></tr><tr><td style="text-align:center">3</td><td style="text-align:center">Charlie</td><td style="text-align:center">30</td><td style="text-align:center"><code>NULL</code></td></tr><tr><td style="text-align:center"><code>NULL</code></td><td style="text-align:center"><code>NULL</code></td><td style="text-align:center">40</td><td style="text-align:center">Finance</td></tr></tbody></table><p>同时保留了 Charlie（<strong>没有部门</strong>） 和 Finance（<strong>没有员工</strong>）。</p></blockquote><h4 id="空值-NULL">空值 <code>NULL</code></h4><p><code>NULL</code>表示“<strong>未知值</strong>”、“<strong>缺失值</strong>”或“<strong>不适用的值</strong>”，它不是零 (<code>0</code>)、不是空字符串 (<code>''</code>)、也不是布尔 <code>false</code>。</p><p><code>NULL</code> 不等于任何值，包括另一个 <code>NULL</code>。</p><p>关于 <code>NULL</code> 的运算可参考：</p><table><thead><tr><th style="text-align:center">运算类型</th><th style="text-align:center">含 <code>NULL</code> 的行为</th></tr></thead><tbody><tr><td style="text-align:center">算术运算</td><td style="text-align:center">任何与 <code>NULL</code> 相加减乘除的结果都是 <strong>NULL</strong></td></tr><tr><td style="text-align:center">比较运算</td><td style="text-align:center">任何与 <code>NULL</code> 比较（=、&lt;&gt;、&gt; 等）结果是 <strong><code>unknown</code></strong></td></tr><tr><td style="text-align:center">聚集函数</td><td style="text-align:center"><strong>忽略</strong> <code>NULL</code>（如 <code>SUM</code>, <code>AVG</code>, <code>COUNT</code>）</td></tr><tr><td style="text-align:center">三值逻辑<sup id="fnref:4" class="footnote-ref"><a href="#fn:4" rel="footnote"><span class="hint--top hint--rounded" aria-label="三值逻辑是一种非古典逻辑系统，它允许命题有三个可能的真值：真（True）、假（False）和未确定（Unknown）。">[4]</span></a></sup></td><td style="text-align:center"><code>NULL</code> 会被视为 <code>unknown</code> （见下）</td></tr></tbody></table><p><code>NULL</code> 的逻辑运算不是简单的布尔逻辑，而是引入 <code>unknown</code> 后的三值逻辑：</p><table><thead><tr><th style="text-align:center">逻辑表达式</th><th style="text-align:center">结果</th></tr></thead><tbody><tr><td style="text-align:center"><code>true AND unknown</code></td><td style="text-align:center"><code>unknown</code></td></tr><tr><td style="text-align:center"><code>false AND unknown</code></td><td style="text-align:center"><code>false</code></td></tr><tr><td style="text-align:center"><code>unknown AND unknown</code></td><td style="text-align:center"><code>unknown</code></td></tr><tr><td style="text-align:center"><code>true OR unknown</code></td><td style="text-align:center"><code>true</code></td></tr><tr><td style="text-align:center"><code>false OR unknown</code></td><td style="text-align:center"><code>unknown</code></td></tr><tr><td style="text-align:center"><code>unknown OR unknown</code></td><td style="text-align:center"><code>unknown</code></td></tr><tr><td style="text-align:center"><code>NOT unknown</code></td><td style="text-align:center"><code>unknown</code></td></tr></tbody></table><div class="note note-warning"><p>在 <code>WHERE</code> 子句中，<strong>只有逻辑值为 <code>true</code> 的元组</strong>才会被选中。所以如果结果为 <code>unknown</code>，就 不会被选中。</p></div><p><code>NULL</code> 和 <code>unknown</code> 在关系运算中的表现：</p><table><thead><tr><th style="text-align:center">操作类别</th><th style="text-align:center">表现方式</th></tr></thead><tbody><tr><td style="text-align:center">连接</td><td style="text-align:center">如果连接条件中的某一属性为 <code>NULL</code>，则不会匹配成功</td></tr><tr><td style="text-align:center">选择</td><td style="text-align:center">条件值为 <code>unknown</code> 的记录不会被选中</td></tr><tr><td style="text-align:center">投影</td><td style="text-align:center">去重操作中将 <code>NULL</code> 值看作“相等”处理</td></tr><tr><td style="text-align:center">集合运算</td><td style="text-align:center"><code>NULL</code> 被视为可以参与相等性比较（虽然不等于任何值）</td></tr><tr><td style="text-align:center">聚集运算</td><td style="text-align:center"><code>NULL</code> 会被 <strong>忽略</strong>，不参与计算</td></tr><tr><td style="text-align:center">分组属性</td><td style="text-align:center"><code>NULL</code> 会被视为一个独立的分组键（即可分组）</td></tr></tbody></table><h3 id="修改数据库内容">修改数据库内容</h3><h4 id="插入">插入</h4><p>向关系模式 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>r</mi></mrow><annotation encoding="application/x-tex">r</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.4306em"></span><span class="mord mathnormal" style="margin-right:.02778em">r</span></span></span></span> 中插入来自关系表达式 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>E</mi></mrow><annotation encoding="application/x-tex">E</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.6833em"></span><span class="mord mathnormal" style="margin-right:.05764em">E</span></span></span></span> 的元组：</p><p class="katex-block"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>r</mi><mo>←</mo><mi>r</mi><mo>∪</mo><mi>E</mi></mrow><annotation encoding="application/x-tex">r \gets r\cup E</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.4306em"></span><span class="mord mathnormal" style="margin-right:.02778em">r</span><span class="mspace" style="margin-right:.2778em"></span><span class="mrel">←</span><span class="mspace" style="margin-right:.2778em"></span></span><span class="base"><span class="strut" style="height:.5556em"></span><span class="mord mathnormal" style="margin-right:.02778em">r</span><span class="mspace" style="margin-right:.2222em"></span><span class="mbin">∪</span><span class="mspace" style="margin-right:.2222em"></span></span><span class="base"><span class="strut" style="height:.6833em"></span><span class="mord mathnormal" style="margin-right:.05764em">E</span></span></span></span></span></p><h4 id="删除">删除</h4><p>从关系 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>r</mi></mrow><annotation encoding="application/x-tex">r</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.4306em"></span><span class="mord mathnormal" style="margin-right:.02778em">r</span></span></span></span> 中删除属于 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>E</mi></mrow><annotation encoding="application/x-tex">E</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.6833em"></span><span class="mord mathnormal" style="margin-right:.05764em">E</span></span></span></span> 的元组集合。</p><p class="katex-block"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>r</mi><mo>←</mo><mi>r</mi><mo>−</mo><mi>E</mi></mrow><annotation encoding="application/x-tex">r \gets r-E</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.4306em"></span><span class="mord mathnormal" style="margin-right:.02778em">r</span><span class="mspace" style="margin-right:.2778em"></span><span class="mrel">←</span><span class="mspace" style="margin-right:.2778em"></span></span><span class="base"><span class="strut" style="height:.6667em;vertical-align:-.0833em"></span><span class="mord mathnormal" style="margin-right:.02778em">r</span><span class="mspace" style="margin-right:.2222em"></span><span class="mbin">−</span><span class="mspace" style="margin-right:.2222em"></span></span><span class="base"><span class="strut" style="height:.6833em"></span><span class="mord mathnormal" style="margin-right:.05764em">E</span></span></span></span></span></p><h4 id="更改">更改</h4><p>有两种方式。</p><ul><li>对关系 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>r</mi></mrow><annotation encoding="application/x-tex">r</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.4306em"></span><span class="mord mathnormal" style="margin-right:.02778em">r</span></span></span></span> 的每个元组都只选择 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>F</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">F_i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.8333em;vertical-align:-.15em"></span><span class="mord"><span class="mord mathnormal" style="margin-right:.13889em">F</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.3117em"><span style="top:-2.55em;margin-left:-.1389em;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.15em"><span></span></span></span></span></span></span></span></span></span> 属性，重建这个关系模式：</li></ul><p class="katex-block"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>r</mi><mo>←</mo><msub><mi mathvariant="normal">Π</mi><mrow><msub><mi>F</mi><mn>1</mn></msub><mo separator="true">,</mo><msub><mi>F</mi><mn>2</mn></msub><mo separator="true">,</mo><mi mathvariant="normal">.</mi><mi mathvariant="normal">.</mi><mi mathvariant="normal">.</mi><mo separator="true">,</mo><msub><mi>F</mi><mi>n</mi></msub></mrow></msub><mo stretchy="false">(</mo><mi>r</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">r \gets\Pi_{F_1,F_2,...,F_n}(r)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.4306em"></span><span class="mord mathnormal" style="margin-right:.02778em">r</span><span class="mspace" style="margin-right:.2778em"></span><span class="mrel">←</span><span class="mspace" style="margin-right:.2778em"></span></span><span class="base"><span class="strut" style="height:1.0361em;vertical-align:-.2861em"></span><span class="mord"><span class="mord">Π</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.3283em"><span style="top:-2.55em;margin-left:0;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:.13889em">F</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.3173em"><span style="top:-2.357em;margin-left:-.1389em;margin-right:.0714em"><span class="pstrut" style="height:2.5em"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.143em"><span></span></span></span></span></span></span><span class="mpunct mtight">,</span><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:.13889em">F</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.3173em"><span style="top:-2.357em;margin-left:-.1389em;margin-right:.0714em"><span class="pstrut" style="height:2.5em"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.143em"><span></span></span></span></span></span></span><span class="mpunct mtight">,</span><span class="mord mtight">...</span><span class="mpunct mtight">,</span><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:.13889em">F</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.1645em"><span style="top:-2.357em;margin-left:-.1389em;margin-right:.0714em"><span class="pstrut" style="height:2.5em"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathnormal mtight">n</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.143em"><span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.2861em"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:.02778em">r</span><span class="mclose">)</span></span></span></span></span></p><ul><li><strong>更普适的更改操作</strong>。</li></ul><p class="katex-block"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>r</mi><mo>←</mo><msub><mi mathvariant="normal">Π</mi><mrow><msub><mi>F</mi><mn>1</mn></msub><mo separator="true">,</mo><msub><mi>F</mi><mn>2</mn></msub><mo separator="true">,</mo><mi mathvariant="normal">.</mi><mi mathvariant="normal">.</mi><mi mathvariant="normal">.</mi><mo separator="true">,</mo><msub><mi>F</mi><mi>n</mi></msub></mrow></msub><mo stretchy="false">(</mo><msub><mi>σ</mi><mi>p</mi></msub><mo stretchy="false">(</mo><mi>r</mi><mo stretchy="false">)</mo><mo>∪</mo><mo stretchy="false">(</mo><mi>r</mi><mo>−</mo><msub><mi>σ</mi><mi>p</mi></msub><mo stretchy="false">(</mo><mi>r</mi><mo stretchy="false">)</mo><mo stretchy="false">)</mo><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">r\gets\Pi_{F_1,F_2,...,F_n}(\sigma_p(r)\cup(r-\sigma_p(r)))</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.4306em"></span><span class="mord mathnormal" style="margin-right:.02778em">r</span><span class="mspace" style="margin-right:.2778em"></span><span class="mrel">←</span><span class="mspace" style="margin-right:.2778em"></span></span><span class="base"><span class="strut" style="height:1.0361em;vertical-align:-.2861em"></span><span class="mord"><span class="mord">Π</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.3283em"><span style="top:-2.55em;margin-left:0;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:.13889em">F</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.3173em"><span style="top:-2.357em;margin-left:-.1389em;margin-right:.0714em"><span class="pstrut" style="height:2.5em"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.143em"><span></span></span></span></span></span></span><span class="mpunct mtight">,</span><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:.13889em">F</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.3173em"><span style="top:-2.357em;margin-left:-.1389em;margin-right:.0714em"><span class="pstrut" style="height:2.5em"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.143em"><span></span></span></span></span></span></span><span class="mpunct mtight">,</span><span class="mord mtight">...</span><span class="mpunct mtight">,</span><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:.13889em">F</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.1645em"><span style="top:-2.357em;margin-left:-.1389em;margin-right:.0714em"><span class="pstrut" style="height:2.5em"></span><span class="sizing reset-size3 size1 mtight"><span class="mord mathnormal mtight">n</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.143em"><span></span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.2861em"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal" style="margin-right:.03588em">σ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.1514em"><span style="top:-2.55em;margin-left:-.0359em;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">p</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.2861em"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:.02778em">r</span><span class="mclose">)</span><span class="mspace" style="margin-right:.2222em"></span><span class="mbin">∪</span><span class="mspace" style="margin-right:.2222em"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-.25em"></span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:.02778em">r</span><span class="mspace" style="margin-right:.2222em"></span><span class="mbin">−</span><span class="mspace" style="margin-right:.2222em"></span></span><span class="base"><span class="strut" style="height:1.0361em;vertical-align:-.2861em"></span><span class="mord"><span class="mord mathnormal" style="margin-right:.03588em">σ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.1514em"><span style="top:-2.55em;margin-left:-.0359em;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">p</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.2861em"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:.02778em">r</span><span class="mclose">)))</span></span></span></span></span></p><blockquote><p>[例]</p><p><img src="https://images.kisechan.space/image-20250429191621966.png" srcset="/img/loading.gif" lazyload alt=""></p><ol><li>删除贷款额度在0到50之间的所有贷款记录：</li></ol><p class="katex-block"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mtext>loan</mtext><mo>←</mo><mtext>loan</mtext><mo>−</mo><msub><mi>σ</mi><mrow><mtext>amount</mtext><mo>≥</mo><mn>0</mn><mo>∧</mo><mtext>amount</mtext><mo>≤</mo><mn>50</mn></mrow></msub><mo stretchy="false">(</mo><mtext>loan</mtext><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">\text{loan}\leftarrow \text{loan}-\sigma_{\text{amount}\geq0\wedge \text{amount}\leq50}(\text{loan})</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.6944em"></span><span class="mord text"><span class="mord">loan</span></span><span class="mspace" style="margin-right:.2778em"></span><span class="mrel">←</span><span class="mspace" style="margin-right:.2778em"></span></span><span class="base"><span class="strut" style="height:.7778em;vertical-align:-.0833em"></span><span class="mord text"><span class="mord">loan</span></span><span class="mspace" style="margin-right:.2222em"></span><span class="mbin">−</span><span class="mspace" style="margin-right:.2222em"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-.25em"></span><span class="mord"><span class="mord mathnormal" style="margin-right:.03588em">σ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.3011em"><span style="top:-2.55em;margin-left:-.0359em;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord text mtight"><span class="mord mtight">amount</span></span><span class="mrel mtight">≥</span><span class="mord mtight">0</span><span class="mbin mtight">∧</span><span class="mord text mtight"><span class="mord mtight">amount</span></span><span class="mrel mtight">≤</span><span class="mord mtight">50</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.2452em"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord text"><span class="mord">loan</span></span><span class="mclose">)</span></span></span></span></span></p><ol start="2"><li>删除坐落在 <em>Needham</em> 的所有银行的存款记录：</li></ol><p class="katex-block"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mtext>account</mtext><mo>←</mo><mtext>account</mtext><mo>−</mo><msub><mi mathvariant="normal">Π</mi><mrow><mtext>account_number</mtext><mo separator="true">,</mo><mtext>branch_name</mtext><mo separator="true">,</mo><mtext>balance</mtext></mrow></msub><mo stretchy="false">(</mo><msub><mi>σ</mi><mrow><mtext>branch_city</mtext><mo>=</mo><mtext>"Needham"</mtext></mrow></msub><mo stretchy="false">(</mo><mtext>account</mtext><mo>⋈</mo><mtext>branch</mtext><mo stretchy="false">)</mo><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">\text{account}\leftarrow \text{account}-\Pi_{\text{account\_number},\text{branch\_name},\text{balance}}(\sigma_{\text{branch\_city}=\text{"Needham"}}(\text{account}\Join \text{branch}))</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.6151em"></span><span class="mord text"><span class="mord">account</span></span><span class="mspace" style="margin-right:.2778em"></span><span class="mrel">←</span><span class="mspace" style="margin-right:.2778em"></span></span><span class="base"><span class="strut" style="height:.6984em;vertical-align:-.0833em"></span><span class="mord text"><span class="mord">account</span></span><span class="mspace" style="margin-right:.2222em"></span><span class="mbin">−</span><span class="mspace" style="margin-right:.2222em"></span></span><span class="base"><span class="strut" style="height:1.117em;vertical-align:-.367em"></span><span class="mord"><span class="mord">Π</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.3361em"><span style="top:-2.55em;margin-left:0;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord text mtight"><span class="mord mtight">account_number</span></span><span class="mpunct mtight">,</span><span class="mord text mtight"><span class="mord mtight">branch_name</span></span><span class="mpunct mtight">,</span><span class="mord text mtight"><span class="mord mtight">balance</span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.367em"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal" style="margin-right:.03588em">σ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.3361em"><span style="top:-2.55em;margin-left:-.0359em;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord text mtight"><span class="mord mtight">branch_city</span></span><span class="mrel mtight">=</span><span class="mord text mtight"><span class="mord mtight">"Needham"</span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.367em"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord text"><span class="mord">account</span></span><span class="mspace" style="margin-right:.2778em"></span><span class="mrel">⋈</span><span class="mspace" style="margin-right:.2778em"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-.25em"></span><span class="mord text"><span class="mord">branch</span></span><span class="mclose">))</span></span></span></span></span></p><p class="katex-block"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mtext>depositor</mtext><mo>←</mo><mtext>depositor</mtext><mo>−</mo><msub><mi mathvariant="normal">Π</mi><mrow><mtext>customer_name</mtext><mo separator="true">,</mo><mtext>acount_number</mtext></mrow></msub><mo stretchy="false">(</mo><msub><mi mathvariant="normal">Π</mi><mrow><mtext>account_number</mtext><mo separator="true">,</mo><mtext>branch_name</mtext><mo separator="true">,</mo><mtext>balance</mtext></mrow></msub><mo stretchy="false">(</mo><msub><mi>σ</mi><mrow><mtext>branch_city</mtext><mo>=</mo><mtext>"Needham"</mtext></mrow></msub><mo stretchy="false">(</mo><mtext>account</mtext><mo>⋈</mo><mtext>branch</mtext><mo stretchy="false">)</mo><mo stretchy="false">)</mo><mo>⋈</mo><mtext>depositor</mtext><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">\text{depositor}\leftarrow\text{depositor}-\Pi_{\text{customer\_name},\text{acount\_number}}(\Pi_{\text{account\_number},\text{branch\_name},\text{balance}}(\sigma_{\text{branch\_city}=\text{"Needham"}}(\text{account}\Join \text{branch}))\Join\text{depositor})</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.8889em;vertical-align:-.1944em"></span><span class="mord text"><span class="mord">depositor</span></span><span class="mspace" style="margin-right:.2778em"></span><span class="mrel">←</span><span class="mspace" style="margin-right:.2778em"></span></span><span class="base"><span class="strut" style="height:.8889em;vertical-align:-.1944em"></span><span class="mord text"><span class="mord">depositor</span></span><span class="mspace" style="margin-right:.2222em"></span><span class="mbin">−</span><span class="mspace" style="margin-right:.2222em"></span></span><span class="base"><span class="strut" style="height:1.117em;vertical-align:-.367em"></span><span class="mord"><span class="mord">Π</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.3361em"><span style="top:-2.55em;margin-left:0;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord text mtight"><span class="mord mtight">customer_name</span></span><span class="mpunct mtight">,</span><span class="mord text mtight"><span class="mord mtight">acount_number</span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.367em"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord"><span class="mord">Π</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.3361em"><span style="top:-2.55em;margin-left:0;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord text mtight"><span class="mord mtight">account_number</span></span><span class="mpunct mtight">,</span><span class="mord text mtight"><span class="mord mtight">branch_name</span></span><span class="mpunct mtight">,</span><span class="mord text mtight"><span class="mord mtight">balance</span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.367em"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal" style="margin-right:.03588em">σ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.3361em"><span style="top:-2.55em;margin-left:-.0359em;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord text mtight"><span class="mord mtight">branch_city</span></span><span class="mrel mtight">=</span><span class="mord text mtight"><span class="mord mtight">"Needham"</span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.367em"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord text"><span class="mord">account</span></span><span class="mspace" style="margin-right:.2778em"></span><span class="mrel">⋈</span><span class="mspace" style="margin-right:.2778em"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-.25em"></span><span class="mord text"><span class="mord">branch</span></span><span class="mclose">))</span><span class="mspace" style="margin-right:.2778em"></span><span class="mrel">⋈</span><span class="mspace" style="margin-right:.2778em"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-.25em"></span><span class="mord text"><span class="mord">depositor</span></span><span class="mclose">)</span></span></span></span></span></p><ol start="3"><li><em>Perryridge</em> 银行赠送每位贷款客户 200 美元，并存入与贷款账号相同的存款账户：</li></ol><p class="katex-block"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>r</mi><mo>←</mo><msub><mi>σ</mi><mrow><mtext>branch_name</mtext><mo>=</mo><mtext>"Perryidge"</mtext></mrow></msub><mo stretchy="false">(</mo><mtext>borrower</mtext><mo>⋈</mo><mtext>loan</mtext><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">r\leftarrow\sigma_{\text{branch\_name}=\text{"Perryidge"}}(\text{borrower}\Join\text{loan})</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.4306em"></span><span class="mord mathnormal" style="margin-right:.02778em">r</span><span class="mspace" style="margin-right:.2778em"></span><span class="mrel">←</span><span class="mspace" style="margin-right:.2778em"></span></span><span class="base"><span class="strut" style="height:1.117em;vertical-align:-.367em"></span><span class="mord"><span class="mord mathnormal" style="margin-right:.03588em">σ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.3361em"><span style="top:-2.55em;margin-left:-.0359em;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord text mtight"><span class="mord mtight">branch_name</span></span><span class="mrel mtight">=</span><span class="mord text mtight"><span class="mord mtight">"Perryidge"</span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.367em"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord text"><span class="mord">borrower</span></span><span class="mspace" style="margin-right:.2778em"></span><span class="mrel">⋈</span><span class="mspace" style="margin-right:.2778em"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-.25em"></span><span class="mord text"><span class="mord">loan</span></span><span class="mclose">)</span></span></span></span></span></p><p class="katex-block"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mtext>account</mtext><mo>←</mo><mtext>account</mtext><mo>∪</mo><msub><mi mathvariant="normal">Π</mi><mrow><mtext>loan_number</mtext><mo separator="true">,</mo><mtext>branch_name</mtext><mo separator="true">,</mo><mn>200</mn></mrow></msub><mo stretchy="false">(</mo><mi>r</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">\text{account}\leftarrow \text{account}\cup\Pi_{\text{loan\_number},\text{branch\_name},200}(r)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.6151em"></span><span class="mord text"><span class="mord">account</span></span><span class="mspace" style="margin-right:.2778em"></span><span class="mrel">←</span><span class="mspace" style="margin-right:.2778em"></span></span><span class="base"><span class="strut" style="height:.6151em"></span><span class="mord text"><span class="mord">account</span></span><span class="mspace" style="margin-right:.2222em"></span><span class="mbin">∪</span><span class="mspace" style="margin-right:.2222em"></span></span><span class="base"><span class="strut" style="height:1.117em;vertical-align:-.367em"></span><span class="mord"><span class="mord">Π</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.3361em"><span style="top:-2.55em;margin-left:0;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord text mtight"><span class="mord mtight">loan_number</span></span><span class="mpunct mtight">,</span><span class="mord text mtight"><span class="mord mtight">branch_name</span></span><span class="mpunct mtight">,</span><span class="mord mtight">200</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.367em"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:.02778em">r</span><span class="mclose">)</span></span></span></span></span></p><p class="katex-block"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mtext>depositor</mtext><mo>←</mo><mtext>depositor</mtext><mo>∪</mo><msub><mi mathvariant="normal">Π</mi><mrow><mtext>customer_name</mtext><mo separator="true">,</mo><mtext>loan_number</mtext></mrow></msub><mo stretchy="false">(</mo><mi>r</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">\text{depositor}\leftarrow \text{depositor}\cup\Pi_{\text{customer\_name},\text{loan\_number}}(r)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.8889em;vertical-align:-.1944em"></span><span class="mord text"><span class="mord">depositor</span></span><span class="mspace" style="margin-right:.2778em"></span><span class="mrel">←</span><span class="mspace" style="margin-right:.2778em"></span></span><span class="base"><span class="strut" style="height:.8889em;vertical-align:-.1944em"></span><span class="mord text"><span class="mord">depositor</span></span><span class="mspace" style="margin-right:.2222em"></span><span class="mbin">∪</span><span class="mspace" style="margin-right:.2222em"></span></span><span class="base"><span class="strut" style="height:1.117em;vertical-align:-.367em"></span><span class="mord"><span class="mord">Π</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.3361em"><span style="top:-2.55em;margin-left:0;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord text mtight"><span class="mord mtight">customer_name</span></span><span class="mpunct mtight">,</span><span class="mord text mtight"><span class="mord mtight">loan_number</span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.367em"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:.02778em">r</span><span class="mclose">)</span></span></span></span></span></p><ol start="4"><li>余额不超过 10000 元的按 5% 计息，其余按 6% 计息：</li></ol><p class="katex-block"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mtext>account</mtext><mo>←</mo><msub><mi mathvariant="normal">Π</mi><mrow><mtext>account_number</mtext><mo separator="true">,</mo><mtext>branch_name</mtext><mo separator="true">,</mo><msup><mtext>balance</mtext><mo>∗</mo></msup><mn>1.06</mn></mrow></msub><mo stretchy="false">(</mo><msub><mi>σ</mi><mrow><mtext>balance</mtext><mo>&gt;</mo><mn>10000</mn></mrow></msub><mo stretchy="false">(</mo><mtext>account</mtext><mo stretchy="false">)</mo><mo stretchy="false">)</mo><mo>∪</mo><msub><mi mathvariant="normal">Π</mi><mrow><mtext>account_number</mtext><mo separator="true">,</mo><mtext>branch_name</mtext><mo separator="true">,</mo><msup><mtext>balance</mtext><mo>∗</mo></msup><mn>1.05</mn></mrow></msub><mo stretchy="false">(</mo><msub><mi>σ</mi><mrow><mtext>balance</mtext><mo>≤</mo><mn>10000</mn></mrow></msub><mo stretchy="false">(</mo><mtext>account</mtext><mo stretchy="false">)</mo><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">\text{account}\leftarrow\Pi_{\text{account\_number},\text{branch\_name},\text{balance}^*1.06}(\sigma_{\text{balance}\gt 10000}(\text{account}))\cup\Pi_{\text{account\_number},\text{branch\_name},\text{balance}^*1.05}(\sigma_{\text{balance}\leq10000}(\text{account}))</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.6151em"></span><span class="mord text"><span class="mord">account</span></span><span class="mspace" style="margin-right:.2778em"></span><span class="mrel">←</span><span class="mspace" style="margin-right:.2778em"></span></span><span class="base"><span class="strut" style="height:1.117em;vertical-align:-.367em"></span><span class="mord"><span class="mord">Π</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.3361em"><span style="top:-2.55em;margin-left:0;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord text mtight"><span class="mord mtight">account_number</span></span><span class="mpunct mtight">,</span><span class="mord text mtight"><span class="mord mtight">branch_name</span></span><span class="mpunct mtight">,</span><span class="mord mtight"><span class="mord text mtight"><span class="mord mtight">balance</span></span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:.6739em"><span style="top:-2.8416em;margin-right:.0714em"><span class="pstrut" style="height:2.5em"></span><span class="sizing reset-size3 size1 mtight"><span class="mbin mtight">∗</span></span></span></span></span></span></span></span><span class="mord mtight">1.06</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.367em"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal" style="margin-right:.03588em">σ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.3361em"><span style="top:-2.55em;margin-left:-.0359em;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord text mtight"><span class="mord mtight">balance</span></span><span class="mrel mtight">&gt;</span><span class="mord mtight">10000</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.1774em"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord text"><span class="mord">account</span></span><span class="mclose">))</span><span class="mspace" style="margin-right:.2222em"></span><span class="mbin">∪</span><span class="mspace" style="margin-right:.2222em"></span></span><span class="base"><span class="strut" style="height:1.117em;vertical-align:-.367em"></span><span class="mord"><span class="mord">Π</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.3361em"><span style="top:-2.55em;margin-left:0;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord text mtight"><span class="mord mtight">account_number</span></span><span class="mpunct mtight">,</span><span class="mord text mtight"><span class="mord mtight">branch_name</span></span><span class="mpunct mtight">,</span><span class="mord mtight"><span class="mord text mtight"><span class="mord mtight">balance</span></span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:.6739em"><span style="top:-2.8416em;margin-right:.0714em"><span class="pstrut" style="height:2.5em"></span><span class="sizing reset-size3 size1 mtight"><span class="mbin mtight">∗</span></span></span></span></span></span></span></span><span class="mord mtight">1.05</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.367em"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal" style="margin-right:.03588em">σ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.3361em"><span style="top:-2.55em;margin-left:-.0359em;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord text mtight"><span class="mord mtight">balance</span></span><span class="mrel mtight">≤</span><span class="mord mtight">10000</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.2452em"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord text"><span class="mord">account</span></span><span class="mclose">))</span></span></span></span></span></p></blockquote><h2 id="SQL">SQL</h2><p>SQL, Structed Query Language 是应用最广泛的数据库语言，它是一个<strong>功能完备的数据库语言体系</strong>，被划分为多个子语言（子功能）：</p><ul><li><p><strong>数据定义</strong></p><ul><li><p>用于定义数据库结构（模式、表、视图、索引等）。</p></li><li><p>常见命令有：</p><ul><li><p><code>CREATE</code>：创建数据库、表、视图、索引等。</p></li><li><p><code>ALTER</code>：修改表结构（如添加/删除列）。</p></li><li><p><code>DROP</code>：删除数据库对象（如表、视图）。</p></li></ul></li></ul></li><li><p><strong>数据操纵</strong></p><ul><li><p>用于对数据库中的数据进行 CURD 。</p></li><li><p>常见命令有：</p><ul><li><p><code>INSERT</code>：插入数据。</p></li><li><p><code>UPDATE</code>：更新已有数据。</p></li><li><p><code>DELETE</code>：删除数据。</p></li><li><p><code>SELECT</code>：查询数据。</p></li></ul></li></ul></li><li><p><strong>完整性定义</strong></p><ul><li>用于定义和维护数据的合法性和一致性。</li><li>常见的完整性约束有：<ul><li><strong>实体完整性</strong>：如主键不能为 <code>NULL</code>。</li><li><strong>参照完整性</strong>：如外键必须引用自已有记录。</li><li><strong>自定义完整性</strong>：如 <code>Salary &gt; 0</code> 等。</li></ul></li></ul></li><li><p><strong>视图定义</strong></p><ul><li>创建虚拟表（视图），简化复杂查询，增强安全性。<ul><li>视图是基于一个或多个表的查询结果，并不实际存储数据。</li><li>可以对视图查询，就像表一样。</li></ul></li></ul></li><li><p><strong>事务控制</strong></p><ul><li><p>用于管理事务的边界，确保数据一致性、持久性和隔离性（ACID）。</p></li><li><p>常见命令有：</p><ul><li><p><code>BEGIN</code> / <code>START TRANSACTION</code>：开始事务。</p></li><li><p><code>COMMIT</code>：提交事务，永久保存更改。</p></li><li><p><code>ROLLBACK</code>：回滚事务，撤销更改。</p></li><li><p><code>SAVEPOINT</code>：设置事务中的回滚点。</p></li></ul></li></ul></li><li><p><strong>嵌入式和动态 SQL</strong></p><ul><li>使 SQL 能嵌入到高级语言（如 C/C++、Java）中执行，或在运行时构造 SQL 语句。<ul><li><strong>嵌入式 SQL</strong>：SQL 语句直接写入程序中，通过宿主语言控制执行流程。</li><li><strong>动态 SQL</strong>：在运行时动态构造 SQL 语句，常用于用户输入或复杂查询。</li></ul></li></ul></li><li><p><strong>授权</strong></p><ul><li>控制用户对数据库中数据和对象的访问权限。</li><li>常见命令有：<ul><li><code>GRANT</code>：授予权限。</li><li><code>REVOKE</code>：撤销权限。</li></ul></li></ul></li></ul><h3 id="数据定义">数据定义</h3><p>数据定义是 SQL <strong>定义数据库结构及其元信息</strong>的能力，是数据库设计的第一步，涉及表的结构、数据类型、约束规则、存储策略等。</p><h4 id="数据定义的职能">数据定义的职能</h4><ul><li><strong>关系模式</strong><ul><li>描述一张表的结构：表名 + 属性（列名）+ 属性的数据类型。</li><li>是数据库逻辑结构的基本单位。</li></ul></li></ul><blockquote><figure class="highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> Student (<br>    ID <span class="hljs-type">INT</span> <span class="hljs-keyword">PRIMARY</span> KEY,<br>    Name <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">50</span>),<br>    Age <span class="hljs-type">INT</span><br>);<br></code></pre></td></tr></tbody></table></figure></blockquote><ul><li><strong>属性值域</strong><ul><li>指定列中可以存储哪些类型的数据，是否有取值范围、精度限制等。</li><li>值域通过<strong>数据类型</strong>来表达，也可以使用 <code>CHECK</code> 约束自定义限制。</li></ul></li></ul><blockquote><figure class="highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql">Age <span class="hljs-type">INT</span> <span class="hljs-keyword">CHECK</span> (Age <span class="hljs-keyword">BETWEEN</span> <span class="hljs-number">0</span> <span class="hljs-keyword">AND</span> <span class="hljs-number">150</span>);<br></code></pre></td></tr></tbody></table></figure></blockquote><ul><li><p><strong>完整性约束</strong></p><ul><li><p>确保数据的合法性和一致性。</p></li><li><p>主要包括：</p><ul><li><p>主键（<code>PRIMARY KEY</code>）</p></li><li><p>唯一约束（<code>UNIQUE</code>）</p></li><li><p>非空（<code>NOT NULL</code>）</p></li><li><p>外键（<code>FOREIGN KEY</code>）</p></li><li><p>检查条件（<code>CHECK</code>）</p></li></ul></li></ul></li></ul><blockquote><figure class="highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> Course (<br>    CourseID <span class="hljs-type">INT</span> <span class="hljs-keyword">PRIMARY</span> KEY,<br>    CourseName <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">100</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,<br>    TeacherID <span class="hljs-type">INT</span>,<br>    <span class="hljs-keyword">FOREIGN</span> KEY (TeacherID) <span class="hljs-keyword">REFERENCES</span> Teacher(ID)<br>);<br></code></pre></td></tr></tbody></table></figure></blockquote><ul><li><strong>索引</strong><ul><li>提高查询效率，用于加速搜索。</li><li>可以对主键自动创建，也可以手动创建索引。</li></ul></li></ul><blockquote><figure class="highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">CREATE</span> INDEX idx_student_name <span class="hljs-keyword">ON</span> Student(Name);<br></code></pre></td></tr></tbody></table></figure></blockquote><ul><li><strong>安全性</strong><ul><li>定义哪些用户可以访问数据库中的哪些数据（见授权部分）。</li><li>尽管授权通常单独归为 SQL 安全控制功能，但也可以视为数据定义的一部分。</li></ul></li></ul><blockquote><figure class="highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">GRANT</span> <span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">ON</span> Student <span class="hljs-keyword">TO</span> teacher_user;<br></code></pre></td></tr></tbody></table></figure></blockquote><ul><li><strong>物理组织</strong><ul><li>一些数据库允许在创建表时指定其底层物理结构，比如：<ul><li>表空间（tablespace）</li><li>存储引擎（如 InnoDB vs MyISAM）</li><li>分区策略</li></ul></li><li>这部分通常是数据库厂商扩展功能，标准 SQL 提及不多。</li></ul></li></ul><h4 id="基本类型">基本类型</h4><p>数据类型规定了值的取值范围、精度和运算。</p><table><thead><tr><th style="text-align:center">数据类型</th><th style="text-align:center">含义</th></tr></thead><tbody><tr><td style="text-align:center"><code>CHAR(n)</code></td><td style="text-align:center">固定长度字符串，占用 n 个字符，不足补空格</td></tr><tr><td style="text-align:center"><code>VARCHAR(n)</code></td><td style="text-align:center">可变长度字符串，最大长度为 n</td></tr><tr><td style="text-align:center"><code>INT</code>, <code>INTEGER</code></td><td style="text-align:center">整数（通常 4 字节）</td></tr><tr><td style="text-align:center"><code>SMALLINT</code></td><td style="text-align:center">小整数（通常 2 字节）</td></tr><tr><td style="text-align:center"><code>NUMERIC(p,d)</code></td><td style="text-align:center">精确小数，总位数为 p，小数位数为 d</td></tr><tr><td style="text-align:center"><code>REAL</code></td><td style="text-align:center">单精度浮点数（近似值）</td></tr><tr><td style="text-align:center"><code>DOUBLE PRECISION</code></td><td style="text-align:center">双精度浮点数</td></tr><tr><td style="text-align:center"><code>FLOAT(n)</code></td><td style="text-align:center">精度为 n 的浮点数，n 是二进制有效位数</td></tr></tbody></table><div class="fold"><div class="fold-title fold-warning collapsed" data-toggle="collapse" href="#collapse-30433e52" role="button" aria-expanded="false" aria-controls="collapse-30433e52"><div class="fold-arrow">▶</div>完整性约束和一致性约束</div><div class="fold-collapse collapse" id="collapse-30433e52"><div class="fold-content"><p><strong>完整性约束</strong>是指数据库在<strong>逻辑层面</strong>上为保证数据正确性、合法性和一致性而设置的<strong>规则</strong>。主要类型包括：</p><ul><li><p><strong>实体完整性</strong>：</p><ul><li>主键（<code>PRIMARY KEY</code>）不能为 <code>NULL</code>，唯一标识一条记录。</li></ul></li><li><p><strong>参照完整性</strong>：</p><ul><li>外键（<code>FOREIGN KEY</code>）必须引用主表中存在的记录，防止“悬挂指针”。</li></ul></li><li><p><strong>域完整性</strong>：</p><ul><li>每个字段的数据类型、取值范围（如 <code>CHECK</code>, <code>NOT NULL</code>, 数据类型本身）。</li></ul></li><li><p><strong>用户定义的完整性</strong>：</p><ul><li>开发者自己规定的业务规则（如工资必须大于 0）。</li></ul></li></ul><p>例如：</p><figure class="highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> Student (<br>    ID <span class="hljs-type">INT</span> <span class="hljs-keyword">PRIMARY</span> KEY,               <span class="hljs-comment">-- 实体完整性</span><br>    Age <span class="hljs-type">INT</span> <span class="hljs-keyword">CHECK</span> (Age <span class="hljs-operator">&gt;=</span> <span class="hljs-number">0</span>),         <span class="hljs-comment">-- 域完整性</span><br>    ClassID <span class="hljs-type">INT</span>,<br>    <span class="hljs-keyword">FOREIGN</span> KEY (ClassID) <span class="hljs-keyword">REFERENCES</span> Class(ID) <span class="hljs-comment">-- 参照完整性</span><br>);<br></code></pre></td></tr></tbody></table></figure><p><strong>一致性约束</strong>通常是指在<strong>数据库操作前后</strong>，数据要保持<strong>符合数据库的所有完整性约束</strong>的规则——数据库处于一个“<strong>一致状态</strong>”。它强调的是数据库整体状态在事务执行前后不会出现非法或冲突数据。</p><ul><li>它并不是一种“单独的约束类型”，而是指<strong>多个完整性约束共同作用的结果</strong>。</li><li>一致性约束强调的是<strong>事务操作</strong>对数据一致性的维护。</li></ul><table><thead><tr><th style="text-align:center">对比项</th><th style="text-align:center">完整性约束</th><th style="text-align:center">一致性约束</th></tr></thead><tbody><tr><td style="text-align:center">概念本质</td><td style="text-align:center">一种具体的规则机制</td><td style="text-align:center">一种结果状态（是否满足全部约束）</td></tr><tr><td style="text-align:center">作用时间点</td><td style="text-align:center">约束规则在建表/修改表时定义并持续生效</td><td style="text-align:center">通常在事务前后判断数据库是否仍然满足完整性约束</td></tr><tr><td style="text-align:center">是否可单独定义</td><td style="text-align:center">可以明确写出（如 <code>PRIMARY KEY</code>, <code>CHECK</code>, <code>FOREIGN KEY</code>）</td><td style="text-align:center">不能单独定义，是对多个完整性规则是否被违反的总体评估</td></tr><tr><td style="text-align:center">举例</td><td style="text-align:center"><code>CHECK (age &gt;= 0)</code>、<code>FOREIGN KEY</code></td><td style="text-align:center">插入一个不存在外键值时，破坏一致性约束（即违反特定的完整性约束）</td></tr><tr><td style="text-align:center">关系</td><td style="text-align:center">完整性约束是<strong>具体规则</strong></td><td style="text-align:center">一致性约束是<strong>整体状态结果</strong>，是否“违反”完整性约束决定一致性是否成立</td></tr></tbody></table></div></div></div><h4 id="基本模式定义">基本模式定义</h4><ol><li><strong>创建关系模式</strong></li></ol><figure class="highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> r (<br>    A1 D1,<br>    A2 D2,<br>    ...<br>    An Dn,<br>    <span class="hljs-comment">-- 完整性约束</span><br>    完整性约束<span class="hljs-number">1</span>,<br>    完整性约束<span class="hljs-number">2</span>,<br>    ...<br>);<br></code></pre></td></tr></tbody></table></figure><table><thead><tr><th style="text-align:center">完整性约束</th><th style="text-align:center">语法例子</th><th style="text-align:center">用途</th></tr></thead><tbody><tr><td style="text-align:center"><code>NOT NULL</code></td><td style="text-align:center"><code>age INT NOT NULL</code></td><td style="text-align:center">禁止空值</td></tr><tr><td style="text-align:center"><code>UNIQUE</code></td><td style="text-align:center"><code>UNIQUE (email)</code></td><td style="text-align:center">保证列唯一</td></tr><tr><td style="text-align:center"><code>CHECK</code></td><td style="text-align:center"><code>CHECK (age &gt;= 18)</code></td><td style="text-align:center">自定义条件限制</td></tr><tr><td style="text-align:center"><code>DEFAULT</code></td><td style="text-align:center"><code>DEFAULT 0</code></td><td style="text-align:center">赋予默认值</td></tr><tr><td style="text-align:center"><code>FOREIGN KEY</code></td><td style="text-align:center"><code>FOREIGN KEY (...) REFERENCES ...</code></td><td style="text-align:center">参照完整性，引用其他表</td></tr></tbody></table><ol start="2"><li><strong>删除关系模式</strong></li></ol><figure class="highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">drop</span> <span class="hljs-keyword">table</span> r<br></code></pre></td></tr></tbody></table></figure><ol start="3"><li><strong>修改关系模式</strong></li></ol><figure class="highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">alter</span> <span class="hljs-keyword">table</span> r <span class="hljs-keyword">add</span> A D<br><span class="hljs-comment">-- 添加一个名为 A 类型为 D 的字段</span><br><span class="hljs-keyword">alter</span> <span class="hljs-keyword">table</span> r <span class="hljs-keyword">drop</span> A<br><span class="hljs-comment">-- 删除字段 A</span><br></code></pre></td></tr></tbody></table></figure><h3 id="数据查询">数据查询</h3><p>SQL 查询的一般方式是：</p><figure class="highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> A <span class="hljs-keyword">from</span> r <span class="hljs-keyword">where</span> p<br></code></pre></td></tr></tbody></table></figure><p>等价于</p><p class="katex-block"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><msub><mi mathvariant="normal">Π</mi><mi>A</mi></msub><mo stretchy="false">(</mo><msub><mi>σ</mi><mi>p</mi></msub><mo stretchy="false">(</mo><mi>r</mi><mo stretchy="false">)</mo><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">\Pi_A(\sigma_p(r))</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.0361em;vertical-align:-.2861em"></span><span class="mord"><span class="mord">Π</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.3283em"><span style="top:-2.55em;margin-left:0;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">A</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.15em"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal" style="margin-right:.03588em">σ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.1514em"><span style="top:-2.55em;margin-left:-.0359em;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">p</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.2861em"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:.02778em">r</span><span class="mclose">))</span></span></span></span></span></p><table><thead><tr><th style="text-align:center">关键词</th><th style="text-align:center">含义</th></tr></thead><tbody><tr><td style="text-align:center"><code>SELECT A</code></td><td style="text-align:center">指定要查询的列（字段）<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>A</mi></mrow><annotation encoding="application/x-tex">A</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.6833em"></span><span class="mord mathnormal">A</span></span></span></span>，可以是一个列，也可以是多个列、表达式等。</td></tr><tr><td style="text-align:center"><code>FROM r</code></td><td style="text-align:center">指定查询的数据来源表（或视图）<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>r</mi></mrow><annotation encoding="application/x-tex">r</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.4306em"></span><span class="mord mathnormal" style="margin-right:.02778em">r</span></span></span></span>。</td></tr><tr><td style="text-align:center"><code>WHERE p</code></td><td style="text-align:center">指定筛选条件 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>p</mi></mrow><annotation encoding="application/x-tex">p</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.625em;vertical-align:-.1944em"></span><span class="mord mathnormal">p</span></span></span></span>，只保留满足条件的行。</td></tr></tbody></table><p>完整版的 SQL 查询语句如下：</p><figure class="highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> [<span class="hljs-keyword">DISTINCT</span><span class="hljs-operator">|</span><span class="hljs-keyword">ALL</span>] column_list<br><span class="hljs-keyword">FROM</span> table_list<br>[<span class="hljs-keyword">WHERE</span> <span class="hljs-keyword">condition</span>]<br>[<span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> group_columns]<br>[<span class="hljs-keyword">HAVING</span> group_condition]<br>[<span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> sort_columns [<span class="hljs-keyword">ASC</span><span class="hljs-operator">|</span><span class="hljs-keyword">DESC</span>]]<br>[LIMIT n]   <span class="hljs-comment">-- 有些方言如 MySQL 支持</span><br></code></pre></td></tr></tbody></table></figure><table><thead><tr><th style="text-align:center">子句</th><th style="text-align:center">功能描述</th></tr></thead><tbody><tr><td style="text-align:center"><code>DISTINCT</code></td><td style="text-align:center">去重，只保留唯一结果。</td></tr><tr><td style="text-align:center"><code>ALL</code></td><td style="text-align:center">不去重，保留所有结果。（默认）</td></tr><tr><td style="text-align:center"><code>GROUP BY</code></td><td style="text-align:center">分组，将结果按某一列归类，通常与聚合函数（如 <code>SUM</code>, <code>COUNT</code>）配合使用。</td></tr><tr><td style="text-align:center"><code>HAVING</code></td><td style="text-align:center">对分组后的结果进行筛选（类似 <code>WHERE</code>，但作用于分组之后）。</td></tr><tr><td style="text-align:center"><code>ORDER BY</code></td><td style="text-align:center">指定结果排序顺序（升序 <code>ASC</code> / 降序 <code>DESC</code>）。</td></tr><tr><td style="text-align:center"><code>LIMIT</code></td><td style="text-align:center">限制返回的行数（如 <code>LIMIT 10</code> 表示最多返回 10 行）。</td></tr></tbody></table><h4 id="SELECT-子句"><code>SELECT</code> 子句</h4><p>每条 <code>SELECT</code> 语句的执行结果是一个<strong>关系</strong>（逻辑上的表），可以看作一个临时的二维表。</p><p>可以在语句中的 <code>select</code> 后使用 <code>distinct</code> 和 <code>all</code> 查找出去重后和去重前的数据。</p><h4 id="FROM-子句"><code>FROM</code> 子句</h4><p><code>FROM</code> 子句用于指定<strong>查询的数据来源表或视图</strong>，是 SQL 查询中最基础的组成部分。</p><ul><li><p>决定<strong>从哪张表或哪些表</strong>中提取数据。</p></li><li><p>多个表可以组合在一起（常见的是使用笛卡尔积或 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>⋈</mo></mrow><annotation encoding="application/x-tex">\Join</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.51em;vertical-align:-.005em"></span><span class="mrel">⋈</span></span></span></span> 连接）。</p></li><li><p>表可以指定别名，以便简化引用。</p></li></ul><h4 id="WHERE-子句"><code>WHERE</code> 子句</h4><p><code>WHERE</code> 子句用于过滤数据行，即<strong>只保留满足条件的记录</strong>。</p><ul><li>添加逻辑判断（如：<code>=</code>, <code>&gt;</code>, <code>&lt;</code>, <code>&lt;&gt;</code>, <code>BETWEEN</code>, <code>LIKE</code>, <code>IN</code>, <code>IS NULL</code> 等）。</li><li>可以使用逻辑运算符（<code>AND</code>, <code>OR</code>, <code>NOT</code>）连接多个条件。</li><li><code>WHERE</code> 是在 <code>FROM</code> 指定的表或组合表上进行行级筛选。</li></ul><h4 id="AS-关键字"><code>AS</code> 关键字</h4><p><code>AS</code> 是一个<strong>别名定义</strong>的关键字，用于给 <strong>列名或表名</strong> 起一个临时的新名字，让查询结果更具有可读性。</p><p><code>AS</code> 其实是可选的关键字，下面两条语句是等价的：</p><figure class="highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> amount <span class="hljs-keyword">AS</span> loan_amount <span class="hljs-keyword">FROM</span> loan;<br><span class="hljs-comment">-- 有 AS</span><br><span class="hljs-keyword">SELECT</span> amount loan_amount <span class="hljs-keyword">FROM</span> loan;<br><span class="hljs-comment">-- 无 AS</span><br></code></pre></td></tr></tbody></table></figure><table><thead><tr><th style="text-align:center">场景</th><th style="text-align:center">示例</th><th style="text-align:center">说明</th></tr></thead><tbody><tr><td style="text-align:center">给列或表起名</td><td style="text-align:center"><code>SELECT name AS 姓名</code></td><td style="text-align:center">改善结果展示，常用于报表</td></tr><tr><td style="text-align:center">给表达式命名</td><td style="text-align:center"><code>SELECT price * qty AS total</code></td><td style="text-align:center">避免无名列</td></tr><tr><td style="text-align:center">多表连接简写</td><td style="text-align:center"><code>FROM employee AS e</code></td><td style="text-align:center">简化引用如 <code>e.name</code></td></tr><tr><td style="text-align:center">子查询别名</td><td style="text-align:center"><code>FROM (SELECT ...) AS temp</code></td><td style="text-align:center">子查询必须起别名</td></tr></tbody></table><h4 id="元组变量">元组变量</h4><p>元组变量就是一个<strong>为表或子查询起的别名</strong>，用来：</p><ul><li>引用表中的属性（字段）</li><li>区分多个同名属性</li><li>支持自连接或多表连接</li></ul><h4 id="字符串运算">字符串运算</h4><p>字符串常量用单引号扩起。</p><p>字符串中包含单引号时需双写单引号：</p><figure class="highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> <span class="hljs-string">'Hello World'</span>; <span class="hljs-comment">-- 正常字符串</span><br><span class="hljs-keyword">SELECT</span> <span class="hljs-string">'It''s OK'</span>;     <span class="hljs-comment">-- 字符串中包含单引号</span><br></code></pre></td></tr></tbody></table></figure><hr><p><code>LIKE</code> 运算符是用来<strong>在字符串中做模糊匹配</strong>的，常用于 <code>WHERE</code> 子句中。</p><p><code>LIKE</code> 运算符使用通配符进行字符串匹配。</p><table><thead><tr><th style="text-align:center">通配符</th><th style="text-align:center">作用</th><th style="text-align:center">示例</th></tr></thead><tbody><tr><td style="text-align:center"><code>%</code></td><td style="text-align:center">匹配任意长度的子串（包括空串）</td><td style="text-align:center"><code>'A%Z'</code> 可匹配 <code>'AZ'</code>, <code>'AbcZ'</code></td></tr><tr><td style="text-align:center"><code>_</code></td><td style="text-align:center">匹配任意一个字符</td><td style="text-align:center"><code>'A_Z'</code> 可匹配 <code>'ABZ'</code>, <code>'ACZ'</code> 但不匹配 <code>'AABZ'</code></td></tr></tbody></table><p>例如：</p><figure class="highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-comment">-- 查找地址中含有“Main”的顾客</span><br><span class="hljs-keyword">SELECT</span> customer_name<br><span class="hljs-keyword">FROM</span> customer<br><span class="hljs-keyword">WHERE</span> customer_street <span class="hljs-keyword">LIKE</span> <span class="hljs-string">'%Main%'</span>;<br><br><span class="hljs-comment">-- 查找名字为三个字母，且中间字母是"a"的顾客</span><br><span class="hljs-keyword">SELECT</span> customer_name<br><span class="hljs-keyword">FROM</span> customer<br><span class="hljs-keyword">WHERE</span> customer_name <span class="hljs-keyword">LIKE</span> <span class="hljs-string">'_a_'</span>;<br></code></pre></td></tr></tbody></table></figure><hr><p>如果要匹配 <code>%</code> 或 <code>_</code> 本身，而不是作为通配符用，可以使用 <code>ESCAPE</code> 关键字定义一个转义字符。</p><p>例如：</p><figure class="highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-comment">-- 查找包含文字 "ab%cd%" 的字段</span><br><span class="hljs-keyword">SELECT</span> col<br><span class="hljs-keyword">FROM</span> <span class="hljs-keyword">table</span><br><span class="hljs-keyword">WHERE</span> col <span class="hljs-keyword">LIKE</span> <span class="hljs-string">'ab#%cd#%'</span> <span class="hljs-keyword">ESCAPE</span> <span class="hljs-string">'#'</span>;<br><span class="hljs-comment">-- # 是自定义的转义字符，这样 #% 就会被解释为实际的 % 字符，而不是通配符。</span><br></code></pre></td></tr></tbody></table></figure><hr><p>SQL 中用 <code>||</code> 把两个字符串拼接起来（注意，不是加号）：</p><figure class="highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> <span class="hljs-string">'Hello'</span> <span class="hljs-operator">||</span> <span class="hljs-string">' '</span> <span class="hljs-operator">||</span> <span class="hljs-string">'World'</span>;<br><span class="hljs-comment">-- 结果：Hello World</span><br></code></pre></td></tr></tbody></table></figure><hr><p>大小写转换函数有：</p><table><thead><tr><th style="text-align:center">函数</th><th style="text-align:center">作用</th><th style="text-align:center">示例</th></tr></thead><tbody><tr><td style="text-align:center"><code>UPPER()</code></td><td style="text-align:center">把字符串转换为大写</td><td style="text-align:center"><code>UPPER('aBc')</code> → <code>'ABC'</code></td></tr><tr><td style="text-align:center"><code>LOWER()</code></td><td style="text-align:center">把字符串转换为小写</td><td style="text-align:center"><code>LOWER('AbC')</code> → <code>'abc'</code></td></tr></tbody></table><h4 id="ORDER-BY-子句"><code>ORDER BY</code> 子句</h4><p><code>ORDER BY</code> 子句用于<strong>对查询结果进行排序</strong>。</p><p>它是 <code>SELECT</code> 语句中<strong>最后执行</strong>的步骤。</p><table><thead><tr><th style="text-align:center">关键字</th><th style="text-align:center">含义</th></tr></thead><tbody><tr><td style="text-align:center"><code>ASC</code>（默认）</td><td style="text-align:center"><strong>升序</strong>：从小到大、从A到Z</td></tr><tr><td style="text-align:center"><code>DESC</code></td><td style="text-align:center"><strong>降序</strong>：从大到小、从Z到A</td></tr></tbody></table><p>当对多个属性排序时，它遵从以下规则：</p><ol><li><p>先按第一个字段排</p></li><li><p>若第一个字段值相等，则按第二个字段排</p></li><li><p>依此类推</p></li></ol><p>例如：</p><figure class="highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">ORDER</span> <span class="hljs-keyword">BY</span> branch_name <span class="hljs-keyword">ASC</span>, amount <span class="hljs-keyword">DESC</span><br><br><span class="hljs-comment">-- 先按 branch_name 升序排列；</span><br><span class="hljs-comment">-- 如果多个记录的 branch_name 相同，再按 amount 降序排列。</span><br></code></pre></td></tr></tbody></table></figure><h4 id="数据重复问题">数据重复问题</h4><p>在标准关系代数中，<strong>关系是集合</strong>，不允许有重复的元组；但在 SQL 中，默认查询结果是一个<strong>多重集</strong>（Multiset），也称<strong>袋</strong>（bag），是允许重复数据的。</p><figure class="highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> branch_name <span class="hljs-keyword">FROM</span> loan;<br><br><span class="hljs-comment">-- 如果表 loan 中有多个贷款来自同一家银行，比如 "Perryridge" 出现了 3 次，那么这个查询结果就会返回 3 个 "Perryridge"，不会自动去重。</span><br><span class="hljs-comment">-- 只有使用 DISTINCT 关键字才会去重</span><br></code></pre></td></tr></tbody></table></figure><hr><p>多重集与集合类似，也是一组元素的集合，但它<strong>允许元素重复</strong>。若 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>A</mi></mrow><annotation encoding="application/x-tex">A</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.6833em"></span><span class="mord mathnormal">A</span></span></span></span> 是一个元素的集合，定义 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>f</mi><mo>:</mo><mi>A</mi><mo>→</mo><mi mathvariant="double-struck">N</mi></mrow><annotation encoding="application/x-tex">f: A \to \mathbb{N}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.8889em;vertical-align:-.1944em"></span><span class="mord mathnormal" style="margin-right:.10764em">f</span><span class="mspace" style="margin-right:.2778em"></span><span class="mrel">:</span><span class="mspace" style="margin-right:.2778em"></span></span><span class="base"><span class="strut" style="height:.6833em"></span><span class="mord mathnormal">A</span><span class="mspace" style="margin-right:.2778em"></span><span class="mrel">→</span><span class="mspace" style="margin-right:.2778em"></span></span><span class="base"><span class="strut" style="height:.6889em"></span><span class="mord mathbb">N</span></span></span></span> 表示每个元素的出现次数，则一个多重集 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>M</mi></mrow><annotation encoding="application/x-tex">M</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.6833em"></span><span class="mord mathnormal" style="margin-right:.10903em">M</span></span></span></span> 可表示为：</p><p class="katex-block"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>M</mi><mo>=</mo><mo stretchy="false">{</mo><mo stretchy="false">(</mo><mi>a</mi><mo separator="true">,</mo><mi>f</mi><mo stretchy="false">(</mo><mi>a</mi><mo stretchy="false">)</mo><mo stretchy="false">)</mo><mo>∣</mo><mi>a</mi><mo>∈</mo><mi>A</mi><mo stretchy="false">}</mo></mrow><annotation encoding="application/x-tex">M = \{ (a, f(a)) \mid a \in A \}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.6833em"></span><span class="mord mathnormal" style="margin-right:.10903em">M</span><span class="mspace" style="margin-right:.2778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right:.2778em"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-.25em"></span><span class="mopen">{(</span><span class="mord mathnormal">a</span><span class="mpunct">,</span><span class="mspace" style="margin-right:.1667em"></span><span class="mord mathnormal" style="margin-right:.10764em">f</span><span class="mopen">(</span><span class="mord mathnormal">a</span><span class="mclose">))</span><span class="mspace" style="margin-right:.2778em"></span><span class="mrel">∣</span><span class="mspace" style="margin-right:.2778em"></span></span><span class="base"><span class="strut" style="height:.5782em;vertical-align:-.0391em"></span><span class="mord mathnormal">a</span><span class="mspace" style="margin-right:.2778em"></span><span class="mrel">∈</span><span class="mspace" style="margin-right:.2778em"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-.25em"></span><span class="mord mathnormal">A</span><span class="mclose">}</span></span></span></span></span></p><blockquote><p>例如：</p><ul><li>集合 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>S</mi><mo>=</mo><mo stretchy="false">{</mo><mi>a</mi><mo separator="true">,</mo><mi>b</mi><mo stretchy="false">}</mo></mrow><annotation encoding="application/x-tex">S = \{ a, b \}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.6833em"></span><span class="mord mathnormal" style="margin-right:.05764em">S</span><span class="mspace" style="margin-right:.2778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right:.2778em"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-.25em"></span><span class="mopen">{</span><span class="mord mathnormal">a</span><span class="mpunct">,</span><span class="mspace" style="margin-right:.1667em"></span><span class="mord mathnormal">b</span><span class="mclose">}</span></span></span></span> 表示 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>a</mi></mrow><annotation encoding="application/x-tex">a</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.4306em"></span><span class="mord mathnormal">a</span></span></span></span>、<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>b</mi></mrow><annotation encoding="application/x-tex">b</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.6944em"></span><span class="mord mathnormal">b</span></span></span></span> 各出现一次</li><li>多重集 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>M</mi><mo>=</mo><mo stretchy="false">{</mo><mi>a</mi><mo separator="true">,</mo><mi>a</mi><mo separator="true">,</mo><mi>b</mi><mo stretchy="false">}</mo></mrow><annotation encoding="application/x-tex">M = \{ a, a, b \}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.6833em"></span><span class="mord mathnormal" style="margin-right:.10903em">M</span><span class="mspace" style="margin-right:.2778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right:.2778em"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-.25em"></span><span class="mopen">{</span><span class="mord mathnormal">a</span><span class="mpunct">,</span><span class="mspace" style="margin-right:.1667em"></span><span class="mord mathnormal">a</span><span class="mpunct">,</span><span class="mspace" style="margin-right:.1667em"></span><span class="mord mathnormal">b</span><span class="mclose">}</span></span></span></span> 可以形式化为：</li></ul><p class="katex-block"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>M</mi><mo>=</mo><mo stretchy="false">{</mo><mo stretchy="false">(</mo><mi>a</mi><mo separator="true">,</mo><mn>2</mn><mo stretchy="false">)</mo><mo separator="true">,</mo><mo stretchy="false">(</mo><mi>b</mi><mo separator="true">,</mo><mn>1</mn><mo stretchy="false">)</mo><mo stretchy="false">}</mo></mrow><annotation encoding="application/x-tex">M = \{ (a, 2), (b, 1) \}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.6833em"></span><span class="mord mathnormal" style="margin-right:.10903em">M</span><span class="mspace" style="margin-right:.2778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right:.2778em"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-.25em"></span><span class="mopen">{(</span><span class="mord mathnormal">a</span><span class="mpunct">,</span><span class="mspace" style="margin-right:.1667em"></span><span class="mord">2</span><span class="mclose">)</span><span class="mpunct">,</span><span class="mspace" style="margin-right:.1667em"></span><span class="mopen">(</span><span class="mord mathnormal">b</span><span class="mpunct">,</span><span class="mspace" style="margin-right:.1667em"></span><span class="mord">1</span><span class="mclose">)}</span></span></span></span></span></p></blockquote><p>我们可以将多重集扩展到关系代数中。</p><ol><li><strong>投影</strong></li></ol><p>如果一个关系 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>R</mi></mrow><annotation encoding="application/x-tex">R</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.6833em"></span><span class="mord mathnormal" style="margin-right:.00773em">R</span></span></span></span> 是多重集，投影后的结果也可能包含重复。</p><p class="katex-block"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><msub><mi>π</mi><mi>A</mi></msub><mo stretchy="false">(</mo><mi>R</mi><mo stretchy="false">)</mo><mo>=</mo><mtext>只保留属性&nbsp;</mtext><mi>A</mi><mtext>&nbsp;后的多重集</mtext></mrow><annotation encoding="application/x-tex">\pi_A(R) = \text{只保留属性 }A\text{ 后的多重集}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-.25em"></span><span class="mord"><span class="mord mathnormal" style="margin-right:.03588em">π</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.3283em"><span style="top:-2.55em;margin-left:-.0359em;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">A</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.15em"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:.00773em">R</span><span class="mclose">)</span><span class="mspace" style="margin-right:.2778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right:.2778em"></span></span><span class="base"><span class="strut" style="height:.6833em"></span><span class="mord text"><span class="mord cjk_fallback">只保留属性</span><span class="mord">&nbsp;</span></span><span class="mord mathnormal">A</span><span class="mord text"><span class="mord">&nbsp;</span><span class="mord cjk_fallback">后的多重集</span></span></span></span></span></span></p><blockquote><p>[例]</p><p class="katex-block"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>R</mi><mo>=</mo><mo stretchy="false">{</mo><mo stretchy="false">(</mo><mn>1</mn><mo separator="true">,</mo><mi>a</mi><mo stretchy="false">)</mo><mo separator="true">,</mo><mo stretchy="false">(</mo><mn>2</mn><mo separator="true">,</mo><mi>a</mi><mo stretchy="false">)</mo><mo stretchy="false">}</mo><mo>⇒</mo><msub><mi>π</mi><mi>B</mi></msub><mo stretchy="false">(</mo><mi>R</mi><mo stretchy="false">)</mo><mo>=</mo><mo stretchy="false">{</mo><mo stretchy="false">(</mo><mi>a</mi><mo stretchy="false">)</mo><mo separator="true">,</mo><mo stretchy="false">(</mo><mi>a</mi><mo stretchy="false">)</mo><mo stretchy="false">}</mo></mrow><annotation encoding="application/x-tex">R = \{ (1,a), (2,a) \} \Rightarrow \pi_B(R) = \{ (a), (a) \}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.6833em"></span><span class="mord mathnormal" style="margin-right:.00773em">R</span><span class="mspace" style="margin-right:.2778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right:.2778em"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-.25em"></span><span class="mopen">{(</span><span class="mord">1</span><span class="mpunct">,</span><span class="mspace" style="margin-right:.1667em"></span><span class="mord mathnormal">a</span><span class="mclose">)</span><span class="mpunct">,</span><span class="mspace" style="margin-right:.1667em"></span><span class="mopen">(</span><span class="mord">2</span><span class="mpunct">,</span><span class="mspace" style="margin-right:.1667em"></span><span class="mord mathnormal">a</span><span class="mclose">)}</span><span class="mspace" style="margin-right:.2778em"></span><span class="mrel">⇒</span><span class="mspace" style="margin-right:.2778em"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-.25em"></span><span class="mord"><span class="mord mathnormal" style="margin-right:.03588em">π</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.3283em"><span style="top:-2.55em;margin-left:-.0359em;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:.05017em">B</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.15em"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:.00773em">R</span><span class="mclose">)</span><span class="mspace" style="margin-right:.2778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right:.2778em"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-.25em"></span><span class="mopen">{(</span><span class="mord mathnormal">a</span><span class="mclose">)</span><span class="mpunct">,</span><span class="mspace" style="margin-right:.1667em"></span><span class="mopen">(</span><span class="mord mathnormal">a</span><span class="mclose">)}</span></span></span></span></span></p></blockquote><ol start="2"><li><strong>选择</strong></li></ol><p>如果某元组满足谓词 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>p</mi></mrow><annotation encoding="application/x-tex">p</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.625em;vertical-align:-.1944em"></span><span class="mord mathnormal">p</span></span></span></span>，那么它的所有重复都保留。</p><p class="katex-block"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><msub><mi>σ</mi><mi>p</mi></msub><mo stretchy="false">(</mo><mi>R</mi><mo stretchy="false">)</mo><mo>=</mo><mo stretchy="false">{</mo><mi>t</mi><mo>∈</mo><mi>R</mi><mo>∣</mo><mi>p</mi><mo stretchy="false">(</mo><mi>t</mi><mo stretchy="false">)</mo><mtext>&nbsp;为真</mtext><mo stretchy="false">}</mo></mrow><annotation encoding="application/x-tex">\sigma_p(R) = \{ t \in R \mid p(t) \text{ 为真} \}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.0361em;vertical-align:-.2861em"></span><span class="mord"><span class="mord mathnormal" style="margin-right:.03588em">σ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.1514em"><span style="top:-2.55em;margin-left:-.0359em;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">p</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.2861em"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:.00773em">R</span><span class="mclose">)</span><span class="mspace" style="margin-right:.2778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right:.2778em"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-.25em"></span><span class="mopen">{</span><span class="mord mathnormal">t</span><span class="mspace" style="margin-right:.2778em"></span><span class="mrel">∈</span><span class="mspace" style="margin-right:.2778em"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-.25em"></span><span class="mord mathnormal" style="margin-right:.00773em">R</span><span class="mspace" style="margin-right:.2778em"></span><span class="mrel">∣</span><span class="mspace" style="margin-right:.2778em"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-.25em"></span><span class="mord mathnormal">p</span><span class="mopen">(</span><span class="mord mathnormal">t</span><span class="mclose">)</span><span class="mord text"><span class="mord">&nbsp;</span><span class="mord cjk_fallback">为真</span></span><span class="mclose">}</span></span></span></span></span></p><ol start="3"><li><strong>笛卡尔积</strong></li></ol><p>假设 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>R</mi></mrow><annotation encoding="application/x-tex">R</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.6833em"></span><span class="mord mathnormal" style="margin-right:.00773em">R</span></span></span></span> 和 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>S</mi></mrow><annotation encoding="application/x-tex">S</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.6833em"></span><span class="mord mathnormal" style="margin-right:.05764em">S</span></span></span></span> 是两个多重集关系，元组 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>t</mi><mi>R</mi></msub></mrow><annotation encoding="application/x-tex">t_R</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.7651em;vertical-align:-.15em"></span><span class="mord"><span class="mord mathnormal">t</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.3283em"><span style="top:-2.55em;margin-left:0;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:.00773em">R</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.15em"><span></span></span></span></span></span></span></span></span></span> 和 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>t</mi><mi>S</mi></msub></mrow><annotation encoding="application/x-tex">t_S</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.7651em;vertical-align:-.15em"></span><span class="mord"><span class="mord mathnormal">t</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.3283em"><span style="top:-2.55em;margin-left:0;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:.05764em">S</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.15em"><span></span></span></span></span></span></span></span></span></span> 出现次数分别为 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>c</mi><mn>1</mn></msub></mrow><annotation encoding="application/x-tex">c_1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.5806em;vertical-align:-.15em"></span><span class="mord"><span class="mord mathnormal">c</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.3011em"><span style="top:-2.55em;margin-left:0;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.15em"><span></span></span></span></span></span></span></span></span></span> 和 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>c</mi><mn>2</mn></msub></mrow><annotation encoding="application/x-tex">c_2</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.5806em;vertical-align:-.15em"></span><span class="mord"><span class="mord mathnormal">c</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.3011em"><span style="top:-2.55em;margin-left:0;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.15em"><span></span></span></span></span></span></span></span></span></span>，那么：</p><p class="katex-block"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><msub><mi>t</mi><mi>R</mi></msub><mo>∈</mo><mi>R</mi><mo separator="true">,</mo><mspace width="1em"></mspace><msub><mi>t</mi><mi>S</mi></msub><mo>∈</mo><mi>S</mi><mo>⇒</mo><mo stretchy="false">(</mo><msub><mi>t</mi><mi>R</mi></msub><mo separator="true">,</mo><msub><mi>t</mi><mi>S</mi></msub><mo stretchy="false">)</mo><mo>∈</mo><mi>R</mi><mo>×</mo><mi>S</mi><mtext>&nbsp;出现&nbsp;</mtext><msub><mi>c</mi><mn>1</mn></msub><mo>⋅</mo><msub><mi>c</mi><mn>2</mn></msub><mtext>&nbsp;次</mtext></mrow><annotation encoding="application/x-tex">t_R \in R, \quad t_S \in S \Rightarrow (t_R, t_S) \in R \times S \text{ 出现 } c_1 \cdot c_2 \text{ 次}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.7651em;vertical-align:-.15em"></span><span class="mord"><span class="mord mathnormal">t</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.3283em"><span style="top:-2.55em;margin-left:0;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:.00773em">R</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.15em"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:.2778em"></span><span class="mrel">∈</span><span class="mspace" style="margin-right:.2778em"></span></span><span class="base"><span class="strut" style="height:.8778em;vertical-align:-.1944em"></span><span class="mord mathnormal" style="margin-right:.00773em">R</span><span class="mpunct">,</span><span class="mspace" style="margin-right:1em"></span><span class="mspace" style="margin-right:.1667em"></span><span class="mord"><span class="mord mathnormal">t</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.3283em"><span style="top:-2.55em;margin-left:0;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:.05764em">S</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.15em"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:.2778em"></span><span class="mrel">∈</span><span class="mspace" style="margin-right:.2778em"></span></span><span class="base"><span class="strut" style="height:.6833em"></span><span class="mord mathnormal" style="margin-right:.05764em">S</span><span class="mspace" style="margin-right:.2778em"></span><span class="mrel">⇒</span><span class="mspace" style="margin-right:.2778em"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-.25em"></span><span class="mopen">(</span><span class="mord"><span class="mord mathnormal">t</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.3283em"><span style="top:-2.55em;margin-left:0;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:.00773em">R</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.15em"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:.1667em"></span><span class="mord"><span class="mord mathnormal">t</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.3283em"><span style="top:-2.55em;margin-left:0;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:.05764em">S</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.15em"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right:.2778em"></span><span class="mrel">∈</span><span class="mspace" style="margin-right:.2778em"></span></span><span class="base"><span class="strut" style="height:.7667em;vertical-align:-.0833em"></span><span class="mord mathnormal" style="margin-right:.00773em">R</span><span class="mspace" style="margin-right:.2222em"></span><span class="mbin">×</span><span class="mspace" style="margin-right:.2222em"></span></span><span class="base"><span class="strut" style="height:.8333em;vertical-align:-.15em"></span><span class="mord mathnormal" style="margin-right:.05764em">S</span><span class="mord text"><span class="mord">&nbsp;</span><span class="mord cjk_fallback">出现</span><span class="mord">&nbsp;</span></span><span class="mord"><span class="mord mathnormal">c</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.3011em"><span style="top:-2.55em;margin-left:0;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.15em"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:.2222em"></span><span class="mbin">⋅</span><span class="mspace" style="margin-right:.2222em"></span></span><span class="base"><span class="strut" style="height:.8333em;vertical-align:-.15em"></span><span class="mord"><span class="mord mathnormal">c</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.3011em"><span style="top:-2.55em;margin-left:0;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.15em"><span></span></span></span></span></span></span><span class="mord text"><span class="mord">&nbsp;</span><span class="mord cjk_fallback">次</span></span></span></span></span></span></p><blockquote><p>[例]</p><p class="katex-block"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mi>R</mi><mo>=</mo><mo stretchy="false">{</mo><mo stretchy="false">(</mo><mn>1</mn><mo separator="true">,</mo><mi>a</mi><mo stretchy="false">)</mo><mo separator="true">,</mo><mo stretchy="false">(</mo><mn>2</mn><mo separator="true">,</mo><mi>a</mi><mo stretchy="false">)</mo><mo stretchy="false">}</mo><mo separator="true">,</mo><mspace width="1em"></mspace><mi>S</mi><mo>=</mo><mo stretchy="false">{</mo><mo stretchy="false">(</mo><mn>3</mn><mo stretchy="false">)</mo><mo separator="true">,</mo><mo stretchy="false">(</mo><mn>3</mn><mo stretchy="false">)</mo><mo stretchy="false">}</mo><mo>⇒</mo><mi>R</mi><mo>×</mo><mi>S</mi><mo>=</mo><mrow><mo fence="true">{</mo><mtable rowspacing="0.36em" columnalign="left left" columnspacing="1em"><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mo stretchy="false">(</mo><mn>1</mn><mo separator="true">,</mo><mi>a</mi><mo separator="true">,</mo><mn>3</mn><mo stretchy="false">)</mo></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mo>×</mo><mn>2</mn></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mo stretchy="false">(</mo><mn>2</mn><mo separator="true">,</mo><mi>a</mi><mo separator="true">,</mo><mn>3</mn><mo stretchy="false">)</mo></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mo>×</mo><mn>2</mn></mrow></mstyle></mtd></mtr></mtable></mrow></mrow><annotation encoding="application/x-tex">R = \{ (1,a), (2,a) \}, \quad S = \{ (3), (3) \} \Rightarrow R \times S = \begin{cases} (1,a,3) &amp;\times 2\\ (2,a,3) &amp;\times 2\\ \end{cases}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.6833em"></span><span class="mord mathnormal" style="margin-right:.00773em">R</span><span class="mspace" style="margin-right:.2778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right:.2778em"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-.25em"></span><span class="mopen">{(</span><span class="mord">1</span><span class="mpunct">,</span><span class="mspace" style="margin-right:.1667em"></span><span class="mord mathnormal">a</span><span class="mclose">)</span><span class="mpunct">,</span><span class="mspace" style="margin-right:.1667em"></span><span class="mopen">(</span><span class="mord">2</span><span class="mpunct">,</span><span class="mspace" style="margin-right:.1667em"></span><span class="mord mathnormal">a</span><span class="mclose">)}</span><span class="mpunct">,</span><span class="mspace" style="margin-right:1em"></span><span class="mspace" style="margin-right:.1667em"></span><span class="mord mathnormal" style="margin-right:.05764em">S</span><span class="mspace" style="margin-right:.2778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right:.2778em"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-.25em"></span><span class="mopen">{(</span><span class="mord">3</span><span class="mclose">)</span><span class="mpunct">,</span><span class="mspace" style="margin-right:.1667em"></span><span class="mopen">(</span><span class="mord">3</span><span class="mclose">)}</span><span class="mspace" style="margin-right:.2778em"></span><span class="mrel">⇒</span><span class="mspace" style="margin-right:.2778em"></span></span><span class="base"><span class="strut" style="height:.7667em;vertical-align:-.0833em"></span><span class="mord mathnormal" style="margin-right:.00773em">R</span><span class="mspace" style="margin-right:.2222em"></span><span class="mbin">×</span><span class="mspace" style="margin-right:.2222em"></span></span><span class="base"><span class="strut" style="height:.6833em"></span><span class="mord mathnormal" style="margin-right:.05764em">S</span><span class="mspace" style="margin-right:.2778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right:.2778em"></span></span><span class="base"><span class="strut" style="height:3em;vertical-align:-1.25em"></span><span class="minner"><span class="mopen delimcenter" style="top:0"><span class="delimsizing size4">{</span></span><span class="mord"><span class="mtable"><span class="col-align-l"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.69em"><span style="top:-3.69em"><span class="pstrut" style="height:3.008em"></span><span class="mord"><span class="mopen">(</span><span class="mord">1</span><span class="mpunct">,</span><span class="mspace" style="margin-right:.1667em"></span><span class="mord mathnormal">a</span><span class="mpunct">,</span><span class="mspace" style="margin-right:.1667em"></span><span class="mord">3</span><span class="mclose">)</span></span></span><span style="top:-2.25em"><span class="pstrut" style="height:3.008em"></span><span class="mord"><span class="mopen">(</span><span class="mord">2</span><span class="mpunct">,</span><span class="mspace" style="margin-right:.1667em"></span><span class="mord mathnormal">a</span><span class="mpunct">,</span><span class="mspace" style="margin-right:.1667em"></span><span class="mord">3</span><span class="mclose">)</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.19em"><span></span></span></span></span></span><span class="arraycolsep" style="width:1em"></span><span class="col-align-l"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:1.69em"><span style="top:-3.69em"><span class="pstrut" style="height:3.008em"></span><span class="mord"><span class="mord">×</span><span class="mord">2</span></span></span><span style="top:-2.25em"><span class="pstrut" style="height:3.008em"></span><span class="mord"><span class="mord">×</span><span class="mord">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:1.19em"><span></span></span></span></span></span></span></span><span class="mclose nulldelimiter"></span></span></span></span></span></span></p><p>总共 4 个元组。</p></blockquote><h4 id="集合运算">集合运算</h4><p>SQL 的<strong>集合运算</strong>（<code>UNION</code>、<code>INTERSECT</code>、<code>EXCEPT</code>）和数学集合一样默认去重，但也提供了 <code>ALL</code> 版本用于保留重复。</p><hr><ol><li><code>UNION</code></li></ol><figure class="highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> ... <span class="hljs-keyword">FROM</span> R<br><span class="hljs-keyword">UNION</span><br><span class="hljs-keyword">SELECT</span> ... <span class="hljs-keyword">FROM</span> S;<br></code></pre></td></tr></tbody></table></figure><p>等价于集合运算 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>R</mi><mo>∪</mo><mi>S</mi></mrow><annotation encoding="application/x-tex">R \cup S</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.6833em"></span><span class="mord mathnormal" style="margin-right:.00773em">R</span><span class="mspace" style="margin-right:.2222em"></span><span class="mbin">∪</span><span class="mspace" style="margin-right:.2222em"></span></span><span class="base"><span class="strut" style="height:.6833em"></span><span class="mord mathnormal" style="margin-right:.05764em">S</span></span></span></span> 。</p><hr><ol start="2"><li><code>INTERSECT</code></li></ol><figure class="highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> ... <span class="hljs-keyword">FROM</span> R<br><span class="hljs-keyword">INTERSECT</span><br><span class="hljs-keyword">SELECT</span> ... <span class="hljs-keyword">FROM</span> S;<br></code></pre></td></tr></tbody></table></figure><p>等价于集合运算 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>R</mi><mo>∩</mo><mi>S</mi></mrow><annotation encoding="application/x-tex">R \cap S</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.6833em"></span><span class="mord mathnormal" style="margin-right:.00773em">R</span><span class="mspace" style="margin-right:.2222em"></span><span class="mbin">∩</span><span class="mspace" style="margin-right:.2222em"></span></span><span class="base"><span class="strut" style="height:.6833em"></span><span class="mord mathnormal" style="margin-right:.05764em">S</span></span></span></span> 。</p><hr><ol start="3"><li><code>EXCEPT</code></li></ol><figure class="highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> ... <span class="hljs-keyword">FROM</span> R<br><span class="hljs-keyword">EXCEPT</span><br><span class="hljs-keyword">SELECT</span> ... <span class="hljs-keyword">FROM</span> S;<br></code></pre></td></tr></tbody></table></figure><p>等价于集合运算 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>R</mi><mo>−</mo><mi>S</mi></mrow><annotation encoding="application/x-tex">R - S</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.7667em;vertical-align:-.0833em"></span><span class="mord mathnormal" style="margin-right:.00773em">R</span><span class="mspace" style="margin-right:.2222em"></span><span class="mbin">−</span><span class="mspace" style="margin-right:.2222em"></span></span><span class="base"><span class="strut" style="height:.6833em"></span><span class="mord mathnormal" style="margin-right:.05764em">S</span></span></span></span> 。</p><hr><p>如果希望保留重复数据，必须显式使用 <code>ALL</code> 关键字。</p><table><thead><tr><th style="text-align:center">操作</th><th style="text-align:center">解释</th></tr></thead><tbody><tr><td style="text-align:center"><code>UNION ALL</code></td><td style="text-align:center">保留所有重复结果</td></tr><tr><td style="text-align:center"><code>INTERSECT ALL</code></td><td style="text-align:center">保留重复次数为两个集合中相同元组出现次数的<strong>最小值</strong></td></tr><tr><td style="text-align:center"><code>EXCEPT ALL</code></td><td style="text-align:center">按出现次数<strong>逐个剔除</strong></td></tr></tbody></table><blockquote><p>[例]</p><p>给定两个查询结果：</p><ul><li>查询 1 返回：<code>{a, a, b}</code></li><li>查询 2 返回：<code>{a, b, b}</code></li></ul><table><thead><tr><th style="text-align:center">操作</th><th style="text-align:center">结果</th><th style="text-align:center">解释</th></tr></thead><tbody><tr><td style="text-align:center"><code>UNION</code></td><td style="text-align:center"><code>{a, b}</code></td><td style="text-align:center">去重合并</td></tr><tr><td style="text-align:center"><code>UNION ALL</code></td><td style="text-align:center"><code>{a, a, a, b, b}</code></td><td style="text-align:center">保留全部重复</td></tr><tr><td style="text-align:center"><code>INTERSECT</code></td><td style="text-align:center"><code>{a, b}</code></td><td style="text-align:center"><code>a</code> 、 <code>b</code> 都出现过，去重</td></tr><tr><td style="text-align:center"><code>INTERSECT ALL</code></td><td style="text-align:center"><code>{a, b}</code></td><td style="text-align:center"><code>a</code> 最小次数是1，<code>b</code> 是1</td></tr><tr><td style="text-align:center"><code>EXCEPT</code></td><td style="text-align:center"><code>{a}</code></td><td style="text-align:center"><code>b</code> 在第二个中也出现，被去除</td></tr><tr><td style="text-align:center"><code>EXCEPT ALL</code></td><td style="text-align:center"><code>{a, a}</code></td><td style="text-align:center">两个 <code>a</code> 被保留（ <code>a</code> 有两个，第二个有一个，保留差值）</td></tr></tbody></table></blockquote><h4 id="分组聚合">分组聚合</h4><p>SQL 提供了一些聚集函数，它们用于对一组数据做运算，返回一个<strong>单一值</strong>：</p><table><thead><tr><th style="text-align:center">函数</th><th style="text-align:center">含义</th></tr></thead><tbody><tr><td style="text-align:center"><code>AVG(x)</code></td><td style="text-align:center">平均值</td></tr><tr><td style="text-align:center"><code>MIN(x)</code></td><td style="text-align:center">最小值</td></tr><tr><td style="text-align:center"><code>MAX(x)</code></td><td style="text-align:center">最大值</td></tr><tr><td style="text-align:center"><code>SUM(x)</code></td><td style="text-align:center">总和</td></tr><tr><td style="text-align:center"><code>COUNT(*)</code></td><td style="text-align:center">总行数（包括 NULL）</td></tr><tr><td style="text-align:center"><code>COUNT(x)</code></td><td style="text-align:center">非 NULL 值的个数</td></tr></tbody></table><hr><p><code>GROUP BY</code> 子句可以将结果按字段进行<strong>分组</strong>：</p><ul><li>它将结果按某些字段分组，每组<strong>分别计算</strong>聚集函数。</li><li>通常和聚集函数一起使用。</li></ul><figure class="highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> branch_name, <span class="hljs-built_in">AVG</span>(balance)<br><span class="hljs-keyword">FROM</span> account<br><span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> branch_name;<br><br><span class="hljs-comment">-- 每个 branch_name 是一个组</span><br><span class="hljs-comment">-- 每组分别计算平均 balance</span><br></code></pre></td></tr></tbody></table></figure><hr><p><code>HAVING</code> 子句用于对分组后的结果进行筛选。</p><table><thead><tr><th style="text-align:center">子句</th><th style="text-align:center">生效阶段</th><th style="text-align:center">作用对象</th></tr></thead><tbody><tr><td style="text-align:center"><code>WHERE</code></td><td style="text-align:center">分组前（原始表数据）</td><td style="text-align:center">单条记录</td></tr><tr><td style="text-align:center"><code>HAVING</code></td><td style="text-align:center">分组后（每组为单位）</td><td style="text-align:center">聚集结果、分组字段等</td></tr></tbody></table><figure class="highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> branch_name, <span class="hljs-built_in">AVG</span>(balance)<br><span class="hljs-keyword">FROM</span> account<br><span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> branch_name<br><span class="hljs-keyword">HAVING</span> <span class="hljs-built_in">AVG</span>(balance) <span class="hljs-operator">&gt;</span> <span class="hljs-number">1200</span>;<br><br><span class="hljs-comment">-- 首先 GROUP BY 将 account 表按 branch_name 分组</span><br><span class="hljs-comment">-- 再用 HAVING 过滤掉平均余额不大于 1200 的组</span><br></code></pre></td></tr></tbody></table></figure><h4 id="空值-NULL-2">空值 <code>NULL</code></h4><p>先前提到的关系代数中的 <code>NULL</code> 和 SQL 中的 <code>NULL</code> 行为类似。</p><p>但有几个特殊的补充用法：</p><ul><li><code>IS [NOT] NULL</code> ：判断是否为 <code>NULL</code> 。</li><li><code>COUNT(*)</code> ：是唯一一个对 <code>NULL</code> 计数的聚集函数。</li><li>支持多重集重复。</li></ul><h3 id="嵌套子查询">嵌套子查询</h3><p>SQL 的嵌套子查询是指在一个 SQL 查询中，把另一个完整的 <code>SELECT</code> 语句<strong>作为子句嵌入到主查询中</strong>。</p><p>这种用法让 SQL 更加强大，支持层层筛选和复杂条件表达。</p><figure class="highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> ...<br><span class="hljs-keyword">FROM</span> ...<br><span class="hljs-keyword">WHERE</span> 某列 OPERATOR (<span class="hljs-keyword">SELECT</span> ... <span class="hljs-keyword">FROM</span> ... <span class="hljs-keyword">WHERE</span> ...);<br><br><span class="hljs-comment">-- 其中的 (SELECT ...) 就是一个 子查询。</span><br></code></pre></td></tr></tbody></table></figure><h4 id="集合子查询">集合子查询</h4><p>集合子查询的核心在于：子查询返回一个值的集合（多行一列），而主查询用这些集合来做判断。</p><hr><p><code>IN</code> 和 <code>NOT IN</code> 关键字用于进行属于和不属于运算。</p><blockquote><figure class="highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-comment">-- 有贷款但无存款的顾客</span><br><span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">DISTINCT</span> customer_name<br><span class="hljs-keyword">FROM</span> borrower<br><span class="hljs-keyword">WHERE</span> customer_name <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">IN</span> (<br>    <span class="hljs-keyword">SELECT</span> customer_name<br>    <span class="hljs-keyword">FROM</span> depositor<br>);<br></code></pre></td></tr></tbody></table></figure></blockquote><div class="note note-warning"><p><code>NOT IN</code> 在处理子查询时，如果结果中包含 <code>NULL</code>，<strong>整个判断可能变成 <code>UNKNOWN</code></strong>，导致该值被排除。</p></div><hr><p><code>SOME</code>（或 <code>ANY</code>）与 <code>ALL</code> 这些运算用于和<strong>子查询结果中的所有或任意值</strong>进行比较。</p><blockquote><p>[例]</p><figure class="highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-comment">-- 找出资产比Brooklyn任意一家银行都高的银行</span><br><span class="hljs-keyword">SELECT</span> branch_name<br><span class="hljs-keyword">FROM</span> branch<br><span class="hljs-keyword">WHERE</span> assets <span class="hljs-operator">&gt;</span> <span class="hljs-keyword">ALL</span> (<br>    <span class="hljs-keyword">SELECT</span> assets<br>    <span class="hljs-keyword">FROM</span> branch<br>    <span class="hljs-keyword">WHERE</span> branch_city <span class="hljs-operator">=</span> <span class="hljs-string">'Brooklyn'</span><br>);<br></code></pre></td></tr></tbody></table></figure></blockquote><hr><p><code>EXISTS</code> 用来判断<strong>子查询的结果是否非空</strong>（存在）。</p><p class="katex-block"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mtext>EXISTS</mtext><mo stretchy="false">(</mo><mi>R</mi><mo stretchy="false">)</mo><mtext>  </mtext><mo>⟺</mo><mtext>  </mtext><mi>R</mi><mo mathvariant="normal">≠</mo><mi mathvariant="normal">∅</mi></mrow><annotation encoding="application/x-tex">\text{EXISTS}(R) \iff R \neq \emptyset</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-.25em"></span><span class="mord text"><span class="mord">EXISTS</span></span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:.00773em">R</span><span class="mclose">)</span><span class="mspace" style="margin-right:.2778em"></span><span class="mspace" style="margin-right:.2778em"></span><span class="mrel">⟺</span><span class="mspace" style="margin-right:.2778em"></span><span class="mspace" style="margin-right:.2778em"></span></span><span class="base"><span class="strut" style="height:.8889em;vertical-align:-.1944em"></span><span class="mord mathnormal" style="margin-right:.00773em">R</span><span class="mspace" style="margin-right:.2778em"></span><span class="mrel"><span class="mrel"><span class="mord vbox"><span class="thinbox"><span class="rlap"><span class="strut" style="height:.8889em;vertical-align:-.1944em"></span><span class="inner"><span class="mord"><span class="mrel"></span></span></span><span class="fix"></span></span></span></span></span><span class="mrel">=</span></span><span class="mspace" style="margin-right:.2778em"></span></span><span class="base"><span class="strut" style="height:.8056em;vertical-align:-.0556em"></span><span class="mord">∅</span></span></span></span></span></p><p class="katex-block"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><semantics><mrow><mtext>NOT&nbsp;EXISTS</mtext><mo stretchy="false">(</mo><mi>R</mi><mo stretchy="false">)</mo><mtext>  </mtext><mo>⟺</mo><mtext>  </mtext><mi>R</mi><mo>=</mo><mi mathvariant="normal">∅</mi></mrow><annotation encoding="application/x-tex">\text{NOT EXISTS}(R) \iff R = \emptyset</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-.25em"></span><span class="mord text"><span class="mord">NOT&nbsp;EXISTS</span></span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:.00773em">R</span><span class="mclose">)</span><span class="mspace" style="margin-right:.2778em"></span><span class="mspace" style="margin-right:.2778em"></span><span class="mrel">⟺</span><span class="mspace" style="margin-right:.2778em"></span><span class="mspace" style="margin-right:.2778em"></span></span><span class="base"><span class="strut" style="height:.6833em"></span><span class="mord mathnormal" style="margin-right:.00773em">R</span><span class="mspace" style="margin-right:.2778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right:.2778em"></span></span><span class="base"><span class="strut" style="height:.8056em;vertical-align:-.0556em"></span><span class="mord">∅</span></span></span></span></span></p><p><code>EXISTS</code>的子查询通常依赖于外层查询的某些值（相关子查询），每一行主查询记录都会执行一次子查询。</p><blockquote><p>[例] 找出既有存款又有贷款的顾客：</p><figure class="highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">DISTINCT</span> customer_name<br><span class="hljs-keyword">FROM</span> borrower <span class="hljs-keyword">AS</span> R<br><span class="hljs-keyword">WHERE</span> <span class="hljs-keyword">EXISTS</span> (<br>    <span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span><br>    <span class="hljs-keyword">FROM</span> depositor <span class="hljs-keyword">AS</span> S<br>    <span class="hljs-keyword">WHERE</span> S.customer_name <span class="hljs-operator">=</span> R.customer_name<br>);<br></code></pre></td></tr></tbody></table></figure></blockquote><hr><blockquote><p>[例] 找出在 <em>Brooklyn</em> 所有银行都有存款的顾客：</p><figure class="highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> <span class="hljs-keyword">DISTINCT</span> S.customer_name<br><span class="hljs-keyword">FROM</span> depositor <span class="hljs-keyword">AS</span> S<br><span class="hljs-keyword">WHERE</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">EXISTS</span> (<br>    (<span class="hljs-keyword">SELECT</span> branch_name<br>     <span class="hljs-keyword">FROM</span> branch<br>     <span class="hljs-keyword">WHERE</span> branch_city <span class="hljs-operator">=</span> <span class="hljs-string">'Brooklyn'</span>)<br>     <br>    <span class="hljs-keyword">EXCEPT</span><br>    <br>    (<span class="hljs-keyword">SELECT</span> R.branch_name<br>     <span class="hljs-keyword">FROM</span> depositor <span class="hljs-keyword">AS</span> T, account <span class="hljs-keyword">AS</span> R<br>     <span class="hljs-keyword">WHERE</span> T.account_number <span class="hljs-operator">=</span> R.account_number<br>       <span class="hljs-keyword">AND</span> S.customer_name <span class="hljs-operator">=</span> T.customer_name)<br>);<br></code></pre></td></tr></tbody></table></figure></blockquote><hr><p><code>UNIQUE</code> 用来<strong>判断子查询的结果是否包含重复的元组</strong>。如果子查询返回的结果中所有元组都不重复（即结果集是一个集合而不是多重集），则 <code>UNIQUE</code> 为 <code>TRUE</code>；否则为 <code>FALSE</code>。</p><blockquote><p>[例] 找出在 <em>Perryridge</em> 拥有多个存款账户的顾客。</p><figure class="highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> T.customer_name<br><span class="hljs-keyword">FROM</span> depositor <span class="hljs-keyword">AS</span> T<br><span class="hljs-keyword">WHERE</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">UNIQUE</span> (<br>    <span class="hljs-keyword">SELECT</span> R.customer_name<br>    <span class="hljs-keyword">FROM</span> account <span class="hljs-keyword">AS</span> S, depositor <span class="hljs-keyword">AS</span> R<br>    <span class="hljs-keyword">WHERE</span> T.customer_name <span class="hljs-operator">=</span> R.customer_name<br>      <span class="hljs-keyword">AND</span> R.account_number <span class="hljs-operator">=</span> S.account_number<br>      <span class="hljs-keyword">AND</span> S.branch_name <span class="hljs-operator">=</span> <span class="hljs-string">'Perryridge'</span><br>);<br></code></pre></td></tr></tbody></table></figure></blockquote><div class="note note-warning"><p>现代 SQL 很少使用 <code>UNIQUE</code>，因为更常用的是 <code>GROUP BY ... HAVING</code> 或聚集函数，如对于上面的例子：</p><figure class="highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> customer_name<br><span class="hljs-keyword">FROM</span> depositor D, account A<br><span class="hljs-keyword">WHERE</span> D.account_number <span class="hljs-operator">=</span> A.account_number<br>  <span class="hljs-keyword">AND</span> A.branch_name <span class="hljs-operator">=</span> <span class="hljs-string">'Perryridge'</span><br><span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> customer_name<br><span class="hljs-keyword">HAVING</span> <span class="hljs-built_in">COUNT</span>(<span class="hljs-operator">*</span>) <span class="hljs-operator">=</span> <span class="hljs-number">1</span>;  <span class="hljs-comment">-- 只有一个账户</span><br></code></pre></td></tr></tbody></table></figure></div><h4 id="派生关系">派生关系</h4><p>在 <code>FROM</code> 子句中使用一个<strong>完整的</strong> <code>SELECT</code> 查询，把它看作一张“临时表”或“中间表”。这就是派生关系，其语法结构如下：</p><figure class="highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> ...<br><span class="hljs-keyword">FROM</span> (<span class="hljs-keyword">SELECT</span> ... <span class="hljs-keyword">FROM</span> ...) <span class="hljs-keyword">AS</span> 别名(列名<span class="hljs-number">1</span>, 列名<span class="hljs-number">2</span>, ...)<br><br><span class="hljs-comment">-- 也可以写成：</span><br><br><span class="hljs-keyword">SELECT</span> ...<br><span class="hljs-keyword">FROM</span> (<span class="hljs-keyword">SELECT</span> ... <span class="hljs-keyword">FROM</span> ...) <span class="hljs-keyword">AS</span> 别名<br></code></pre></td></tr></tbody></table></figure><blockquote><p>[例] 选出平均存款额超过1200元的银行</p><figure class="highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> branch_name, avg_balance<br><span class="hljs-keyword">FROM</span> (<br>    <span class="hljs-keyword">SELECT</span> branch_name, <span class="hljs-built_in">AVG</span>(balance) <span class="hljs-keyword">AS</span> avg_balance<br>    <span class="hljs-keyword">FROM</span> account<br>    <span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> branch_name<br>) <span class="hljs-keyword">AS</span> branch_avg<br><span class="hljs-keyword">WHERE</span> avg_balance <span class="hljs-operator">&gt;</span> <span class="hljs-number">1200</span>;<br></code></pre></td></tr></tbody></table></figure></blockquote><p>这种方式将<strong>复杂计算逻辑封装为临时表</strong>，逻辑清晰，且更容易进行多层分析，比如：先聚合，再排序，再筛选。</p><div class="note note-warning"><p>必须给子查询<strong>起别名</strong>（如 <code>branch_avg</code>），否则 SQL 会报错。</p></div><hr><p><code>WITH</code> 子句是 SQL 中的一种重要特性，叫做<strong>公共表表达式</strong>（Common Table Expression, CTE）。它的核心目的是：<strong>在查询中定义临时的、具有名字的中间结果表</strong>，并在同一条查询中引用这些临时表，让 SQL 更加清晰、结构化。</p><figure class="highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">WITH</span> 临时表名(列名<span class="hljs-number">1</span>, 列名<span class="hljs-number">2</span>, ...) <span class="hljs-keyword">AS</span> (<br>    子查询<br>)<br>主查询;<br><br><span class="hljs-comment">-- 也可以定义多张临时的表：</span><br><span class="hljs-keyword">WITH</span> 表<span class="hljs-number">1</span> <span class="hljs-keyword">AS</span> (...),<br>     表<span class="hljs-number">2</span> <span class="hljs-keyword">AS</span> (...)<br><span class="hljs-keyword">SELECT</span> ...<br><span class="hljs-keyword">FROM</span> 表<span class="hljs-number">1</span>, 表<span class="hljs-number">2</span><br><span class="hljs-keyword">WHERE</span> ...<br><br></code></pre></td></tr></tbody></table></figure><blockquote><p>[例] 查询存款总额超过平均值的银行：</p><figure class="highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">WITH</span> branch_total(branch_name, <span class="hljs-keyword">value</span>) <span class="hljs-keyword">AS</span> (<br>    <span class="hljs-keyword">SELECT</span> branch_name, <span class="hljs-built_in">SUM</span>(balance)<br>    <span class="hljs-keyword">FROM</span> account<br>    <span class="hljs-keyword">GROUP</span> <span class="hljs-keyword">BY</span> branch_name<br>),<br>branch_total_avg(<span class="hljs-keyword">value</span>) <span class="hljs-keyword">AS</span> (<br>    <span class="hljs-keyword">SELECT</span> <span class="hljs-built_in">AVG</span>(<span class="hljs-keyword">value</span>)<br>    <span class="hljs-keyword">FROM</span> branch_total<br>    <span class="hljs-comment">-- 这个表只有一行一列</span><br>)<br><span class="hljs-keyword">SELECT</span> branch_name<br><span class="hljs-keyword">FROM</span> branch_total, branch_total_avg<br><span class="hljs-keyword">WHERE</span> branch_total.value <span class="hljs-operator">&gt;</span> branch_total_avg.value;<br></code></pre></td></tr></tbody></table></figure><ol><li><code>branch_total</code>：计算每个银行的存款总额。</li><li><code>branch_total_avg</code>：计算所有银行存款总额的平均值。</li><li>外层查询筛选出大于平均值的银行名称。</li></ol></blockquote><div class="fold"><div class="fold-title fold-info collapsed" data-toggle="collapse" href="#collapse-7f5633ea" role="button" aria-expanded="false" aria-controls="collapse-7f5633ea"><div class="fold-arrow">▶</div>WITH 关键字的优点</div><div class="fold-collapse collapse" id="collapse-7f5633ea"><div class="fold-content"><table><thead><tr><th style="text-align:center">优点</th><th style="text-align:center">描述</th></tr></thead><tbody><tr><td style="text-align:center">可读性强</td><td style="text-align:center">逻辑清晰，避免嵌套太深，结构更像“步骤拆解”</td></tr><tr><td style="text-align:center">可复用</td><td style="text-align:center">如果多个子查询依赖相同的中间结果，不需要写多次</td></tr><tr><td style="text-align:center">支持递归查询</td><td style="text-align:center"><code>WITH RECURSIVE</code> 可用于图、层级结构等场景（如祖先/子代查询）</td></tr><tr><td style="text-align:center">仅在当前查询有效</td><td style="text-align:center">作用域局限，生命周期短，不污染数据库全局命名空间</td></tr></tbody></table></div></div></div><h3 id="数据删除">数据删除</h3><p>使用 <code>DELETE</code> 语句进行数据删除：</p><figure class="highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">DELETE</span> <span class="hljs-keyword">FROM</span> 表名<br>[<span class="hljs-keyword">WHERE</span> 条件];<br><span class="hljs-comment">-- 如果忽略掉 WHERE 子句就会把整张表的内容全删了，只留下框架</span><br></code></pre></td></tr></tbody></table></figure><blockquote><p>[例] 删除位于 <em>Brooklyn</em> 的银行的所有账户</p><figure class="highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">DELETE</span> <span class="hljs-keyword">FROM</span> account<br><span class="hljs-keyword">WHERE</span> branch_name <span class="hljs-keyword">IN</span> (<br>  <span class="hljs-keyword">SELECT</span> branch_name<br>  <span class="hljs-keyword">FROM</span> branch<br>  <span class="hljs-keyword">WHERE</span> branch_city <span class="hljs-operator">=</span> <span class="hljs-string">'Brooklyn'</span><br>);<br></code></pre></td></tr></tbody></table></figure></blockquote><div class="note note-warning"><ol><li><code>DELETE</code>是逐行删除的，事务安全，可以配合 <code>ROLLBACK</code> 撤销；</li><li>删除操作不会自动影响关联表（如外键引用），除非设置了 <code>ON DELETE CASCADE</code>；</li><li><strong>不能跨表同时删除</strong>：一次只能删除一个表中的数据；</li><li>大量删除操作可能会触发大量写操作和锁表，建议批量或分页删除。</li></ol></div><table><thead><tr><th style="text-align:center">操作</th><th style="text-align:center">描述</th></tr></thead><tbody><tr><td style="text-align:center"><code>DELETE FROM WHERE</code></td><td style="text-align:center">删除一行或多行</td></tr><tr><td style="text-align:center"><code>DELETE FROM (无 WHERE)</code></td><td style="text-align:center">删除整个表内容，但保留表结构</td></tr><tr><td style="text-align:center"><code>TRUNCATE</code></td><td style="text-align:center">更快的方式清空表（不可回滚）</td></tr><tr><td style="text-align:center"><code>DROP TABLE</code></td><td style="text-align:center">删除整个表和数据</td></tr></tbody></table><h3 id="数据插入">数据插入</h3><p>使用 <code>INSERT INTO VALUES</code> 语句将数据元组插入表中。</p><figure class="highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> 表名 <span class="hljs-keyword">VALUES</span> (值<span class="hljs-number">1</span>, 值<span class="hljs-number">2</span>, 值<span class="hljs-number">3</span>, ...);<br><br><span class="hljs-comment">-- 也可以用下面更清晰的写法，显式指定列名：</span><br><br><span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> 表名 (列<span class="hljs-number">1</span>, 列<span class="hljs-number">2</span>, 列<span class="hljs-number">3</span>, ...)<br><span class="hljs-keyword">VALUES</span> (值<span class="hljs-number">1</span>, 值<span class="hljs-number">2</span>, 值<span class="hljs-number">3</span>, ...);<br></code></pre></td></tr></tbody></table></figure><p>也可以用 <code>INSERT INTO SELECT</code> <strong>子查询语句</strong>插入多条数据元组。</p><blockquote><p>[例] 给 <em>Perryridge</em> 分行的所有贷款客户送 200 美元并新建账户。</p><figure class="highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> account<br><span class="hljs-keyword">SELECT</span> loan_number, branch_name, <span class="hljs-number">200</span><br><span class="hljs-keyword">FROM</span> loan<br><span class="hljs-keyword">WHERE</span> branch_name <span class="hljs-operator">=</span> <span class="hljs-string">'Perryridge'</span>;<br></code></pre></td></tr></tbody></table></figure></blockquote><hr><p>插入数据需要符合以下条件：</p><ul><li><strong>列数和指定类型匹配</strong></li><li>满足主键唯一约束，<strong>保证主键不重复</strong></li></ul><p>对于<strong>未指定的列</strong>，插入动作会有以下行为：</p><ul><li>若定义了默认值，则用默认值插入当前列</li><li>否则会被赋空值 <code>NULL</code></li></ul><h3 id="数据更新">数据更新</h3><p>使用 <code>UPDATE</code> 语句进行数据更新。</p><figure class="highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">UPDATE</span> 表名<br><span class="hljs-keyword">SET</span> 列名 <span class="hljs-operator">=</span> 新值<br>[<span class="hljs-keyword">WHERE</span> 条件];<br><br><span class="hljs-comment">-- 如果省略 WHERE 语句，则会更新整张表的所有记录</span><br></code></pre></td></tr></tbody></table></figure><p><code>CASE</code> 语句用于条件分支：</p><figure class="highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">CASE</span><br>    <span class="hljs-keyword">WHEN</span> 条件<span class="hljs-number">1</span> <span class="hljs-keyword">THEN</span> 结果<span class="hljs-number">1</span><br>    <span class="hljs-keyword">WHEN</span> 条件<span class="hljs-number">2</span> <span class="hljs-keyword">THEN</span> 结果<span class="hljs-number">2</span><br>    ...<br>    <span class="hljs-keyword">ELSE</span> 默认值<br><span class="hljs-keyword">END</span><br></code></pre></td></tr></tbody></table></figure><blockquote><p>[例] 分情况加息（余额 ≤ 10000 按 5%，否则 6%）</p><figure class="highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">UPDATE</span> account<br><span class="hljs-keyword">SET</span> balance <span class="hljs-operator">=</span> <span class="hljs-keyword">CASE</span><br>    <span class="hljs-keyword">WHEN</span> balance <span class="hljs-operator">&lt;=</span> <span class="hljs-number">10000</span> <span class="hljs-keyword">THEN</span> balance <span class="hljs-operator">*</span> <span class="hljs-number">1.05</span><br>    <span class="hljs-keyword">ELSE</span> balance <span class="hljs-operator">*</span> <span class="hljs-number">1.06</span><br><span class="hljs-keyword">END</span>;<br></code></pre></td></tr></tbody></table></figure></blockquote><h3 id="视图">视图</h3><p>视图是一个<strong>虚拟表</strong>，它是由一个 <strong>SQL 查询语句的结果定义的表</strong>。视图本身不存储数据，而是依赖于底层表的数据。</p><figure class="highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">VIEW</span> 视图名 <span class="hljs-keyword">AS</span><br><span class="hljs-keyword">SELECT</span> ...<br><span class="hljs-keyword">FROM</span> ...<br><span class="hljs-keyword">WHERE</span> ...;<br></code></pre></td></tr></tbody></table></figure><p>视图本质上是一个<strong>查询的别名或封装</strong>。当你在查询中使用一个视图时，SQL 引擎并不会直接从某个表中读取数据，而是将视图的定义<strong>展开</strong>成原始查询语句，再执行，这就叫<strong>视图展开</strong>：</p><ol><li>查询一个视图 <code>v1</code>；</li><li>SQL 系统会查找 <code>v1</code> 的定义（一个查询表达式 <code>e1</code>）；</li><li>如果 <code>e1</code> 中还引用了另一个视图 <code>v2</code>，则继续展开 <code>v2</code>；</li><li>直到最终表达式中只包含基础表。</li></ol><hr><p>视图的主要作用包括：</p><ol><li><strong>简化复杂查询</strong>：将复杂的多表连接或聚合查询封装成一个视图，后续查询更简洁。</li><li><strong>提高重用性</strong>：可以在多个查询中使用视图，提高开发效率。</li><li><strong>数据安全</strong>：通过视图只暴露部分列或部分行，限制用户访问敏感数据。</li><li><strong>逻辑抽象</strong>：屏蔽底层表的结构变化，对上层应用提供稳定接口。</li></ol><hr><p>在定义完视图后，可以在任何地方像使用普通表一样使用它：</p><ul><li>在 <code>FROM</code> 子句中使用；</li><li>可以对视图做 <code>JOIN</code>、<code>GROUP BY</code>、<code>ORDER BY</code>、嵌套子查询等；</li><li>也可以基于视图创建新视图（多层嵌套）；</li></ul><div class="note note-warning"><ul><li><strong>视图中的数据是动态的</strong>：每次查询视图时，系统都会执行它背后的查询语句。</li><li>对于需要频繁使用的复杂查询，视图可以提升开发效率，但不要滥用（尤其在高性能场景中）。</li></ul></div><hr><p>与普通视图不同，<strong>物化视图</strong>是将视图的结果<strong>物理存储在数据库</strong>中的，就像一张表一样。</p><p>这意味着查询物化视图不需要重新计算底层查询。</p><div class="note note-warning"><p>需要注意，标准 SQL 中不直接支持 <code>MATERIALIZED VIEW</code>，但许多数据库支持它，如：</p><ul><li>PostgreSQL</li><li>Oracle</li><li>MySQL（通过触发器/临时表实现）</li><li>SQL Server（用 indexed views）</li></ul></div><h4 id="视图更新">视图更新</h4><ul><li>有些视图是可以更新的（称为 <strong>可更新视图</strong>）。</li><li>有些视图不可以更新（称为 <strong>不可更新视图</strong>）。</li></ul><p>是否可更新，取决于视图的结构是否能<strong>唯一映射</strong>到其底层基表的数据，需要满足以下条件：</p><ul><li><code>FROM</code> 子句中 <strong>只涉及一个基表</strong></li><li><code>SELECT</code> 中 <strong>不包含聚合函数</strong>（如 <code>SUM</code>、<code>AVG</code> 等）</li><li><code>SELECT</code> 中 <strong>没有表达式</strong>（如 <code>a + b</code>、<code>COUNT(*)</code>）</li><li><strong>没有 <code>DISTINCT</code></strong></li><li><strong>没有 <code>GROUP BY</code>、<code>HAVING</code></strong></li><li><strong>视图列不包含空值或派生列</strong>（特别是缺少主键的情况）</li><li><strong>没有使用 <code>UNION</code>、<code>JOIN</code> 等多表操作</strong>（或这些操作能被推导）</li></ul><blockquote><figure class="highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">VIEW</span> loan_branch <span class="hljs-keyword">AS</span><br><span class="hljs-keyword">SELECT</span> loan_number, branch_name <span class="hljs-keyword">FROM</span> loan;<br><br><span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> loan_branch <span class="hljs-keyword">VALUES</span> (<span class="hljs-string">'L-37'</span>, <span class="hljs-string">'Perryridge'</span>);<br></code></pre></td></tr></tbody></table></figure><p>该视图缺少 <code>amount</code> 字段，视图只包含两个列，但底层表 <code>loan</code> 有三个字段：<code>loan_number</code>, <code>branch_name</code>, <code>amount</code>。</p><p>可能导致插入时，系统无法知道 <code>amount</code> 应该是多少，因此会将其设为 <code>NULL</code>，而这可能违反表的约束（如 <code>NOT NULL</code>）。</p></blockquote><hr><blockquote><figure class="highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">VIEW</span> loan_info <span class="hljs-keyword">AS</span><br><span class="hljs-keyword">SELECT</span> customer_name, amount<br><span class="hljs-keyword">FROM</span> borrower, loan<br><span class="hljs-keyword">WHERE</span> borrower.loan_number <span class="hljs-operator">=</span> loan.loan_number;<br><br><span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> loan_info <span class="hljs-keyword">VALUES</span> (<span class="hljs-string">'Johnson'</span>, <span class="hljs-number">1900</span>);<br></code></pre></td></tr></tbody></table></figure><p>该视图来自于两个表 <code>borrower</code> 和 <code>loan</code> 的连接。插入时，系统无法判断这条记录应该插入哪个表、哪些字段，尤其是关联键（如 <code>loan_number</code>）也缺失。</p><div class="note note-warning"><blockquote><p>多表连接视图基本是<strong>不可更新的</strong>。</p></blockquote></div></blockquote><hr><blockquote><figure class="highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-operator">&gt;</span><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">VIEW</span> loan_downtown <span class="hljs-keyword">AS</span><br><span class="hljs-operator">&gt;</span><span class="hljs-keyword">SELECT</span> loan_number, branch_name, amount<br><span class="hljs-operator">&gt;</span><span class="hljs-keyword">FROM</span> loan<br><span class="hljs-operator">&gt;</span><span class="hljs-keyword">WHERE</span> branch_name <span class="hljs-operator">=</span> <span class="hljs-string">'Downtown'</span>;<br><br><span class="hljs-operator">&gt;</span><span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> loan_downtown <span class="hljs-keyword">VALUES</span> (<span class="hljs-string">'L-37'</span>, <span class="hljs-string">'Perryridge'</span>, <span class="hljs-number">800</span>);<br></code></pre></td></tr></tbody></table></figure><p>定义的视图只显示 <code>Downtown</code> 分行的记录，但却插入了 <code>Perryridge</code>。</p><p>违反了视图的 <code>WHERE</code> 逻辑：如果视图只接受 <code>branch_name = 'Downtown'</code>，却插入了别的分行，这条记录在视图里根本不会被看到。</p><p>就算语法允许，这类插入会造成<strong>逻辑上的自我矛盾</strong>。</p></blockquote><hr><blockquote><figure class="highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">VIEW</span> all_customer <span class="hljs-keyword">AS</span><br>(<br>  <span class="hljs-keyword">SELECT</span> branch_name, customer_name <span class="hljs-keyword">FROM</span> depositor, account <span class="hljs-keyword">WHERE</span> ...<br>  <span class="hljs-keyword">UNION</span><br>  <span class="hljs-keyword">SELECT</span> branch_name, customer_name <span class="hljs-keyword">FROM</span> borrower, loan <span class="hljs-keyword">WHERE</span> ...<br>);<br><br><span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> all_customer <span class="hljs-keyword">VALUES</span> (<span class="hljs-string">'Perryridge'</span>, <span class="hljs-string">'John'</span>);<br></code></pre></td></tr></tbody></table></figure><p>这是一个 <code>UNION</code> 组成的视图。插入数据时，系统无法判断应该插入哪个表、通过哪个路径（<em>depositor/account or borrower/loan?</em>）。</p><p>具有 <code>UNION</code>、<code>JOIN</code> 的视图一般是<strong>不可更新的</strong>，除非使用 <code>INSTEAD OF TRIGGER</code> 来手动实现插入逻辑（高级特性）。</p></blockquote><h3 id="事务">事务</h3><p>事务是用户定义的一个<strong>操作序列</strong>，这个序列中的所有操作要么全部成功执行，要么全部不执行。</p><p>事务有四大特性，简称 ACID ：</p><table><thead><tr><th style="text-align:center"></th><th style="text-align:center">含义</th><th style="text-align:center">解释</th></tr></thead><tbody><tr><td style="text-align:center"><strong>A</strong>tomicity</td><td style="text-align:center">原子性</td><td style="text-align:center">事务中所有操作是一个整体，<strong>不可分割</strong>，要么全部执行成功，要么全部失败。</td></tr><tr><td style="text-align:center"><strong>C</strong>onsistency</td><td style="text-align:center">一致性</td><td style="text-align:center">事务执行前后，数据库都处于<strong>一致状态</strong>，不会破坏数据的完整性约束。</td></tr><tr><td style="text-align:center"><strong>I</strong>solation</td><td style="text-align:center">隔离性</td><td style="text-align:center">多个事务并发执行时，彼此操作<strong>互不干扰</strong>。如 A 在转账，B 不能看到中间过程。</td></tr><tr><td style="text-align:center"><strong>D</strong>urability</td><td style="text-align:center">持久性</td><td style="text-align:center">事务一旦提交，所做的修改<strong>永久生效</strong>，即使断电或崩溃也能恢复。</td></tr></tbody></table><p>事务的语法如下（一种语法）：</p><figure class="highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">BEGIN</span> <span class="hljs-keyword">ATOMIC</span><br>   <span class="hljs-comment">-- 一组语句</span><br>   <span class="hljs-keyword">UPDATE</span> ...;<br>   <span class="hljs-keyword">INSERT</span> ...;<br><span class="hljs-keyword">END</span>;<br></code></pre></td></tr></tbody></table></figure><p>如果事务在执行的任一语句中出错，则：</p><figure class="highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">ROLLBACK</span>;<br></code></pre></td></tr></tbody></table></figure><p>进行回滚，回到最初状态。</p><h3 id="连接">连接</h3><p>和关系代数中连接的概念类似，连接是把两个或多个关系表通过某种匹配条件组合在一起查询的操作。通常用于：</p><ul><li><strong>组合多个表中的数据</strong>（如客户信息和账户信息）</li><li><strong>通过外键关系查找关联数据</strong></li><li><strong>过滤符合某些联合条件的数据</strong></li></ul><table><thead><tr><th style="text-align:center">类型</th><th style="text-align:center">描述</th></tr></thead><tbody><tr><td style="text-align:center"><code>INNER JOIN</code></td><td style="text-align:center">只保留<strong>两个表中匹配的记录</strong>。</td></tr><tr><td style="text-align:center"><code>LEFT OUTER JOIN</code></td><td style="text-align:center">返回左表所有记录，右表匹配不到的用 <code>NULL</code> 填充。</td></tr><tr><td style="text-align:center"><code>RIGHT OUTER JOIN</code></td><td style="text-align:center">返回右表所有记录，左表匹配不到的用 <code>NULL</code> 填充。</td></tr><tr><td style="text-align:center"><code>FULL OUTER JOIN</code></td><td style="text-align:center">返回左右表所有记录，未匹配的用 <code>NULL</code> 填充。</td></tr></tbody></table><hr><p>连接条件有以下几种：</p><table><thead><tr><th style="text-align:center">方式</th><th style="text-align:center">说明</th></tr></thead><tbody><tr><td style="text-align:center"><code>ON</code></td><td style="text-align:center">指定连接条件，常见写法：<code>ON A.key = B.key</code></td></tr><tr><td style="text-align:center"><code>USING(列名)</code></td><td style="text-align:center">当两个表有<strong>相同列名</strong>时，自动以该列连接</td></tr><tr><td style="text-align:center"><code>NATURAL JOIN</code></td><td style="text-align:center">自动根据两个表中<strong>名字相同的列</strong>进行等值连接</td></tr></tbody></table><hr><blockquote><p>[例] 查找有存款无贷款的客户</p><figure class="highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> d_CN<br><span class="hljs-keyword">FROM</span> (<br>    depositor <span class="hljs-keyword">LEFT</span> <span class="hljs-keyword">OUTER</span> <span class="hljs-keyword">JOIN</span> borrower<br>    <span class="hljs-keyword">ON</span> depositor.customer <span class="hljs-operator">=</span> borrower.customer<br>) <span class="hljs-keyword">AS</span> db1(d_CN, account_number, b_CN, loan_number)<br><span class="hljs-keyword">WHERE</span> b_CN <span class="hljs-keyword">IS</span> <span class="hljs-keyword">NULL</span>;<br></code></pre></td></tr></tbody></table></figure><p><strong>解释</strong>：</p><ul><li>用左连接保留 <code>depositor</code> 的所有记录；</li><li><code>b_CN</code> 是 <code>borrower.customer</code>；</li><li>如果某客户没有贷款，<code>b_CN</code> 就是 <code>NULL</code>；</li><li>所以筛选出只有存款、<strong>没有贷款</strong>的客户。</li></ul></blockquote><hr><blockquote><p>[例] 查找只有贷款或只有存款的客户</p><figure class="highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">SELECT</span> customer_name<br><span class="hljs-keyword">FROM</span> (<br> depositor <span class="hljs-keyword">NATURAL</span> <span class="hljs-keyword">FULL</span> <span class="hljs-keyword">OUTER</span> <span class="hljs-keyword">JOIN</span> borrower<br>)<br><span class="hljs-keyword">WHERE</span> account_number <span class="hljs-keyword">IS</span> <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">OR</span> loan_number <span class="hljs-keyword">IS</span> <span class="hljs-keyword">NULL</span>;<br></code></pre></td></tr></tbody></table></figure><p><strong>解释</strong>：</p><ul><li>使用 <code>FULL OUTER JOIN</code> 保留两个表所有客户；</li><li><code>account_number IS NULL</code> 表示没有存款；</li><li><code>loan_number IS NULL</code> 表示没有贷款；</li><li>所以筛选的是 <strong>只有一种关系的客户</strong>。</li></ul></blockquote><h2 id="高级-SQL">高级 SQL</h2><h3 id="高级数据类型">高级数据类型</h3><h4 id="内建数据类型">内建数据类型</h4><p>除了 <strong>基本数据类型</strong> ， SQL 还支持其他的一些类型，例如：</p><table><thead><tr><th style="text-align:center">类型</th><th style="text-align:center">含义</th><th style="text-align:center">示例</th></tr></thead><tbody><tr><td style="text-align:center"><code>DATE</code></td><td style="text-align:center">表示日期（年-月-日）</td><td style="text-align:center"><code>'2025-04-29'</code></td></tr><tr><td style="text-align:center"><code>TIME</code></td><td style="text-align:center">表示时间（时:分:秒）</td><td style="text-align:center"><code>'14:30:00'</code></td></tr><tr><td style="text-align:center"><code>TIMESTAMP</code></td><td style="text-align:center">表示完整的日期时间（含毫秒）</td><td style="text-align:center"><code>'2025-04-29 14:30:00'</code></td></tr></tbody></table><h4 id="大对象类型">大对象类型</h4><p>用于存储 <strong>大量数据</strong> ，如文件、图片、音频等，通常不可直接用于计算，而是作为二进制或字符流处理：</p><table><thead><tr><th style="text-align:center">类型</th><th style="text-align:center">含义</th><th style="text-align:center">用于</th></tr></thead><tbody><tr><td style="text-align:center"><code>BLOB</code></td><td style="text-align:center">Binary Large Object（字节流）</td><td style="text-align:center">二进制数据，如图片、音频</td></tr><tr><td style="text-align:center"><code>CLOB</code></td><td style="text-align:center">Character Large Object（字符流）</td><td style="text-align:center">文本数据，如文档、大段文字</td></tr></tbody></table><h4 id="用户定义类型">用户定义类型</h4><p>在某些 SQL 标准支持的数据库中，可以自定义类型以提高代码的<strong>可读性</strong>和<strong>数据安全性</strong>：</p><blockquote><figure class="highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">CREATE</span> TYPE Dollars <span class="hljs-keyword">AS</span> <span class="hljs-type">NUMERIC</span>(<span class="hljs-number">12</span>, <span class="hljs-number">2</span>) <span class="hljs-keyword">FINAL</span>;<br><span class="hljs-keyword">CREATE</span> TYPE Pounds <span class="hljs-keyword">AS</span> <span class="hljs-type">NUMERIC</span>(<span class="hljs-number">12</span>, <span class="hljs-number">2</span>) <span class="hljs-keyword">FINAL</span>;<br><br><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> account (<br>  account_number <span class="hljs-type">CHAR</span>(<span class="hljs-number">10</span>),<br>  branch_name <span class="hljs-type">CHAR</span>(<span class="hljs-number">15</span>),<br>  balance Dollars<br>);<br></code></pre></td></tr></tbody></table></figure><p><strong>理解</strong>：</p><ul><li><code>Dollars</code> 和 <code>Pounds</code> 都是以 <code>NUMERIC(12,2)</code> 为基础定义的别名类型。</li><li><code>FINAL</code> 表示该类型不可被继承或扩展。</li><li>在表定义中使用 <code>Dollars</code>，更清楚地表示这个字段是“以美元计的金额”，提高了<strong>语义清晰度</strong>，便于维护。</li></ul></blockquote><h4 id="类型转换">类型转换</h4><p>SQL 提供 <code>CAST()</code> 函数用于显式地将一个值转换为另一种数据类型：</p><figure class="highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-built_in">CAST</span>(expression <span class="hljs-keyword">AS</span> target_type)<br></code></pre></td></tr></tbody></table></figure><h4 id="自定义域">自定义域</h4><p>可以用 <code>CREATE DOMAIN</code> 语句定义一个自定义的“逻辑类型”，也就是域。</p><blockquote><figure class="highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">CREATE</span> DOMAIN DDollars <span class="hljs-keyword">AS</span> <span class="hljs-type">NUMERIC</span>(<span class="hljs-number">12</span>,<span class="hljs-number">2</span>)<br><span class="hljs-keyword">CHECK</span> (<span class="hljs-keyword">VALUE</span> <span class="hljs-operator">&gt;=</span> <span class="hljs-number">0</span>)<br><span class="hljs-keyword">DEFAULT</span> <span class="hljs-number">0.00</span><br></code></pre></td></tr></tbody></table></figure><p>可以像这样定义约束、默认值以及它的底层逻辑。</p></blockquote><hr><p>自定义域的优点在于：</p><ul><li><strong>统一规范</strong>：以后多个表用 <code>DDollars</code> 类型就自动带有精度、默认值、范围限制；</li><li><strong>增加语义性</strong>：代码更清晰，知道该字段代表“货币”；</li><li><strong>集中修改</strong>：若想变更规则，只需改一次 domain 定义。</li></ul><h4 id="SQL-类型系统">SQL 类型系统</h4><p>SQL 的类型系统是弱类型的，也就是说：</p><ul><li>SQL 会<strong>自动进行隐式转换</strong>，如字符串 <code>'123'</code> 自动转为整数；</li><li>类型冲突不一定导致编译错误（如比较 <code>VARCHAR</code> 与 <code>INT</code> 可能可行）；</li><li>某些数据库（如 MySQL）甚至允许插入错误类型的数据（比如把字母插进数值字段）。</li></ul><p>所以重要字段应使用 <code>CAST()</code> 或 <code>DOMAIN</code> 等方法明确其类型。</p><h3 id="完整性约束">完整性约束</h3><h4 id="单个关系上的约束">单个关系上的约束</h4><p>这些约束作用于<strong>单个</strong>关系（表）内部，确保表中的数据满足基本逻辑。又叫本地约束。主要有：</p><ul><li><p><code>NOT NULL</code> 表示该字段<strong>不能为 NULL</strong>（即不能为空）。</p></li><li><p><code>UNIQUE</code> 表示字段（或字段组合）的值<strong>必须唯一</strong>（允许 <code>NULL</code> 值）。通常用于定义<strong>候选键</strong>。</p></li><li><p><code>CHECK</code> 用于指定某个<strong>逻辑条件</strong>必须成立。可以用于：</p><ul><li><p>字段级（作用于某一列）</p></li><li><p>表级（作用于整个元组）</p></li></ul></li></ul><div class="note note-danger"><p><code>CHECK</code> 关键字<strong>不支持使用</strong> <code>SELECT</code> 子查询作为判断条件。</p></div><h4 id="参照完整性约束">参照完整性约束</h4><p><code>FOREIGN KEY</code>（外键约束）用于<strong>跨表约束</strong>，确保一个表中的某字段引用另一个表中已有的数据。</p><figure class="highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">FOREIGN</span> KEY (branch_name) <span class="hljs-keyword">REFERENCES</span> branch(branch_name)<br><br><span class="hljs-comment">-- account.branch_name 的值必须在 branch.branch_name 中存在</span><br><span class="hljs-comment">-- 防止“孤立数据”或“失联引用”</span><br></code></pre></td></tr></tbody></table></figure><hr><p><strong>级联操作</strong>用于自动传播更新或删除操作：</p><figure class="highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">FOREIGN</span> KEY (branch_name) <span class="hljs-keyword">REFERENCES</span> branch(branch_name)<br><span class="hljs-keyword">ON</span> <span class="hljs-keyword">DELETE</span> CASCADE<br><span class="hljs-keyword">ON</span> <span class="hljs-keyword">UPDATE</span> CASCADE<br></code></pre></td></tr></tbody></table></figure><p>含义：</p><ul><li><code>ON DELETE CASCADE</code>：如果分支被删除，该分支的内容也会被自动删除；</li><li><code>ON UPDATE CASCADE</code>：如果分支名被修改，引用它的表中的名字也会自动跟着改。</li></ul><h4 id="断言">断言</h4><p>断言用于定义<strong>跨多个关系或整库级别</strong>的数据一致性约束。</p><figure class="highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">CREATE</span> ASSERTION 断言名<br><span class="hljs-keyword">CHECK</span> (谓词表达式)<br></code></pre></td></tr></tbody></table></figure><blockquote><p>[例] 每个分行的贷款总额不能大于它的存款总额：</p><figure class="highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">CREATE</span> ASSERTION sum_constraint<br><span class="hljs-keyword">CHECK</span> (<br>  <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">EXISTS</span> (<br>    <span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span><br>    <span class="hljs-keyword">FROM</span> branch<br>    <span class="hljs-keyword">WHERE</span> (<br>      <span class="hljs-keyword">SELECT</span> <span class="hljs-built_in">SUM</span>(amount)<br>      <span class="hljs-keyword">FROM</span> loan<br>      <span class="hljs-keyword">WHERE</span> loan.branch_name <span class="hljs-operator">=</span> branch.branch_name<br>    ) <span class="hljs-operator">&gt;=</span> (<br>      <span class="hljs-keyword">SELECT</span> <span class="hljs-built_in">SUM</span>(balance)<br>      <span class="hljs-keyword">FROM</span> account<br>      <span class="hljs-keyword">WHERE</span> account.branch_name <span class="hljs-operator">=</span> branch.branch_name<br>    )<br>  )<br>)<br></code></pre></td></tr></tbody></table></figure><p>这是一个跨表比较（<code>loan</code> 与 <code>account</code>），<code>CHECK</code> 无法实现，只能用断言。</p></blockquote><div class="note note-primary"><p>在实际数据库中（如 MySQL、PostgreSQL、SQL Server），<strong>很多并不支持断言</strong>，就算支持也是阉割版的。</p></div><h3 id="在宿主语言中执行-SQL">在宿主语言中执行 SQL</h3><p>指的是将 SQL 语句<strong>直接写入宿主语言</strong>中，如 C、C++、Java 等，并通过专门机制与数据库交互。</p><ul><li><strong>宿主语言</strong>指的是用来编程的主语言。</li></ul><pre><code class="mermaid">graph TD
  A[在宿主语言中执行SQL] --&gt; B[语句级接口]
  A --&gt; C[调用级接口]

  B --&gt; D[嵌入式 SQL]
  B --&gt; E[动态 SQL]


  D --&gt; H[使用预编译器]
  E --&gt; H
  C --&gt; I[字符串传参]

</code></pre><hr><p><strong>语句级接口</strong> 通过 <strong>嵌入式 SQL</strong> 或 <strong>动态 SQL</strong> 实现。</p><ul><li>它的特点是 SQL 语句嵌入在宿主语言中，需要用 <strong>预编译器</strong> 处理 SQL。</li><li>常用于 C、COBOL、Pascal 等传统编程语言中。</li></ul><table><thead><tr><th style="text-align:center">概念</th><th style="text-align:center">特点和用途</th></tr></thead><tbody><tr><td style="text-align:center">嵌入式 SQL</td><td style="text-align:center">SQL 写在宿主语言源代码中，编译前通过预处理器提取和转换为函数调用。例如 <code>EXEC SQL SELECT ... END-EXEC</code> （C）或 <code>#SQL{...}</code>（Java SQLJ）。</td></tr><tr><td style="text-align:center">动态 SQL</td><td style="text-align:center">SQL 语句在运行时拼接和执行，仍需预处理器支持，用于无法预知语句结构的情况。</td></tr></tbody></table><blockquote><p>[例] 嵌入式 SQL</p><figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs C">EXEC SQL SELECT balance INTO :bal FROM account WHERE id = :id;<br></code></pre></td></tr></tbody></table></figure><p>需使用 <strong>预编译器</strong>（如 Pro*C）将其转成函数调用代码。</p></blockquote><hr><blockquote><p>[例] 动态 SQL</p><figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs C"><span class="hljs-type">char</span> *query = <span class="hljs-string">"SELECT balance FROM account WHERE id = ?"</span>;<br>EXEC SQL PREPARE stmt FROM :query;<br>EXEC SQL EXECUTE stmt USING :id;<br></code></pre></td></tr></tbody></table></figure><p>同样嵌入式，但 SQL 是运行时构造的，适用于 SQL 不确定的情况。</p></blockquote><hr><p><strong>调用级接口</strong> 不需要预编译器。</p><ul><li>SQL 语句在程序中作为<strong>字符串参数</strong>传递给数据库函数（运行时绑定）。</li><li>使用 <strong>ODBC、JDBC</strong> 等标准接口。</li><li>现代语言如 Java、C++、Python 中常用此方式。</li></ul><blockquote><p>[例] JDBC</p><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">PreparedStatement</span> <span class="hljs-variable">ps</span> <span class="hljs-operator">=</span> conn.prepareStatement(<span class="hljs-string">"SELECT balance FROM account WHERE id = ?"</span>);<br>ps.setInt(<span class="hljs-number">1</span>, id);<br><span class="hljs-type">ResultSet</span> <span class="hljs-variable">rs</span> <span class="hljs-operator">=</span> ps.executeQuery();<br></code></pre></td></tr></tbody></table></figure><p>完全用 Java API 编写，不嵌入 SQL，运行时通过 <strong>JDBC 驱动程序</strong>传给数据库。</p></blockquote><hr><h4 id="C-语言嵌入式-SQL">C 语言嵌入式 SQL</h4><p>可以用嵌入式的方法将 SQL 语句直接嵌入到 C 程序中，通过预编译器（如 Pro*C）将 SQL 翻译为数据库 API 函数调用。</p><p>基本用法是：</p><figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs C">EXEC SQL &lt;SQL语句&gt; END-EXEC;<br><span class="hljs-comment">// 某些实现可能省略 END-EXEC</span><br></code></pre></td></tr></tbody></table></figure><ol><li><strong>连接数据库</strong></li></ol><figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs C">EXEC SQL connect to [server] user [user_name] END-EXEC;<br><span class="hljs-comment">/*</span><br><span class="hljs-comment">* server 是数据库的服务名或连接标识</span><br><span class="hljs-comment">* user_name 是登录用户</span><br><span class="hljs-comment">* 可使用密码（根据数据库实现）</span><br><span class="hljs-comment">*/</span><br></code></pre></td></tr></tbody></table></figure><ol start="2"><li><strong>声明游标</strong></li></ol><figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs C">EXEC SQL<br>declare c cursor <span class="hljs-keyword">for</span><br><span class="hljs-comment">// cursor （游标）是用于处理多行查询结果的机制</span><br>select customer_name, customer_city<br>from depositor, customer, account<br>where depositor.customer_name = customer.customer_name<br>  and account.account_number = depositor.account_number<br>  and account.balance &gt; :amount<br>END-EXEC;<br><span class="hljs-comment">// 变量 :amount 是 C 中的变量（冒号表示绑定变量）</span><br></code></pre></td></tr></tbody></table></figure><ol start="3"><li><strong>打开游标</strong></li></ol><figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs c">EXEC SQL open c END-EXEC;<br><span class="hljs-comment">// 启动游标，执行 SQL 查询，准备开始遍历结果</span><br></code></pre></td></tr></tbody></table></figure><ol start="4"><li><strong>提取数据</strong></li></ol><figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs c">EXEC SQL fetch c into :cn, :cc END-EXEC;<br><br><span class="hljs-comment">// 从游标中提取一行数据并存入 C 变量中</span><br><span class="hljs-comment">// :cn 和 :cc 分别对应 SQL 查询的两个字段</span><br></code></pre></td></tr></tbody></table></figure><ol start="5"><li><strong>关闭游标</strong></li></ol><figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs c">EXEC SQL close c END-EXEC;<br></code></pre></td></tr></tbody></table></figure><hr><blockquote><p>[例] 连接数据库，查询余额大于指定金额的账户持有人姓名和城市信息：</p><figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">/* 文件名: query_customers.pc */</span><br><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;string.h&gt;</span></span><br><br><span class="hljs-comment">/* 嵌入式 SQL 使用变量需声明 */</span><br>EXEC SQL BEGIN DECLARE SECTION;<br>    <span class="hljs-type">char</span> username[<span class="hljs-number">20</span>] = <span class="hljs-string">"scott"</span>;<br>    <span class="hljs-type">char</span> password[<span class="hljs-number">20</span>] = <span class="hljs-string">"tiger"</span>;<br>    <span class="hljs-type">float</span> amount = <span class="hljs-number">1000.00</span>;<br>    <span class="hljs-type">char</span> customer_name[<span class="hljs-number">50</span>];<br>    <span class="hljs-type">char</span> customer_city[<span class="hljs-number">50</span>];<br>EXEC SQL END DECLARE SECTION;<br><br>EXEC SQL INCLUDE sqlca;<br><br><span class="hljs-type">int</span> <span class="hljs-title function_">main</span><span class="hljs-params">()</span> {<br>    <span class="hljs-comment">/* 连接数据库 */</span><br>    EXEC SQL CONNECT :username IDENTIFIED BY :password;<br>    <span class="hljs-keyword">if</span> (sqlca.sqlcode != <span class="hljs-number">0</span>) {<br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">"连接失败: %ld\n"</span>, sqlca.sqlcode);<br>        <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;<br>    }<br><br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">"连接成功。\n"</span>);<br><br>    <span class="hljs-comment">/* 声明游标 */</span><br>    EXEC SQL DECLARE c CURSOR FOR<br>        SELECT customer_name, customer_city<br>        FROM depositor, customer, account<br>        WHERE depositor.customer_name = customer.customer_name<br>          AND depositor.account_number = account.account_number<br>          AND account.balance &gt; :amount;<br><br>    <span class="hljs-comment">/* 打开游标 */</span><br>    EXEC SQL OPEN c;<br><br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">"查询余额大于 %.2f 的客户:\n"</span>, amount);<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">"-------------------------------------\n"</span>);<br><br>    <span class="hljs-comment">/* 提取数据 */</span><br>    <span class="hljs-keyword">while</span> (<span class="hljs-number">1</span>) {<br>        EXEC SQL FETCH c INTO :customer_name, :customer_city;<br>        <span class="hljs-keyword">if</span> (sqlca.sqlcode != <span class="hljs-number">0</span>) <span class="hljs-keyword">break</span>;<br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">"姓名: %s, 城市: %s\n"</span>, customer_name, customer_city);<br>    }<br><br>    <span class="hljs-comment">/* 关闭游标 */</span><br>    EXEC SQL CLOSE c;<br><br>    <span class="hljs-comment">/* 断开连接 */</span><br>    EXEC SQL COMMIT WORK RELEASE;<br><br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">"操作完成，退出程序。\n"</span>);<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>}<br></code></pre></td></tr></tbody></table></figure><p>编译方式（Oracle Pro*C）：</p><ul><li>需要先使用 proc 编译器将 <code>.pc</code> 文件预编译为 <code>.c</code>：</li></ul><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">proc query_customers.pc<br></code></pre></td></tr></tbody></table></figure><ul><li>然后再用 C 编译器编译生成的 <code>.c</code> 文件：</li></ul><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">gcc query_customers.c -o query_customers -L<span class="hljs-variable">$ORACLE_HOME</span>/lib -lclntsh<br></code></pre></td></tr></tbody></table></figure></blockquote><h3 id="函数和过程化结构">函数和过程化结构</h3><p>SQL 不只是查询语言，它也支持<strong>模块化编程</strong>，主要包括：</p><ul><li><strong>函数</strong>：有返回值，适合用于查询中直接调用。</li><li><strong>过程</strong>：无返回值，但可通过参数传入/传出信息，适合复杂的数据操作流程。</li></ul><h3 id="函数">函数</h3><p>函数的主要特点有：</p><ul><li><p><strong>有返回值</strong></p></li><li><p>一般用于<strong>查询操作</strong>，可以在 <code>SELECT</code> 语句等地方直接调用</p></li><li><p>不能对数据库进行“修改”操作（如 <code>INSERT</code>, <code>UPDATE</code>）</p></li></ul><blockquote><p>[例] 给定顾客名字，返回其拥有的存款账户数目：</p><figure class="highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">create</span> <span class="hljs-keyword">function</span> account_count (customer_name <span class="hljs-type">varchar</span>(<span class="hljs-number">20</span>))<br><span class="hljs-keyword">returns</span> <span class="hljs-type">integer</span><br><span class="hljs-keyword">begin</span><br>    <span class="hljs-keyword">declare</span> acount <span class="hljs-type">integer</span>;<br>    <span class="hljs-keyword">select</span> <span class="hljs-built_in">count</span>(<span class="hljs-operator">*</span>) <span class="hljs-keyword">into</span> acount<br>    <span class="hljs-keyword">from</span> depositor<br>    <span class="hljs-keyword">where</span> depositor.account_name <span class="hljs-operator">=</span> customer_name;<br>    <span class="hljs-keyword">return</span> acount;<br><span class="hljs-keyword">end</span>;<br></code></pre></td></tr></tbody></table></figure><p>调用函数：</p><figure class="highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">select</span> customer_name, customer_street, customer_city<br><span class="hljs-keyword">from</span> customer<br><span class="hljs-keyword">where</span> account_count(customer_name) <span class="hljs-operator">&gt;</span> <span class="hljs-number">1</span>;<br></code></pre></td></tr></tbody></table></figure></blockquote><h3 id="过程">过程</h3><p>过程的主要特点有：</p><ul><li><strong>无返回值</strong></li><li><strong>可以通过参数</strong>来“传入”和“传出”信息</li><li><strong>可以修改数据库内容</strong>，也可以做查询</li><li>适合封装复杂逻辑和批处理操作</li></ul><blockquote><p>[例] 给定顾客名字，返回其拥有的存款账户数目：</p><figure class="highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">create</span> <span class="hljs-keyword">procedure</span> accounts_count_proc (<br>    <span class="hljs-keyword">in</span> customer_name <span class="hljs-type">varchar</span>(<span class="hljs-number">20</span>),<br>    <span class="hljs-keyword">out</span> a_count <span class="hljs-type">integer</span><br>    <span class="hljs-comment">-- 通过 in 和 out 分别传入和传出参数</span><br>)<br><span class="hljs-keyword">begin</span><br>    <span class="hljs-keyword">select</span> <span class="hljs-built_in">count</span>(<span class="hljs-operator">*</span>) <span class="hljs-keyword">into</span> a_count<br>    <span class="hljs-keyword">from</span> depositor<br>    <span class="hljs-keyword">where</span> depositor.account_name <span class="hljs-operator">=</span> customer_name;<br><span class="hljs-keyword">end</span>;<br></code></pre></td></tr></tbody></table></figure><p>调用方式：</p><figure class="highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">declare</span> a_count <span class="hljs-type">integer</span>;<br><span class="hljs-keyword">call</span> accounts_count_proc(<span class="hljs-string">'Smith'</span>, a_count);<br></code></pre></td></tr></tbody></table></figure></blockquote><hr><table><thead><tr><th style="text-align:center">特性</th><th style="text-align:center">函数</th><th style="text-align:center">过程</th></tr></thead><tbody><tr><td style="text-align:center">是否有返回值</td><td style="text-align:center">是</td><td style="text-align:center">否，通过参数传出</td></tr><tr><td style="text-align:center">用途</td><td style="text-align:center">查询为主</td><td style="text-align:center">操作/控制逻辑/批处理</td></tr><tr><td style="text-align:center">是否能改动数据</td><td style="text-align:center">❌</td><td style="text-align:center">✅</td></tr><tr><td style="text-align:center">是否能嵌入 SQL 中</td><td style="text-align:center">是，可在 SELECT 中调用</td><td style="text-align:center">否，需独立调用</td></tr></tbody></table><h3 id="过程化结构">过程化结构</h3><p>SQL 引入了类似编程语言的控制流程结构，即过程化结构，如：</p><ul><li>循环</li><li>分支</li><li>复合语句</li></ul><p>这些结构使得 SQL 不只是查询语言，还可以实现复杂的逻辑控制。</p><hr><p>它的特性有：</p><ul><li><strong>支持控制结构</strong>：如 <code>if-then-else</code>、<code>while</code>、<code>repeat</code> 等</li><li><strong>可组合语句块</strong>：使用 <code>begin...end</code> 包含多条语句</li><li><strong>可用于存储过程、触发器等</strong>模块中</li><li><strong>支持变量声明与赋值</strong></li><li>属于<strong>持久存储模块</strong>：代码可以保存在数据库中并长期使用</li></ul><h4 id="循环语句">循环语句</h4><ul><li><code>while</code> 循环</li></ul><figure class="highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">declare</span> n <span class="hljs-type">integer</span> <span class="hljs-keyword">default</span> <span class="hljs-number">0</span>;<br>while n <span class="hljs-operator">&lt;</span> <span class="hljs-number">10</span> do<br>    <span class="hljs-keyword">set</span> n <span class="hljs-operator">=</span> n <span class="hljs-operator">+</span> <span class="hljs-number">1</span>;<br><span class="hljs-keyword">end</span> while;<br><span class="hljs-comment">-- 当满足条件时重复执行</span><br></code></pre></td></tr></tbody></table></figure><hr><ul><li><code>repeat</code> 循环</li></ul><figure class="highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">declare</span> n <span class="hljs-type">integer</span> <span class="hljs-keyword">default</span> <span class="hljs-number">10</span>;<br>repeat<br>    <span class="hljs-keyword">set</span> n <span class="hljs-operator">=</span> n <span class="hljs-operator">-</span> <span class="hljs-number">1</span>;<br>until n <span class="hljs-operator">=</span> <span class="hljs-number">0</span><br><span class="hljs-keyword">end</span> repeat;<br><span class="hljs-comment">-- 先执行，后判断，直到满足条件为止</span><br></code></pre></td></tr></tbody></table></figure><hr><ul><li><code>for</code> 循环</li></ul><figure class="highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">declare</span> n <span class="hljs-type">integer</span> <span class="hljs-keyword">default</span> <span class="hljs-number">0</span>;<br><span class="hljs-keyword">for</span> r <span class="hljs-keyword">as</span> <span class="hljs-keyword">select</span> balance <span class="hljs-keyword">from</span> account<br><span class="hljs-keyword">where</span> branch name <span class="hljs-operator">=</span> <span class="hljs-string">'Perryridge'</span><br>do<br>	<span class="hljs-keyword">set</span> n <span class="hljs-operator">=</span> n <span class="hljs-operator">+</span> r.balance;<br><span class="hljs-keyword">end</span> <span class="hljs-keyword">for</span><br></code></pre></td></tr></tbody></table></figure><h4 id="分支语句">分支语句</h4><figure class="highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs sql">if r.balance <span class="hljs-operator">&lt;</span> <span class="hljs-number">1000</span> <span class="hljs-keyword">then</span><br>    <span class="hljs-keyword">set</span> l <span class="hljs-operator">=</span> l <span class="hljs-operator">+</span> r.balance;<br>elseif r.balance <span class="hljs-operator">&lt;</span> <span class="hljs-number">5000</span> <span class="hljs-keyword">then</span><br>    <span class="hljs-keyword">set</span> m <span class="hljs-operator">=</span> m <span class="hljs-operator">+</span> r.balance;<br><span class="hljs-keyword">else</span><br>    <span class="hljs-keyword">set</span> h <span class="hljs-operator">=</span> h <span class="hljs-operator">+</span> r.balance;<br><span class="hljs-keyword">end</span> if;<br></code></pre></td></tr></tbody></table></figure><h4 id="复合语句">复合语句</h4><p>SQL 很多地方要求只能写一条语句，但是一般的逻辑往往是要写很多句语句的，此时就可以用 <code>BEGIN...END</code> 来组合它们，把它变成一条语句。</p><p>相当于大括号 <code>{}</code> 的用法。</p><figure class="highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">begin</span><br>    <span class="hljs-comment">-- 声明变量、赋值、条件判断、循环等都可以写在这里</span><br><span class="hljs-keyword">end</span>;<br></code></pre></td></tr></tbody></table></figure><hr><div class="fold"><div class="fold-title fold-info collapsed" data-toggle="collapse" href="#collapse-3b8a3ab9" role="button" aria-expanded="false" aria-controls="collapse-3b8a3ab9"><div class="fold-arrow">▶</div>循环不变式</div><div class="fold-collapse collapse" id="collapse-3b8a3ab9"><div class="fold-content"><p>循环不变<sup id="fnref:5" class="footnote-ref"><a href="#fn:5" rel="footnote"><span class="hint--top hint--rounded" aria-label="所谓“不变”其实不是说变量值不变，而是**某种逻辑关系一直不变**。比如求和时， $\text{Sum}=\sum x_i$ 这个关系是不变的。">[5]</span></a></sup>式是指：<strong>在循环执行过程中始终为真的条件</strong>，形式写作：</p><figure class="highlight text"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs text">{I} while (B) S {I ∧ ¬B}<br></code></pre></td></tr></tbody></table></figure><p>其中：</p><ul><li><code>{I}</code>：<strong>循环开始前</strong>就成立的条件（不变式）</li><li><code>B</code>：<strong>循环继续的条件</strong></li><li><code>S</code>：<strong>循环体</strong></li><li><code>{I ∧ ¬B}</code>：<strong>循环结束时</strong>，不变式依然成立，并且 <code>B</code> 不再成立</li></ul></div></div></div><h4 id="外部语言例程">外部语言例程</h4><p>外部语言例程是数据库的一个扩展机制，它允许使用 <strong>数据库原生 SQL 之外的编程语言</strong>（如 C、C++、Java、C# 等）来定义函数或过程，并将其集成到数据库中调用。</p><p>以 C/C++ 为例，使用外部语言例程的理由如下：</p><table><thead><tr><th style="text-align:center">原因</th><th style="text-align:center">说明</th></tr></thead><tbody><tr><td style="text-align:center">性能</td><td style="text-align:center">SQL 不适合复杂的计算，C/C++ 更高效</td></tr><tr><td style="text-align:center">功能扩展</td><td style="text-align:center">SQL 不支持某些特定操作，如图像处理、操作系统调用等</td></tr><tr><td style="text-align:center">语言生态</td><td style="text-align:center">使用已有的库，比如图像识别、加密、压缩等库</td></tr><tr><td style="text-align:center">与外部系统集成</td><td style="text-align:center">C/C++ 可访问文件系统、设备、硬件接口等</td></tr></tbody></table><p>SQL 可以使用外部过程和外部函数：</p><ul><li><strong>外部过程</strong></li></ul><blockquote><p>[例]</p><figure class="highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">PROCEDURE</span> account_count_proc (<br>    <span class="hljs-keyword">IN</span> customer_name <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">20</span>),<br>    <span class="hljs-keyword">OUT</span> account <span class="hljs-type">INTEGER</span><br>)<br><span class="hljs-keyword">LANGUAGE</span> C<br><span class="hljs-keyword">EXTERNAL</span> NAME <span class="hljs-string">'/usr/user1/bin/account_count_proc'</span>;<br><span class="hljs-comment">-- 表示这个过程是用 C 语言 编写的</span><br><span class="hljs-comment">-- 在路径 /usr/user1/bin/account_count_proc 中找对应的函数</span><br><br><span class="hljs-comment">-- 调用时就像普通 SQL 过程一样使用 CALL account_count_proc(...)</span><br></code></pre></td></tr></tbody></table></figure></blockquote><ul><li><strong>外部函数</strong></li></ul><blockquote><p>[例]</p><figure class="highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">FUNCTION</span> account_count (<br>    customer_name <span class="hljs-type">VARCHAR</span>(<span class="hljs-number">20</span>)<br>)<br><span class="hljs-keyword">RETURNS</span> <span class="hljs-type">INTEGER</span><br><span class="hljs-keyword">LANGUAGE</span> C<br><span class="hljs-keyword">EXTERNAL</span> NAME <span class="hljs-string">'/usr/user1/bin/account_count'</span>;<br></code></pre></td></tr></tbody></table></figure></blockquote><div class="note note-warning"><p><strong>需要注意以下几点</strong>：</p><table><thead><tr><th style="text-align:center"></th><th style="text-align:center">说明</th></tr></thead><tbody><tr><td style="text-align:center">外部代码必须预编译</td><td style="text-align:center">通常编译为 <code>.so</code>、<code>.dll</code> 等共享库文件</td></tr><tr><td style="text-align:center">安全问题</td><td style="text-align:center">可能造成系统调用、数据泄露等问题，数据库会做权限限制</td></tr><tr><td style="text-align:center">注册机制</td><td style="text-align:center">需数据库支持，如 PostgreSQL 用 <code>CREATE FUNCTION ... LANGUAGE C</code></td></tr><tr><td style="text-align:center">数据类型转换</td><td style="text-align:center">SQL 类型 ↔ 外部语言类型 之间要做匹配和转换</td></tr></tbody></table></div><h3 id="递归查询">递归查询</h3><p>递归查询是一种 <strong>查询结构层次化或多层依赖数据</strong> 的方式。</p><p>任何递归查询都由两部分组成（使用 <code>UNION</code> 合并）：</p><ol><li><strong>基查询</strong>：<ul><li>先找出“最底层”的直接关系</li><li>不包含递归引用，例如：<code>select employee_name, manager_name from manager</code></li></ul></li><li><strong>递归查询</strong>：<ul><li>在前一次结果的基础上，继续往上查</li><li>自己调用自己（通过递归视图）</li></ul></li></ol><blockquote><p>[例] 查询员工的所有上级：</p><table><thead><tr><th style="text-align:center">employee_name</th><th style="text-align:center">manager_name</th></tr></thead><tbody><tr><td style="text-align:center">Alon</td><td style="text-align:center">Barinsky</td></tr><tr><td style="text-align:center">Barinsky</td><td style="text-align:center">Estovar</td></tr><tr><td style="text-align:center">Estovar</td><td style="text-align:center">Jones</td></tr><tr><td style="text-align:center">Duarte</td><td style="text-align:center">Jones</td></tr><tr><td style="text-align:center">Jones</td><td style="text-align:center">Klinger</td></tr></tbody></table><figure class="highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">WITH</span> <span class="hljs-keyword">RECURSIVE</span> empl(employee_name, manager_name) <span class="hljs-keyword">AS</span> (<br>    <span class="hljs-comment">-- 基查询：直接管理关系</span><br>    <span class="hljs-keyword">SELECT</span> employee_name, manager_name <span class="hljs-keyword">FROM</span> manager<br><br>    <span class="hljs-keyword">UNION</span><br><br>    <span class="hljs-comment">-- 递归查询：间接管理关系</span><br>    <span class="hljs-keyword">SELECT</span> m.employee_name, e.manager_name<br>    <span class="hljs-keyword">FROM</span> manager m, empl e<br>    <span class="hljs-keyword">WHERE</span> m.manager_name <span class="hljs-operator">=</span> e.employee_name<br>)<br><br><span class="hljs-keyword">SELECT</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">FROM</span> empl;<br></code></pre></td></tr></tbody></table></figure></blockquote><hr><p>为了避免死循环或逻辑混乱，递归查询有以下<strong>限制</strong>：</p><table><thead><tr><th style="text-align:center">限制项</th><th style="text-align:center">原因</th></tr></thead><tbody><tr><td style="text-align:center">必须是<strong>单调的</strong></td><td style="text-align:center">结果只能“增加”不能“反转”或“删除”</td></tr><tr><td style="text-align:center">不允许使用 <code>GROUP BY</code>、<code>SUM()</code>、<code>COUNT()</code> 等聚合函数</td><td style="text-align:center">聚合与递归逻辑冲突</td></tr><tr><td style="text-align:center">不能在子查询中对递归视图用 <code>NOT EXISTS</code></td><td style="text-align:center">非单调逻辑</td></tr><tr><td style="text-align:center">不允许在递归视图右边使用集合差集 <code>EXCEPT</code></td><td style="text-align:center">结果会“减少”，违反单调性</td></tr></tbody></table><h2 id="参考和注解">参考和注解</h2><section class="footnotes"><div class="footnote-list"><ol><li><span id="fn:1" class="footnote-text"><span>分组就是“<strong>按字段值划分子集</strong>”。不过它既可以按照单字段分组，也可以按多字段（例如对于一个存在“地区”、“产品”和“价格”的表，如果按照“地区”和“产品”分组统计“价格”的平均值，那么就会分别按照【东部、铅笔】，【东部、钢笔】，【西部、铅笔】这样分别进行统计）。也可以通过表达式（例如提取日期字段中的年份）和区间进行分组。 <code>NULL</code> 会被单独分成一组。分好组了以后，聚集函数就会在组内进行运算。 <a href="#fnref:1" rev="footnote" class="footnote-backref">↩</a></span></span></li><li><span id="fn:2" class="footnote-text"><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="script">G</mi></mrow><annotation encoding="application/x-tex">\mathcal{G}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.7805em;vertical-align:-.0972em"></span><span class="mord mathcal" style="margin-right:.0593em">G</span></span></span></span> 符号就是花体的 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>G</mtext></mrow><annotation encoding="application/x-tex">\text G</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.6833em"></span><span class="mord text"><span class="mord">G</span></span></span></span></span> ，<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>LaTeX</mtext></mrow><annotation encoding="application/x-tex">\LaTeX</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.8988em;vertical-align:-.2155em"></span><span class="mord text"><span class="mord textrm">L</span><span class="mspace" style="margin-right:-.36em"></span><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:.6833em"><span style="top:-2.905em"><span class="pstrut" style="height:2.7em"></span><span class="mord"><span class="mord textrm mtight sizing reset-size6 size3">A</span></span></span></span></span></span><span class="mspace" style="margin-right:-.15em"></span><span class="mord text"><span class="mord textrm">T</span><span class="mspace" style="margin-right:-.1667em"></span><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.4678em"><span style="top:-2.7845em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mord textrm">E</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.2155em"><span></span></span></span></span><span class="mspace" style="margin-right:-.125em"></span><span class="mord textrm">X</span></span></span></span></span></span> 代码 <code>\mathcal{G}</code> 。 <a href="#fnref:2" rev="footnote" class="footnote-backref">↩</a></span></span></li><li><span id="fn:3" class="footnote-text"><span><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>LaTeX</mtext></mrow><annotation encoding="application/x-tex">\LaTeX</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.8988em;vertical-align:-.2155em"></span><span class="mord text"><span class="mord textrm">L</span><span class="mspace" style="margin-right:-.36em"></span><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:.6833em"><span style="top:-2.905em"><span class="pstrut" style="height:2.7em"></span><span class="mord"><span class="mord textrm mtight sizing reset-size6 size3">A</span></span></span></span></span></span><span class="mspace" style="margin-right:-.15em"></span><span class="mord text"><span class="mord textrm">T</span><span class="mspace" style="margin-right:-.1667em"></span><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.4678em"><span style="top:-2.7845em"><span class="pstrut" style="height:3em"></span><span class="mord"><span class="mord textrm">E</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.2155em"><span></span></span></span></span><span class="mspace" style="margin-right:-.125em"></span><span class="mord textrm">X</span></span></span></span></span></span> 不支持这三个符号，解决方案可以参考：<a target="_blank" rel="noopener" href="https://tex.stackexchange.com/questions/20740/symbols-for-outer-joins">https://tex.stackexchange.com/questions/20740/symbols-for-outer-joins</a> 或 <a target="_blank" rel="noopener" href="https://lancelotshire.me/notebook/latex.html">https://lancelotshire.me/notebook/latex.html</a> 。 <a href="#fnref:3" rev="footnote" class="footnote-backref">↩</a></span></span></li><li><span id="fn:4" class="footnote-text"><span>三值逻辑是一种非古典逻辑系统，它允许命题有三个可能的真值：真（True）、假（False）和未确定（Unknown）。 <a href="#fnref:4" rev="footnote" class="footnote-backref">↩</a></span></span></li><li><span id="fn:5" class="footnote-text"><span>所谓“不变”其实不是说变量值不变，而是<strong>某种逻辑关系一直不变</strong>。比如求和时， <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext>Sum</mtext><mo>=</mo><mo>∑</mo><msub><mi>x</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">\text{Sum}=\sum x_i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.6833em"></span><span class="mord text"><span class="mord">Sum</span></span><span class="mspace" style="margin-right:.2778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right:.2778em"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-.25em"></span><span class="mop op-symbol small-op" style="position:relative;top:0">∑</span><span class="mspace" style="margin-right:.1667em"></span><span class="mord"><span class="mord mathnormal">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.3117em"><span style="top:-2.55em;margin-left:0;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.15em"><span></span></span></span></span></span></span></span></span></span> 这个关系是不变的。 <a href="#fnref:5" rev="footnote" class="footnote-backref">↩</a></span></span></li></ol></div></section></div><hr><div><div class="post-metas my-3"><div class="post-meta mr-3 d-flex align-items-center"><i class="iconfont icon-category"></i> <span class="category-chains"><span class="category-chain"><a href="/categories/%E8%AF%BE%E7%A8%8B%E7%AC%94%E8%AE%B0/" class="category-chain-item">课程笔记</a></span></span></div><div class="post-meta"><i class="iconfont icon-tags"></i> <a href="/tags/%E6%95%B0%E6%8D%AE%E5%BA%93/" class="print-no-link">#数据库</a></div></div><div class="license-box my-3"><div class="license-title"><div>数据库原理 课程笔记 (1)</div><div>https://blog.kisechan.space/2025/notes-database-1/</div></div><div class="license-meta"><div class="license-meta-item"><div>作者</div><div>Kisechan</div></div><div class="license-meta-item license-meta-date"><div>发布于</div><div>2025年3月19日</div></div><div class="license-meta-item license-meta-date"><div>更新于</div><div>2025年5月7日</div></div><div class="license-meta-item"><div>许可协议</div><div><a class="print-no-link" target="_blank" href="https://creativecommons.org/licenses/by-nc-sa/4.0/"><span class="hint--top hint--rounded" aria-label="BY - 署名"><i class="iconfont icon-by"></i> </span></a><a class="print-no-link" target="_blank" href="https://creativecommons.org/licenses/by-nc-sa/4.0/"><span class="hint--top hint--rounded" aria-label="NC - 非商业性使用"><i class="iconfont icon-nc"></i> </span></a><a class="print-no-link" target="_blank" href="https://creativecommons.org/licenses/by-nc-sa/4.0/"><span class="hint--top hint--rounded" aria-label="SA - 相同方式共享"><i class="iconfont icon-sa"></i></span></a></div></div></div><div class="license-icon iconfont"></div></div><div class="post-prevnext my-3"><article class="post-prev col-6"><a href="/2025/site-new-icon-css/" title="网站替换新的图标 CSS"><i class="iconfont icon-arrowleft"></i> <span class="hidden-mobile">网站替换新的图标 CSS</span> <span class="visible-mobile">上一篇</span></a></article><article class="post-next col-6"><a href="/2025/notes-algorithm-analysis/" title="算法设计与分析 课程笔记"><span class="hidden-mobile">算法设计与分析 课程笔记</span> <span class="visible-mobile">下一篇</span> <i class="iconfont icon-arrowright"></i></a></article></div></div><article id="comments" lazyload><div id="gitalk-container"></div><script type="text/javascript">Fluid.utils.loadComments("#gitalk-container",function(){Fluid.utils.createCssLink("/css/gitalk.css"),Fluid.utils.createScript("https://lib.baomitu.com/gitalk/1.8.0/gitalk.min.js",function(){var e=Object.assign({clientID:"Ov23liWYIiu2jxReIEhB",clientSecret:"d7b44817ae2553b2175fdecfde9718b582bdc653",repo:"Comment-Kisechan",owner:"Kisechan",admin:["Kisechan"],language:"zh-CN",labels:["Gitalk"],perPage:10,pagerDirection:"last",distractionFreeMode:!1,createIssueManually:!0,proxy:"https://cors-anywhere.azm.workers.dev/https://github.com/login/oauth/access_token",enabled:!0},{id:"928ea269a50fa72e10cef3705102e8c3"});new Gitalk(e).render("gitalk-container")})})</script><noscript>Please enable JavaScript to view the comments</noscript></article></article></div></div></div><div class="side-col d-none d-lg-block col-lg-2"><aside class="sidebar" style="margin-left:-1rem"><div id="toc"><p class="toc-header"><i class="iconfont icon-list"></i> <span>目录</span></p><div class="toc-body" id="toc-body"></div></div></aside></div></div></div><script>Fluid.utils.createScript("https://lib.baomitu.com/mermaid/8.14.0/mermaid.min.js",function(){mermaid.initialize({theme:"default"}),Fluid.utils.listenDOMLoaded(function(){Fluid.events.registerRefreshCallback(function(){"mermaid"in window&&mermaid.init()})})})</script><div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable modal-lg" role="document"><div class="modal-content"><div class="modal-header text-center"><h4 class="modal-title w-100 font-weight-bold">搜索</h4><button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button></div><div class="modal-body mx-3"><div class="md-form mb-5"><input type="text" id="local-search-input" class="form-control validate"> <label data-error="x" data-success="v" for="local-search-input">关键词</label></div><div class="list-group" id="local-search-result"></div></div></div></div></div></main><footer><div class="footer-inner"><div class="footer-content"><div><span>Frame by </span><a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <span>| Theme </span><a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a></div><div style="font-size:.85rem"><span id="timeStart">本站自 2024 年 4 月 26 日 20 : 46 : 17 起</span> <span><span id="timeDate">载入天数...</span> <span id="times">载入时分秒...</span><script src="/js/duration.js"></script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></span><span><span><br>本站总访问量&nbsp<span id="busuanzi_value_site_pv"></span>&nbsp次</span> <span>总访客数&nbsp<span id="busuanzi_value_site_uv"></span>&nbsp人 &nbsp<br></span></span><span>&copy; 2024 - 2025 By <a href="https://github.com/Kisechan" target="_blank" rel="nofollow noopener"><strong>Kisechan</strong></a><br></span><span>今天也很喜欢你！</span><br><a href="https://icp.gov.moe/?keyword=20251453" target="_blank">萌ICP备20251453号</a></div></div></div></footer><script src="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.js"></script><link rel="stylesheet" href="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.css"><script>NProgress.configure({showSpinner:!0,trickleSpeed:100}),NProgress.start(),window.addEventListener("load",function(){NProgress.done()})</script><script src="https://lib.baomitu.com/jquery/3.6.4/jquery.min.js"></script><script src="https://lib.baomitu.com/twitter-bootstrap/4.6.1/js/bootstrap.min.js"></script><script src="/js/events.js"></script><script src="/js/plugins.js"></script><script src="/js/img-lazyload.js"></script><script>var relativeDate=function(){var t,e,i,n,m=document.getElementById("updated-time");m&&(e=/\d{4}-\d{2}-\d{2}T\d{2}:\d{2}:\d{2}(?:Z|[+-]\d{2}:\d{2})/,(i=(t=m.textContent).match(e))&&(n=moment(i[0]).fromNow(),m.textContent=t.replace(e,n)),m.style.display="")};Fluid.utils.createScript("https://lib.baomitu.com/moment.js/2.29.4/moment.min.js",function(){"zh-cn".startsWith("en")?relativeDate():Fluid.utils.createScript("https://lib.baomitu.com/moment.js/2.29.4/locale/zh-cn.min.js",function(){relativeDate()})})</script><script>Fluid.utils.createScript("https://lib.baomitu.com/tocbot/4.20.1/tocbot.min.js",function(){var t,o=jQuery("#toc");0!==o.length&&window.tocbot&&(t=jQuery("#board-ctn").offset().top,window.tocbot.init(Object.assign({tocSelector:"#toc-body",contentSelector:".markdown-body",linkClass:"tocbot-link",activeLinkClass:"tocbot-active-link",listClass:"tocbot-list",isCollapsedClass:"tocbot-is-collapsed",collapsibleClass:"tocbot-is-collapsible",scrollSmooth:!0,includeTitleTags:!0,headingsOffset:-t},CONFIG.toc)),0<o.find(".toc-list-item").length&&o.css("visibility","visible"),Fluid.events.registerRefreshCallback(function(){if("tocbot"in window){tocbot.refresh();var t=jQuery("#toc");if(0===t.length||!tocbot)return;0<t.find(".toc-list-item").length&&t.css("visibility","visible")}}))})</script><script src="https://lib.baomitu.com/clipboard.js/2.0.11/clipboard.min.js"></script><script>Fluid.plugins.codeWidget()</script><script>Fluid.utils.createScript('https://lib.baomitu.com/anchor-js/4.3.1/anchor.min.js', function() {
    window.anchors.options = {
      placement: CONFIG.anchorjs.placement,
      visible  : CONFIG.anchorjs.visible
    };
    if (CONFIG.anchorjs.icon) {
      window.anchors.options.icon = CONFIG.anchorjs.icon;
    }
    var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
    var res = [];
    for (var item of el) {
      res.push('.markdown-body > ' + item.trim());
    }
    if (CONFIG.anchorjs.placement === 'left') {
      window.anchors.options.class = 'anchorjs-link-left';
    }
    window.anchors.add(res.join(', '));

    Fluid.events.registerRefreshCallback(function() {
      if ('anchors' in window) {
        anchors.removeAll();
        var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
        var res = [];
        for (var item of el) {
          res.push('.markdown-body > ' + item.trim());
        }
        if (CONFIG.anchorjs.placement === 'left') {
          anchors.options.class = 'anchorjs-link-left';
        }
        anchors.add(res.join(', '));
      }
    });
  });</script><script>Fluid.utils.createScript("https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js",function(){Fluid.plugins.fancyBox()})</script><script>Fluid.plugins.imageCaption()</script><script src="/js/local-search.js"></script><script defer src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script src="/js/cursor.js"></script><script src="//cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.js"></script><script src="//cdn.jsdelivr.net/gh/metowolf/MetingJS@1.2/dist/Meting.min.js"></script><script src="/js/boot.js"></script><script type="text/javascript">var originalTitle=document.title;window.onblur=function(){document.title="等你回来哦"},window.onfocus=function(){document.title=originalTitle}</script><div id="tooltip-rightmenu" class="tooltip-rightmenu">如果需要使用原始右键菜单请按下 <strong>Ctrl+右键</strong></div><div id="tooltip-clipboard" class="tooltip-rightmenu">链接复制成功！</div><div id="rightmenu-wrapper"><ul class="list-v rightmenu" id="rightmenu-content"><li class="navigation menuNavigation-Content"><a class="nav icon-only fix-cursor-default" onclick="history.back()"><i class="fa fa-arrow-left rightmenu-icon"></i></a> <a class="nav icon-only fix-cursor-default" onclick="history.forward()"><i class="fa fa-arrow-right rightmenu-icon"></i></a> <a class="nav icon-only fix-cursor-default" onclick="window.location.reload()"><i class="fa fa-refresh rightmenu-icon"></i></a> <a aria-label="TOP" href="#" role="button"><i class="fa fa-arrow-up rightmenu-icon"></i></a></li><hr class="menuLoad-Content" style="display:block"><li class="menuLoad-Content" style="display:block"><a class="vlts-menu fix-cursor-default" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search"><span><i class="fa fa-search rightmenu-icon"></i> 站内搜索</span></a></li><li class="menuLoad-Content" style="display:block"><a class="vlts-menu fix-cursor-default" href="javascript:;" onclick="toggleFullScreen()"><span><i class="fa fa-arrows-alt rightmenu-icon"></i> 切换全屏</span></a></li><li class="menuLoad-Content" style="display:block"><a class="vlts-menu fix-cursor-default" href="javascript:;" onclick="copyPageUrl()"><span><i class="fa fa-clipboard rightmenu-icon"></i> 复制链接</span></a></li><li class="menuLoad-Content" style="display:block"><a class="vlts-menu fix-cursor-default" href="javascript:;" onclick="scrollToComments()"><span><i class="fa fa-commenting rightmenu-icon"></i> 立即评论</span></a></li><hr class="menuLoad-Content" style="display:block"><li class="menuLoad-Content" style="display:block"><a class="vlts-menu fix-cursor-default" target="_blank" rel="noopener" href="https://www.kisechan.space/" data-group="link"><span><i class="fa fa-info-circle rightmenu-icon"></i> 关于本站</span></a></li></ul></div><link href="//maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet"><link href="/css/custom_right_menu_icons.css" type="text/css" rel="stylesheet"><script src="/js/right_menu.js" type="text/javascript"></script><link href="/css/right_menu.css" type="text/css" rel="stylesheet"><noscript><div class="noscript-warning">博客在允许 JavaScript 运行的环境下浏览效果更佳</div></noscript><script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"debug":false,"model":{"jsonPath":"/live2dw/assets/koharu.model.json"},"display":{"position":"left","width":150,"height":300},"mobile":{"show":false},"log":false});</script></body></html>